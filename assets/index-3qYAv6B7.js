(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function e(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(i){if(i.ep)return;i.ep=!0;const l=e(i);fetch(i.href,l)}})();/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ue{}function v(o,t){const e=/\{([^}]+)\}/g;return o.replace(e,(n,i)=>{if(Object.prototype.hasOwnProperty.call(t,i)){const l=t[i];return l!=null?String(l):""}else throw new Error(`Key '${i}' not found in valueMap.`)})}function r(o,t,e){for(let l=0;l<t.length-1;l++){const u=t[l];if(u.endsWith("[]")){const a=u.slice(0,-2);if(!(a in o))if(Array.isArray(e))o[a]=Array.from({length:e.length},()=>({}));else throw new Error(`Value must be a list given an array path ${u}`);if(Array.isArray(o[a])){const c=o[a];if(Array.isArray(e))for(let d=0;d<c.length;d++){const f=c[d];r(f,t.slice(l+1),e[d])}else for(const d of c)r(d,t.slice(l+1),e)}return}else if(u.endsWith("[0]")){const a=u.slice(0,-3);a in o||(o[a]=[{}]);const c=o[a];r(c[0],t.slice(l+1),e);return}(!o[u]||typeof o[u]!="object")&&(o[u]={}),o=o[u]}const n=t[t.length-1],i=o[n];if(i!==void 0){if(!e||typeof e=="object"&&Object.keys(e).length===0||e===i)return;if(typeof i=="object"&&typeof e=="object"&&i!==null&&e!==null)Object.assign(i,e);else throw new Error(`Cannot set value for an existing key. Key: ${n}`)}else o[n]=e}function s(o,t){try{if(t.length===1&&t[0]==="_self")return o;for(let e=0;e<t.length;e++){if(typeof o!="object"||o===null)return;const n=t[e];if(n.endsWith("[]")){const i=n.slice(0,-2);if(i in o){const l=o[i];return Array.isArray(l)?l.map(u=>s(u,t.slice(e+1))):void 0}else return}else o=o[n]}return o}catch(e){if(e instanceof TypeError)return;throw e}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function P(o,t){if(!t||typeof t!="string")throw new Error("model is required and must be a string");if(o.isVertexAI()){if(t.startsWith("publishers/")||t.startsWith("projects/")||t.startsWith("models/"))return t;if(t.indexOf("/")>=0){const e=t.split("/",2);return`publishers/${e[0]}/models/${e[1]}`}else return`publishers/google/models/${t}`}else return t.startsWith("models/")||t.startsWith("tunedModels/")?t:`models/${t}`}function ht(o,t){const e=P(o,t);return e?e.startsWith("publishers/")&&o.isVertexAI()?`projects/${o.getProject()}/locations/${o.getLocation()}/${e}`:e.startsWith("models/")&&o.isVertexAI()?`projects/${o.getProject()}/locations/${o.getLocation()}/publishers/google/${e}`:e:""}function Ae(o,t){if(t==null)throw new Error("PartUnion is required");if(typeof t=="object")return t;if(typeof t=="string")return{text:t};throw new Error(`Unsupported part type: ${typeof t}`)}function K(o,t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("PartListUnion is required");return Array.isArray(t)?t.map(e=>Ae(o,e)):[Ae(o,t)]}function gt(o){return o!=null&&typeof o=="object"&&"parts"in o&&Array.isArray(o.parts)}function Ot(o){return o!=null&&typeof o=="object"&&"functionCall"in o}function Ee(o){return!(o==null||Ot(o))}function yt(o){return o==null||Array.isArray(o)&&o.length===0?!1:o.every(Ee)}function D(o,t){if(t==null)throw new Error("ContentUnion is required");return gt(t)?t:Ee(t)?{role:"user",parts:K(o,t)}:{role:"model",parts:K(o,t)}}function Ct(o,t){if(!t)return[];if(o.isVertexAI()&&Array.isArray(t))return t.flatMap(e=>{const n=D(o,e);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]});if(o.isVertexAI()){const e=D(o,t);return e.parts&&e.parts.length>0&&e.parts[0].text!==void 0?[e.parts[0].text]:[]}return Array.isArray(t)?t.map(e=>D(o,e)):[D(o,t)]}function Q(o,t,e){e.length!==0&&(yt(e)?t.push({role:"user",parts:K(o,e)}):t.push({role:"model",parts:K(o,e)}),e.length=0)}function $t(o,t,e,n){Ee(n)===yt(e)||(Q(o,t,e),e.length=0),e.push(n)}function _(o,t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("contents are required");if(!Array.isArray(t))return[D(o,t)];const e=[],n=[];for(const i of t)if(gt(i))Q(o,e,n),e.push(i);else if(typeof i=="string"||typeof i=="object"&&!Array.isArray(i))$t(o,e,n,i);else if(Array.isArray(i))Q(o,e,n),e.push({role:"user",parts:K(o,i)});else throw new Error(`Unsupported content type: ${typeof i}`);return Q(o,e,n),e}function Z(o,t){if(!o.isVertexAI()&&"default"in t)throw new Error("Default value is not supported in the response schema for the Gemini API.");if("anyOf"in t&&t.anyOf!==void 0)for(const e of t.anyOf)Z(o,e);if("items"in t&&t.items!==void 0&&Z(o,t.items),"properties"in t&&t.properties!==void 0)for(const e of Object.values(t.properties))Z(o,e)}function Et(o,t){return Z(o,t),t}function Tt(o,t){if(typeof t=="object"&&"voiceConfig"in t)return t;if(typeof t=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:t}}};throw new Error(`Unsupported speechConfig type: ${typeof t}`)}function vt(o,t){return t}function $(o,t){if(!Array.isArray(t))throw new Error("tool is required and must be an array of Tools");return t}function Yt(o,t,e,n=1){const i=!t.startsWith(`${e}/`)&&t.split("/").length===n;return o.isVertexAI()?t.startsWith("projects/")?t:t.startsWith("locations/")?`projects/${o.getProject()}/${t}`:t.startsWith(`${e}/`)?`projects/${o.getProject()}/locations/${o.getLocation()}/${t}`:i?`projects/${o.getProject()}/locations/${o.getLocation()}/${e}/${t}`:t:i?`${e}/${t}`:t}function G(o,t){if(typeof t!="string")throw new Error("name must be a string");return Yt(o,t,"cachedContents")}function k(o,t){if(typeof t!="string")throw new Error("fromImageBytes must be a string");return t}function It(o,t){if(typeof t!="string")throw new Error("fromName must be a string");return t.startsWith("files/")?t.split("files/")[1]:t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Kt(o,t){const e={};if(s(t,["videoMetadata"])!==void 0)throw new Error("videoMetadata parameter is not supported in Gemini API.");const n=s(t,["thought"]);n!=null&&r(e,["thought"],n);const i=s(t,["codeExecutionResult"]);i!=null&&r(e,["codeExecutionResult"],i);const l=s(t,["executableCode"]);l!=null&&r(e,["executableCode"],l);const u=s(t,["fileData"]);u!=null&&r(e,["fileData"],u);const a=s(t,["functionCall"]);a!=null&&r(e,["functionCall"],a);const c=s(t,["functionResponse"]);c!=null&&r(e,["functionResponse"],c);const d=s(t,["inlineData"]);d!=null&&r(e,["inlineData"],d);const f=s(t,["text"]);return f!=null&&r(e,["text"],f),e}function Se(o,t){const e={},n=s(t,["parts"]);n!=null&&(Array.isArray(n)?r(e,["parts"],n.map(l=>Kt(o,l))):r(e,["parts"],n));const i=s(t,["role"]);return i!=null&&r(e,["role"],i),e}function Wt(o,t){const e={};if(s(t,["response"])!==void 0)throw new Error("response parameter is not supported in Gemini API.");const n=s(t,["description"]);n!=null&&r(e,["description"],n);const i=s(t,["name"]);i!=null&&r(e,["name"],i);const l=s(t,["parameters"]);return l!=null&&r(e,["parameters"],l),e}function Jt(){return{}}function zt(o,t){const e={},n=s(t,["mode"]);n!=null&&r(e,["mode"],n);const i=s(t,["dynamicThreshold"]);return i!=null&&r(e,["dynamicThreshold"],i),e}function Xt(o,t){const e={},n=s(t,["dynamicRetrievalConfig"]);return n!=null&&r(e,["dynamicRetrievalConfig"],zt(o,n)),e}function bt(o,t){const e={},n=s(t,["functionDeclarations"]);if(n!=null&&(Array.isArray(n)?r(e,["functionDeclarations"],n.map(a=>Wt(o,a))):r(e,["functionDeclarations"],n)),s(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");s(t,["googleSearch"])!=null&&r(e,["googleSearch"],Jt());const l=s(t,["googleSearchRetrieval"]);l!=null&&r(e,["googleSearchRetrieval"],Xt(o,l));const u=s(t,["codeExecution"]);return u!=null&&r(e,["codeExecution"],u),e}function Qt(o,t){const e={},n=s(t,["mode"]);n!=null&&r(e,["mode"],n);const i=s(t,["allowedFunctionNames"]);return i!=null&&r(e,["allowedFunctionNames"],i),e}function Zt(o,t){const e={},n=s(t,["functionCallingConfig"]);return n!=null&&r(e,["functionCallingConfig"],Qt(o,n)),e}function jt(o,t,e){const n={},i=s(t,["ttl"]);e!==void 0&&i!=null&&r(e,["ttl"],i);const l=s(t,["expireTime"]);e!==void 0&&l!=null&&r(e,["expireTime"],l);const u=s(t,["displayName"]);e!==void 0&&u!=null&&r(e,["displayName"],u);const a=s(t,["contents"]);e!==void 0&&a!=null&&(Array.isArray(a)?r(e,["contents"],_(o,_(o,a).map(p=>Se(o,p)))):r(e,["contents"],_(o,a)));const c=s(t,["systemInstruction"]);e!==void 0&&c!=null&&r(e,["systemInstruction"],Se(o,D(o,c)));const d=s(t,["tools"]);e!==void 0&&d!=null&&(Array.isArray(d)?r(e,["tools"],d.map(p=>bt(o,p))):r(e,["tools"],d));const f=s(t,["toolConfig"]);return e!==void 0&&f!=null&&r(e,["toolConfig"],Zt(o,f)),n}function en(o,t){const e={},n=s(t,["model"]);n!=null&&r(e,["model"],ht(o,n));const i=s(t,["config"]);return i!=null&&r(e,["config"],jt(o,i,e)),e}function tn(o,t){const e={},n=s(t,["name"]);n!=null&&r(e,["_url","name"],G(o,n));const i=s(t,["config"]);return i!=null&&r(e,["config"],i),e}function nn(o,t){const e={},n=s(t,["name"]);n!=null&&r(e,["_url","name"],G(o,n));const i=s(t,["config"]);return i!=null&&r(e,["config"],i),e}function on(o,t,e){const n={},i=s(t,["ttl"]);e!==void 0&&i!=null&&r(e,["ttl"],i);const l=s(t,["expireTime"]);return e!==void 0&&l!=null&&r(e,["expireTime"],l),n}function rn(o,t){const e={},n=s(t,["name"]);n!=null&&r(e,["_url","name"],G(o,n));const i=s(t,["config"]);return i!=null&&r(e,["config"],on(o,i,e)),e}function sn(o,t,e){const n={},i=s(t,["pageSize"]);e!==void 0&&i!=null&&r(e,["_query","pageSize"],i);const l=s(t,["pageToken"]);return e!==void 0&&l!=null&&r(e,["_query","pageToken"],l),n}function ln(o,t){const e={},n=s(t,["config"]);return n!=null&&r(e,["config"],sn(o,n,e)),e}function an(o,t){const e={},n=s(t,["videoMetadata"]);n!=null&&r(e,["videoMetadata"],n);const i=s(t,["thought"]);i!=null&&r(e,["thought"],i);const l=s(t,["codeExecutionResult"]);l!=null&&r(e,["codeExecutionResult"],l);const u=s(t,["executableCode"]);u!=null&&r(e,["executableCode"],u);const a=s(t,["fileData"]);a!=null&&r(e,["fileData"],a);const c=s(t,["functionCall"]);c!=null&&r(e,["functionCall"],c);const d=s(t,["functionResponse"]);d!=null&&r(e,["functionResponse"],d);const f=s(t,["inlineData"]);f!=null&&r(e,["inlineData"],f);const p=s(t,["text"]);return p!=null&&r(e,["text"],p),e}function Me(o,t){const e={},n=s(t,["parts"]);n!=null&&(Array.isArray(n)?r(e,["parts"],n.map(l=>an(o,l))):r(e,["parts"],n));const i=s(t,["role"]);return i!=null&&r(e,["role"],i),e}function un(o,t){const e={},n=s(t,["example"]);n!=null&&r(e,["example"],n);const i=s(t,["pattern"]);i!=null&&r(e,["pattern"],i);const l=s(t,["default"]);l!=null&&r(e,["default"],l);const u=s(t,["maxLength"]);u!=null&&r(e,["maxLength"],u);const a=s(t,["minLength"]);a!=null&&r(e,["minLength"],a);const c=s(t,["minProperties"]);c!=null&&r(e,["minProperties"],c);const d=s(t,["maxProperties"]);d!=null&&r(e,["maxProperties"],d);const f=s(t,["anyOf"]);f!=null&&r(e,["anyOf"],f);const p=s(t,["description"]);p!=null&&r(e,["description"],p);const h=s(t,["enum"]);h!=null&&r(e,["enum"],h);const m=s(t,["format"]);m!=null&&r(e,["format"],m);const g=s(t,["items"]);g!=null&&r(e,["items"],g);const y=s(t,["maxItems"]);y!=null&&r(e,["maxItems"],y);const E=s(t,["maximum"]);E!=null&&r(e,["maximum"],E);const T=s(t,["minItems"]);T!=null&&r(e,["minItems"],T);const C=s(t,["minimum"]);C!=null&&r(e,["minimum"],C);const I=s(t,["nullable"]);I!=null&&r(e,["nullable"],I);const A=s(t,["properties"]);A!=null&&r(e,["properties"],A);const N=s(t,["propertyOrdering"]);N!=null&&r(e,["propertyOrdering"],N);const R=s(t,["required"]);R!=null&&r(e,["required"],R);const F=s(t,["title"]);F!=null&&r(e,["title"],F);const L=s(t,["type"]);return L!=null&&r(e,["type"],L),e}function cn(o,t){const e={},n=s(t,["response"]);n!=null&&r(e,["response"],un(o,n));const i=s(t,["description"]);i!=null&&r(e,["description"],i);const l=s(t,["name"]);l!=null&&r(e,["name"],l);const u=s(t,["parameters"]);return u!=null&&r(e,["parameters"],u),e}function dn(){return{}}function fn(o,t){const e={},n=s(t,["mode"]);n!=null&&r(e,["mode"],n);const i=s(t,["dynamicThreshold"]);return i!=null&&r(e,["dynamicThreshold"],i),e}function pn(o,t){const e={},n=s(t,["dynamicRetrievalConfig"]);return n!=null&&r(e,["dynamicRetrievalConfig"],fn(o,n)),e}function mn(o,t){const e={},n=s(t,["functionDeclarations"]);n!=null&&(Array.isArray(n)?r(e,["functionDeclarations"],n.map(c=>cn(o,c))):r(e,["functionDeclarations"],n));const i=s(t,["retrieval"]);i!=null&&r(e,["retrieval"],i),s(t,["googleSearch"])!=null&&r(e,["googleSearch"],dn());const u=s(t,["googleSearchRetrieval"]);u!=null&&r(e,["googleSearchRetrieval"],pn(o,u));const a=s(t,["codeExecution"]);return a!=null&&r(e,["codeExecution"],a),e}function hn(o,t){const e={},n=s(t,["mode"]);n!=null&&r(e,["mode"],n);const i=s(t,["allowedFunctionNames"]);return i!=null&&r(e,["allowedFunctionNames"],i),e}function gn(o,t){const e={},n=s(t,["functionCallingConfig"]);return n!=null&&r(e,["functionCallingConfig"],hn(o,n)),e}function yn(o,t,e){const n={},i=s(t,["ttl"]);e!==void 0&&i!=null&&r(e,["ttl"],i);const l=s(t,["expireTime"]);e!==void 0&&l!=null&&r(e,["expireTime"],l);const u=s(t,["displayName"]);e!==void 0&&u!=null&&r(e,["displayName"],u);const a=s(t,["contents"]);e!==void 0&&a!=null&&(Array.isArray(a)?r(e,["contents"],_(o,_(o,a).map(p=>Me(o,p)))):r(e,["contents"],_(o,a)));const c=s(t,["systemInstruction"]);e!==void 0&&c!=null&&r(e,["systemInstruction"],Me(o,D(o,c)));const d=s(t,["tools"]);e!==void 0&&d!=null&&(Array.isArray(d)?r(e,["tools"],d.map(p=>mn(o,p))):r(e,["tools"],d));const f=s(t,["toolConfig"]);return e!==void 0&&f!=null&&r(e,["toolConfig"],gn(o,f)),n}function Cn(o,t){const e={},n=s(t,["model"]);n!=null&&r(e,["model"],ht(o,n));const i=s(t,["config"]);return i!=null&&r(e,["config"],yn(o,i,e)),e}function En(o,t){const e={},n=s(t,["name"]);n!=null&&r(e,["_url","name"],G(o,n));const i=s(t,["config"]);return i!=null&&r(e,["config"],i),e}function Tn(o,t){const e={},n=s(t,["name"]);n!=null&&r(e,["_url","name"],G(o,n));const i=s(t,["config"]);return i!=null&&r(e,["config"],i),e}function vn(o,t,e){const n={},i=s(t,["ttl"]);e!==void 0&&i!=null&&r(e,["ttl"],i);const l=s(t,["expireTime"]);return e!==void 0&&l!=null&&r(e,["expireTime"],l),n}function In(o,t){const e={},n=s(t,["name"]);n!=null&&r(e,["_url","name"],G(o,n));const i=s(t,["config"]);return i!=null&&r(e,["config"],vn(o,i,e)),e}function _n(o,t,e){const n={},i=s(t,["pageSize"]);e!==void 0&&i!=null&&r(e,["_query","pageSize"],i);const l=s(t,["pageToken"]);return e!==void 0&&l!=null&&r(e,["_query","pageToken"],l),n}function An(o,t){const e={},n=s(t,["config"]);return n!=null&&r(e,["config"],_n(o,n,e)),e}function j(o,t){const e={},n=s(t,["name"]);n!=null&&r(e,["name"],n);const i=s(t,["displayName"]);i!=null&&r(e,["displayName"],i);const l=s(t,["model"]);l!=null&&r(e,["model"],l);const u=s(t,["createTime"]);u!=null&&r(e,["createTime"],u);const a=s(t,["updateTime"]);a!=null&&r(e,["updateTime"],a);const c=s(t,["expireTime"]);c!=null&&r(e,["expireTime"],c);const d=s(t,["usageMetadata"]);return d!=null&&r(e,["usageMetadata"],d),e}function Sn(){return{}}function Mn(o,t){const e={},n=s(t,["nextPageToken"]);n!=null&&r(e,["nextPageToken"],n);const i=s(t,["cachedContents"]);return i!=null&&(Array.isArray(i)?r(e,["cachedContents"],i.map(l=>j(o,l))):r(e,["cachedContents"],i)),e}function ee(o,t){const e={},n=s(t,["name"]);n!=null&&r(e,["name"],n);const i=s(t,["displayName"]);i!=null&&r(e,["displayName"],i);const l=s(t,["model"]);l!=null&&r(e,["model"],l);const u=s(t,["createTime"]);u!=null&&r(e,["createTime"],u);const a=s(t,["updateTime"]);a!=null&&r(e,["updateTime"],a);const c=s(t,["expireTime"]);c!=null&&r(e,["expireTime"],c);const d=s(t,["usageMetadata"]);return d!=null&&r(e,["usageMetadata"],d),e}function Rn(){return{}}function xn(o,t){const e={},n=s(t,["nextPageToken"]);n!=null&&r(e,["nextPageToken"],n);const i=s(t,["cachedContents"]);return i!=null&&(Array.isArray(i)?r(e,["cachedContents"],i.map(l=>ee(o,l))):r(e,["cachedContents"],i)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var oe;(function(o){o.PAGED_ITEM_BATCH_JOBS="batchJobs",o.PAGED_ITEM_MODELS="models",o.PAGED_ITEM_TUNING_JOBS="tuningJobs",o.PAGED_ITEM_FILES="files",o.PAGED_ITEM_CACHED_CONTENTS="cachedContents"})(oe||(oe={}));class _t{constructor(t,e,n,i){this.pageInternal=[],this.paramsInternal={},this.requestInternal=e,this.init(t,n,i)}init(t,e,n){var i,l;this.nameInternal=t,this.pageInternal=e[this.nameInternal]||[],this.idxInternal=0;let u={config:{}};n?typeof n=="object"?u=Object.assign({},n):u=n:u={config:{}},u.config&&(u.config.pageToken=e.nextPageToken),this.paramsInternal=u,this.pageInternalSize=(l=(i=u.config)===null||i===void 0?void 0:i.pageSize)!==null&&l!==void 0?l:this.pageInternal.length}initNextPage(t){this.init(this.nameInternal,t,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(t){return this.pageInternal[t]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const t=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:t,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const t=await this.requestInternal(this.params);return this.initNextPage(t),this.page}hasNextPage(){var t;return((t=this.params.config)===null||t===void 0?void 0:t.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Re;(function(o){o.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",o.OUTCOME_OK="OUTCOME_OK",o.OUTCOME_FAILED="OUTCOME_FAILED",o.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(Re||(Re={}));var xe;(function(o){o.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",o.PYTHON="PYTHON"})(xe||(xe={}));var we;(function(o){o.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",o.STRING="STRING",o.NUMBER="NUMBER",o.INTEGER="INTEGER",o.BOOLEAN="BOOLEAN",o.ARRAY="ARRAY",o.OBJECT="OBJECT"})(we||(we={}));var Pe;(function(o){o.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",o.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",o.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",o.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",o.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",o.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(Pe||(Pe={}));var Ne;(function(o){o.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",o.SEVERITY="SEVERITY",o.PROBABILITY="PROBABILITY"})(Ne||(Ne={}));var De;(function(o){o.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",o.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",o.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",o.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",o.BLOCK_NONE="BLOCK_NONE",o.OFF="OFF"})(De||(De={}));var Fe;(function(o){o.MODE_UNSPECIFIED="MODE_UNSPECIFIED",o.MODE_DYNAMIC="MODE_DYNAMIC"})(Fe||(Fe={}));var Le;(function(o){o.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",o.STOP="STOP",o.MAX_TOKENS="MAX_TOKENS",o.SAFETY="SAFETY",o.RECITATION="RECITATION",o.OTHER="OTHER",o.BLOCKLIST="BLOCKLIST",o.PROHIBITED_CONTENT="PROHIBITED_CONTENT",o.SPII="SPII",o.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",o.IMAGE_SAFETY="IMAGE_SAFETY"})(Le||(Le={}));var Ve;(function(o){o.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",o.NEGLIGIBLE="NEGLIGIBLE",o.LOW="LOW",o.MEDIUM="MEDIUM",o.HIGH="HIGH"})(Ve||(Ve={}));var Ue;(function(o){o.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",o.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",o.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",o.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",o.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(Ue||(Ue={}));var qe;(function(o){o.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",o.SAFETY="SAFETY",o.OTHER="OTHER",o.BLOCKLIST="BLOCKLIST",o.PROHIBITED_CONTENT="PROHIBITED_CONTENT"})(qe||(qe={}));var Ge;(function(o){o.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",o.TEXT="TEXT",o.IMAGE="IMAGE",o.AUDIO="AUDIO"})(Ge||(Ge={}));var ke;(function(o){o.STATE_UNSPECIFIED="STATE_UNSPECIFIED",o.ACTIVE="ACTIVE",o.ERROR="ERROR"})(ke||(ke={}));var Be;(function(o){o.MODE_UNSPECIFIED="MODE_UNSPECIFIED",o.MODE_DYNAMIC="MODE_DYNAMIC"})(Be||(Be={}));var He;(function(o){o.MODE_UNSPECIFIED="MODE_UNSPECIFIED",o.AUTO="AUTO",o.ANY="ANY",o.NONE="NONE"})(He||(He={}));var Oe;(function(o){o.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",o.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",o.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",o.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(Oe||(Oe={}));var $e;(function(o){o.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",o.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",o.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",o.BLOCK_NONE="BLOCK_NONE"})($e||($e={}));var Ye;(function(o){o.DONT_ALLOW="DONT_ALLOW",o.ALLOW_ADULT="ALLOW_ADULT",o.ALLOW_ALL="ALLOW_ALL"})(Ye||(Ye={}));var Ke;(function(o){o.auto="auto",o.en="en",o.ja="ja",o.ko="ko",o.hi="hi"})(Ke||(Ke={}));var We;(function(o){o.STATE_UNSPECIFIED="STATE_UNSPECIFIED",o.PROCESSING="PROCESSING",o.ACTIVE="ACTIVE",o.FAILED="FAILED"})(We||(We={}));var Je;(function(o){o.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",o.UPLOADED="UPLOADED",o.GENERATED="GENERATED"})(Je||(Je={}));var ze;(function(o){o.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",o.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",o.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",o.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",o.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(ze||(ze={}));var Xe;(function(o){o.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",o.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",o.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",o.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(Xe||(Xe={}));var be;(function(o){o.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",o.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",o.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",o.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(be||(be={}));var Qe;(function(o){o.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",o.TEXT="TEXT",o.IMAGE="IMAGE",o.VIDEO="VIDEO",o.AUDIO="AUDIO",o.DOCUMENT="DOCUMENT"})(Qe||(Qe={}));class X{get text(){var t,e,n,i,l,u,a,c;if(((i=(n=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let d="",f=!1;const p=[];for(const h of(c=(a=(u=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||u===void 0?void 0:u.content)===null||a===void 0?void 0:a.parts)!==null&&c!==void 0?c:[]){for(const[m,g]of Object.entries(h))m!=="text"&&m!=="thought"&&(g!==null||g!==void 0)&&p.push(m);if(typeof h.text=="string"){if(typeof h.thought=="boolean"&&h.thought)continue;f=!0,d+=h.text}}return p.length>0&&console.warn(`there are non-text parts ${p} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),f?d:void 0}get functionCalls(){var t,e,n,i,l,u,a,c;if(((i=(n=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const d=(c=(a=(u=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||u===void 0?void 0:u.content)===null||a===void 0?void 0:a.parts)===null||c===void 0?void 0:c.filter(f=>f.functionCall).map(f=>f.functionCall).filter(f=>f!==void 0);if((d==null?void 0:d.length)!==0)return d}get executableCode(){var t,e,n,i,l,u,a,c,d;if(((i=(n=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const f=(c=(a=(u=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||u===void 0?void 0:u.content)===null||a===void 0?void 0:a.parts)===null||c===void 0?void 0:c.filter(p=>p.executableCode).map(p=>p.executableCode).filter(p=>p!==void 0);if((f==null?void 0:f.length)!==0)return(d=f==null?void 0:f[0])===null||d===void 0?void 0:d.code}get codeExecutionResult(){var t,e,n,i,l,u,a,c,d;if(((i=(n=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const f=(c=(a=(u=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||u===void 0?void 0:u.content)===null||a===void 0?void 0:a.parts)===null||c===void 0?void 0:c.filter(p=>p.codeExecutionResult).map(p=>p.codeExecutionResult).filter(p=>p!==void 0);if((f==null?void 0:f.length)!==0)return(d=f==null?void 0:f[0])===null||d===void 0?void 0:d.output}}class Ze{}class je{}class et{}class wn{}class tt{}class nt{}class Pn{}class At{constructor(t){const e={};for(const n of t.headers.entries())e[n[0]]=n[1];this.headers=e,this.responseInternal=t}json(){return this.responseInternal.json()}}class Nn{}class Dn{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Fn extends ue{constructor(t){super(),this.apiClient=t,this.list=async(e={})=>new _t(oe.PAGED_ITEM_CACHED_CONTENTS,n=>this.listInternal(n),await this.listInternal(e),e)}async create(t){var e,n;let i,l="",u={};if(this.apiClient.isVertexAI()){const a=Cn(this.apiClient,t);return l=v("cachedContents",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions}).then(c=>c.json()),i.then(c=>ee(this.apiClient,c))}else{const a=en(this.apiClient,t);return l=v("cachedContents",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions}).then(c=>c.json()),i.then(c=>j(this.apiClient,c))}}async get(t){var e,n;let i,l="",u={};if(this.apiClient.isVertexAI()){const a=En(this.apiClient,t);return l=v("{name}",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions}).then(c=>c.json()),i.then(c=>ee(this.apiClient,c))}else{const a=tn(this.apiClient,t);return l=v("{name}",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions}).then(c=>c.json()),i.then(c=>j(this.apiClient,c))}}async delete(t){var e,n;let i,l="",u={};if(this.apiClient.isVertexAI()){const a=Tn(this.apiClient,t);return l=v("{name}",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions}).then(c=>c.json()),i.then(()=>{const c=Rn(),d=new tt;return Object.assign(d,c),d})}else{const a=nn(this.apiClient,t);return l=v("{name}",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions}).then(c=>c.json()),i.then(()=>{const c=Sn(),d=new tt;return Object.assign(d,c),d})}}async update(t){var e,n;let i,l="",u={};if(this.apiClient.isVertexAI()){const a=In(this.apiClient,t);return l=v("{name}",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"PATCH",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions}).then(c=>c.json()),i.then(c=>ee(this.apiClient,c))}else{const a=rn(this.apiClient,t);return l=v("{name}",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"PATCH",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions}).then(c=>c.json()),i.then(c=>j(this.apiClient,c))}}async listInternal(t){var e,n;let i,l="",u={};if(this.apiClient.isVertexAI()){const a=An(this.apiClient,t);return l=v("cachedContents",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions}).then(c=>c.json()),i.then(c=>{const d=xn(this.apiClient,c),f=new nt;return Object.assign(f,d),f})}else{const a=ln(this.apiClient,t);return l=v("cachedContents",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions}).then(c=>c.json()),i.then(c=>{const d=Mn(this.apiClient,c),f=new nt;return Object.assign(f,d),f})}}}function ot(o){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&o[t],n=0;if(e)return e.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&n>=o.length&&(o=void 0),{value:o&&o[n++],done:!o}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function x(o){return this instanceof x?(this.v=o,this):new x(o)}function ie(o,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=e.apply(o,t||[]),i,l=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",u),i[Symbol.asyncIterator]=function(){return this},i;function u(m){return function(g){return Promise.resolve(g).then(m,p)}}function a(m,g){n[m]&&(i[m]=function(y){return new Promise(function(E,T){l.push([m,y,E,T])>1||c(m,y)})},g&&(i[m]=g(i[m])))}function c(m,g){try{d(n[m](g))}catch(y){h(l[0][3],y)}}function d(m){m.value instanceof x?Promise.resolve(m.value.v).then(f,p):h(l[0][2],m)}function f(m){c("next",m)}function p(m){c("throw",m)}function h(m,g){m(g),l.shift(),l.length&&c(l[0][0],l[0][1])}}function pe(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=o[Symbol.asyncIterator],e;return t?t.call(o):(o=typeof ot=="function"?ot(o):o[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(l){e[l]=o[l]&&function(u){return new Promise(function(a,c){u=o[l](u),i(a,c,u.done,u.value)})}}function i(l,u,a,c){Promise.resolve(c).then(function(d){l({value:d,done:a})},u)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Ln(o){var t;if(o.candidates==null||o.candidates.length===0)return!1;const e=(t=o.candidates[0])===null||t===void 0?void 0:t.content;return e===void 0?!1:St(e)}function St(o){if(o.parts===void 0||o.parts.length===0)return!1;for(const t of o.parts)if(t===void 0||Object.keys(t).length===0||t.text!==void 0&&t.text==="")return!1;return!0}function Vn(o){if(o.length!==0){if(o[0].role!=="user")throw new Error("History must start with a user turn.");for(const t of o)if(t.role!=="user"&&t.role!=="model")throw new Error(`Role must be user or model, but got ${t.role}.`)}}function Un(o){if(o===void 0||o.length===0)return[];const t=[],e=o.length;let n=0,i=o[0];for(;n<e;)if(o[n].role==="user")i=o[n],n++;else{const l=[];let u=!0;for(;n<e&&o[n].role==="model";)l.push(o[n]),u&&!St(o[n])&&(u=!1),n++;u&&(t.push(i),t.push(...l))}return t}class qn{constructor(t,e){this.modelsModule=t,this.apiClient=e}create(t){return new Gn(this.apiClient,this.modelsModule,t.model,t.config,t.history)}}class Gn{constructor(t,e,n,i={},l=[]){this.apiClient=t,this.modelsModule=e,this.model=n,this.config=i,this.history=l,this.sendPromise=Promise.resolve(),Vn(l)}async sendMessage(t){var e;await this.sendPromise;const n=D(this.apiClient,t.message),i=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(n),config:(e=t.config)!==null&&e!==void 0?e:this.config});return this.sendPromise=(async()=>{var l,u;const c=(u=(l=(await i).candidates)===null||l===void 0?void 0:l[0])===null||u===void 0?void 0:u.content,d=c?[c]:[];this.recordHistory(n,d)})(),await this.sendPromise,i}async sendMessageStream(t){var e;await this.sendPromise;const n=D(this.apiClient,t.message),i=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(n),config:(e=t.config)!==null&&e!==void 0?e:this.config});this.sendPromise=i.then(()=>{});const l=await i;return this.processStreamResponse(l,n)}getHistory(t=!1){return t?Un(this.history):this.history}processStreamResponse(t,e){var n,i;return ie(this,arguments,function*(){var u,a,c,d;const f=[];try{for(var p=!0,h=pe(t),m;m=yield x(h.next()),u=m.done,!u;p=!0){d=m.value,p=!1;const g=d;if(Ln(g)){const y=(i=(n=g.candidates)===null||n===void 0?void 0:n[0])===null||i===void 0?void 0:i.content;y!==void 0&&f.push(y)}yield yield x(g)}}catch(g){a={error:g}}finally{try{!p&&!u&&(c=h.return)&&(yield x(c.call(h)))}finally{if(a)throw a.error}}this.recordHistory(e,f)})}recordHistory(t,e){let n=[];e.length>0&&e.every(i=>i.role==="model")?n=e:n.push({role:"model",parts:[]}),this.history.push(t),this.history.push(...n)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function kn(o,t,e){const n={},i=s(t,["pageSize"]);e!==void 0&&i!=null&&r(e,["_query","pageSize"],i);const l=s(t,["pageToken"]);return e!==void 0&&l!=null&&r(e,["_query","pageToken"],l),n}function Bn(o,t){const e={},n=s(t,["config"]);return n!=null&&r(e,["config"],kn(o,n,e)),e}function Hn(o,t){const e={},n=s(t,["details"]);n!=null&&r(e,["details"],n);const i=s(t,["message"]);i!=null&&r(e,["message"],i);const l=s(t,["code"]);return l!=null&&r(e,["code"],l),e}function On(o,t){const e={},n=s(t,["name"]);n!=null&&r(e,["name"],n);const i=s(t,["displayName"]);i!=null&&r(e,["displayName"],i);const l=s(t,["mimeType"]);l!=null&&r(e,["mimeType"],l);const u=s(t,["sizeBytes"]);u!=null&&r(e,["sizeBytes"],u);const a=s(t,["createTime"]);a!=null&&r(e,["createTime"],a);const c=s(t,["expirationTime"]);c!=null&&r(e,["expirationTime"],c);const d=s(t,["updateTime"]);d!=null&&r(e,["updateTime"],d);const f=s(t,["sha256Hash"]);f!=null&&r(e,["sha256Hash"],f);const p=s(t,["uri"]);p!=null&&r(e,["uri"],p);const h=s(t,["downloadUri"]);h!=null&&r(e,["downloadUri"],h);const m=s(t,["state"]);m!=null&&r(e,["state"],m);const g=s(t,["source"]);g!=null&&r(e,["source"],g);const y=s(t,["videoMetadata"]);y!=null&&r(e,["videoMetadata"],y);const E=s(t,["error"]);return E!=null&&r(e,["error"],Hn(o,E)),e}function $n(o,t){const e={},n=s(t,["file"]);n!=null&&r(e,["file"],On(o,n));const i=s(t,["config"]);return i!=null&&r(e,["config"],i),e}function Yn(o,t){const e={},n=s(t,["name"]);n!=null&&r(e,["_url","file"],It(o,n));const i=s(t,["config"]);return i!=null&&r(e,["config"],i),e}function Kn(o,t){const e={},n=s(t,["name"]);n!=null&&r(e,["_url","file"],It(o,n));const i=s(t,["config"]);return i!=null&&r(e,["config"],i),e}function Wn(o,t){const e={},n=s(t,["details"]);n!=null&&r(e,["details"],n);const i=s(t,["message"]);i!=null&&r(e,["message"],i);const l=s(t,["code"]);return l!=null&&r(e,["code"],l),e}function me(o,t){const e={},n=s(t,["name"]);n!=null&&r(e,["name"],n);const i=s(t,["displayName"]);i!=null&&r(e,["displayName"],i);const l=s(t,["mimeType"]);l!=null&&r(e,["mimeType"],l);const u=s(t,["sizeBytes"]);u!=null&&r(e,["sizeBytes"],u);const a=s(t,["createTime"]);a!=null&&r(e,["createTime"],a);const c=s(t,["expirationTime"]);c!=null&&r(e,["expirationTime"],c);const d=s(t,["updateTime"]);d!=null&&r(e,["updateTime"],d);const f=s(t,["sha256Hash"]);f!=null&&r(e,["sha256Hash"],f);const p=s(t,["uri"]);p!=null&&r(e,["uri"],p);const h=s(t,["downloadUri"]);h!=null&&r(e,["downloadUri"],h);const m=s(t,["state"]);m!=null&&r(e,["state"],m);const g=s(t,["source"]);g!=null&&r(e,["source"],g);const y=s(t,["videoMetadata"]);y!=null&&r(e,["videoMetadata"],y);const E=s(t,["error"]);return E!=null&&r(e,["error"],Wn(o,E)),e}function Jn(o,t){const e={},n=s(t,["nextPageToken"]);n!=null&&r(e,["nextPageToken"],n);const i=s(t,["files"]);return i!=null&&(Array.isArray(i)?r(e,["files"],i.map(l=>me(o,l))):r(e,["files"],i)),e}function zn(o,t){const e={},n=s(t,["httpHeaders"]);return n!=null&&r(e,["httpHeaders"],n),e}function Xn(){return{}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class bn extends ue{constructor(t){super(),this.apiClient=t,this.list=async(e={})=>new _t(oe.PAGED_ITEM_FILES,n=>this.listInternal(n),await this.listInternal(e),e)}async upload(t){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(t.file,t.config).then(e=>me(this.apiClient,e))}async listInternal(t){var e;let n,i="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=Bn(this.apiClient,t);return i=v("files",u._url),l=u._query,delete u.config,delete u._url,delete u._query,n=this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions}).then(a=>a.json()),n.then(a=>{const c=Jn(this.apiClient,a),d=new Pn;return Object.assign(d,c),d})}}async createInternal(t){var e;let n,i="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=$n(this.apiClient,t);return i=v("upload/v1beta/files",u._url),l=u._query,delete u.config,delete u._url,delete u._query,n=this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions}).then(a=>a.json()),n.then(a=>{const c=zn(this.apiClient,a),d=new Nn;return Object.assign(d,c),d})}}async get(t){var e;let n,i="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=Yn(this.apiClient,t);return i=v("files/{file}",u._url),l=u._query,delete u.config,delete u._url,delete u._query,n=this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions}).then(a=>a.json()),n.then(a=>me(this.apiClient,a))}}async delete(t){var e;let n,i="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=Kn(this.apiClient,t);return i=v("files/{file}",u._url),l=u._query,delete u.config,delete u._url,delete u._query,n=this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions}).then(a=>a.json()),n.then(()=>{const a=Xn(),c=new Dn;return Object.assign(c,a),c})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Qn(o,t){const e={};if(s(t,["videoMetadata"])!==void 0)throw new Error("videoMetadata parameter is not supported in Gemini API.");const n=s(t,["thought"]);n!=null&&r(e,["thought"],n);const i=s(t,["codeExecutionResult"]);i!=null&&r(e,["codeExecutionResult"],i);const l=s(t,["executableCode"]);l!=null&&r(e,["executableCode"],l);const u=s(t,["fileData"]);u!=null&&r(e,["fileData"],u);const a=s(t,["functionCall"]);a!=null&&r(e,["functionCall"],a);const c=s(t,["functionResponse"]);c!=null&&r(e,["functionResponse"],c);const d=s(t,["inlineData"]);d!=null&&r(e,["inlineData"],d);const f=s(t,["text"]);return f!=null&&r(e,["text"],f),e}function z(o,t){const e={},n=s(t,["parts"]);n!=null&&(Array.isArray(n)?r(e,["parts"],n.map(l=>Qn(o,l))):r(e,["parts"],n));const i=s(t,["role"]);return i!=null&&r(e,["role"],i),e}function Zn(o,t){const e={};if(s(t,["example"])!==void 0)throw new Error("example parameter is not supported in Gemini API.");if(s(t,["pattern"])!==void 0)throw new Error("pattern parameter is not supported in Gemini API.");if(s(t,["default"])!==void 0)throw new Error("default parameter is not supported in Gemini API.");if(s(t,["maxLength"])!==void 0)throw new Error("maxLength parameter is not supported in Gemini API.");if(s(t,["minLength"])!==void 0)throw new Error("minLength parameter is not supported in Gemini API.");if(s(t,["minProperties"])!==void 0)throw new Error("minProperties parameter is not supported in Gemini API.");if(s(t,["maxProperties"])!==void 0)throw new Error("maxProperties parameter is not supported in Gemini API.");const n=s(t,["anyOf"]);n!=null&&r(e,["anyOf"],n);const i=s(t,["description"]);i!=null&&r(e,["description"],i);const l=s(t,["enum"]);l!=null&&r(e,["enum"],l);const u=s(t,["format"]);u!=null&&r(e,["format"],u);const a=s(t,["items"]);a!=null&&r(e,["items"],a);const c=s(t,["maxItems"]);c!=null&&r(e,["maxItems"],c);const d=s(t,["maximum"]);d!=null&&r(e,["maximum"],d);const f=s(t,["minItems"]);f!=null&&r(e,["minItems"],f);const p=s(t,["minimum"]);p!=null&&r(e,["minimum"],p);const h=s(t,["nullable"]);h!=null&&r(e,["nullable"],h);const m=s(t,["properties"]);m!=null&&r(e,["properties"],m);const g=s(t,["propertyOrdering"]);g!=null&&r(e,["propertyOrdering"],g);const y=s(t,["required"]);y!=null&&r(e,["required"],y);const E=s(t,["title"]);E!=null&&r(e,["title"],E);const T=s(t,["type"]);return T!=null&&r(e,["type"],T),e}function jn(o,t){const e={};if(s(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const n=s(t,["category"]);n!=null&&r(e,["category"],n);const i=s(t,["threshold"]);return i!=null&&r(e,["threshold"],i),e}function eo(o,t){const e={};if(s(t,["response"])!==void 0)throw new Error("response parameter is not supported in Gemini API.");const n=s(t,["description"]);n!=null&&r(e,["description"],n);const i=s(t,["name"]);i!=null&&r(e,["name"],i);const l=s(t,["parameters"]);return l!=null&&r(e,["parameters"],l),e}function to(){return{}}function no(o,t){const e={},n=s(t,["mode"]);n!=null&&r(e,["mode"],n);const i=s(t,["dynamicThreshold"]);return i!=null&&r(e,["dynamicThreshold"],i),e}function oo(o,t){const e={},n=s(t,["dynamicRetrievalConfig"]);return n!=null&&r(e,["dynamicRetrievalConfig"],no(o,n)),e}function Mt(o,t){const e={},n=s(t,["functionDeclarations"]);if(n!=null&&(Array.isArray(n)?r(e,["functionDeclarations"],n.map(a=>eo(o,a))):r(e,["functionDeclarations"],n)),s(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");s(t,["googleSearch"])!=null&&r(e,["googleSearch"],to());const l=s(t,["googleSearchRetrieval"]);l!=null&&r(e,["googleSearchRetrieval"],oo(o,l));const u=s(t,["codeExecution"]);return u!=null&&r(e,["codeExecution"],u),e}function io(o,t){const e={},n=s(t,["mode"]);n!=null&&r(e,["mode"],n);const i=s(t,["allowedFunctionNames"]);return i!=null&&r(e,["allowedFunctionNames"],i),e}function ro(o,t){const e={},n=s(t,["functionCallingConfig"]);return n!=null&&r(e,["functionCallingConfig"],io(o,n)),e}function so(o,t){const e={},n=s(t,["voiceName"]);return n!=null&&r(e,["voiceName"],n),e}function lo(o,t){const e={},n=s(t,["prebuiltVoiceConfig"]);return n!=null&&r(e,["prebuiltVoiceConfig"],so(o,n)),e}function ao(o,t){const e={},n=s(t,["voiceConfig"]);return n!=null&&r(e,["voiceConfig"],lo(o,n)),e}function uo(o,t){const e={},n=s(t,["includeThoughts"]);return n!=null&&r(e,["includeThoughts"],n),e}function co(o,t,e){const n={},i=s(t,["systemInstruction"]);e!==void 0&&i!=null&&r(e,["systemInstruction"],z(o,D(o,i)));const l=s(t,["temperature"]);l!=null&&r(n,["temperature"],l);const u=s(t,["topP"]);u!=null&&r(n,["topP"],u);const a=s(t,["topK"]);a!=null&&r(n,["topK"],a);const c=s(t,["candidateCount"]);c!=null&&r(n,["candidateCount"],c);const d=s(t,["maxOutputTokens"]);d!=null&&r(n,["maxOutputTokens"],d);const f=s(t,["stopSequences"]);f!=null&&r(n,["stopSequences"],f);const p=s(t,["responseLogprobs"]);p!=null&&r(n,["responseLogprobs"],p);const h=s(t,["logprobs"]);h!=null&&r(n,["logprobs"],h);const m=s(t,["presencePenalty"]);m!=null&&r(n,["presencePenalty"],m);const g=s(t,["frequencyPenalty"]);g!=null&&r(n,["frequencyPenalty"],g);const y=s(t,["seed"]);y!=null&&r(n,["seed"],y);const E=s(t,["responseMimeType"]);E!=null&&r(n,["responseMimeType"],E);const T=s(t,["responseSchema"]);if(T!=null&&r(n,["responseSchema"],Zn(o,Et(o,T))),s(t,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");const C=s(t,["safetySettings"]);e!==void 0&&C!=null&&(Array.isArray(C)?r(e,["safetySettings"],C.map(O=>jn(o,O))):r(e,["safetySettings"],C));const I=s(t,["tools"]);e!==void 0&&I!=null&&(Array.isArray(I)?r(e,["tools"],$(o,$(o,I).map(O=>Mt(o,vt(o,O))))):r(e,["tools"],$(o,I)));const A=s(t,["toolConfig"]);if(e!==void 0&&A!=null&&r(e,["toolConfig"],ro(o,A)),s(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const N=s(t,["cachedContent"]);e!==void 0&&N!=null&&r(e,["cachedContent"],G(o,N));const R=s(t,["responseModalities"]);R!=null&&r(n,["responseModalities"],R);const F=s(t,["mediaResolution"]);F!=null&&r(n,["mediaResolution"],F);const L=s(t,["speechConfig"]);if(L!=null&&r(n,["speechConfig"],ao(o,Tt(o,L))),s(t,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const Y=s(t,["thinkingConfig"]);return Y!=null&&r(n,["thinkingConfig"],uo(o,Y)),n}function it(o,t){const e={},n=s(t,["model"]);n!=null&&r(e,["_url","model"],P(o,n));const i=s(t,["contents"]);i!=null&&(Array.isArray(i)?r(e,["contents"],_(o,_(o,i).map(u=>z(o,u)))):r(e,["contents"],_(o,i)));const l=s(t,["config"]);return l!=null&&r(e,["generationConfig"],co(o,l,e)),e}function fo(o,t,e){const n={},i=s(t,["taskType"]);e!==void 0&&i!=null&&r(e,["requests[]","taskType"],i);const l=s(t,["title"]);e!==void 0&&l!=null&&r(e,["requests[]","title"],l);const u=s(t,["outputDimensionality"]);if(e!==void 0&&u!=null&&r(e,["requests[]","outputDimensionality"],u),s(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(s(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function po(o,t){const e={},n=s(t,["model"]);n!=null&&r(e,["_url","model"],P(o,n));const i=s(t,["contents"]);i!=null&&r(e,["requests[]","content"],Ct(o,i));const l=s(t,["config"]);l!=null&&r(e,["config"],fo(o,l,e));const u=s(t,["model"]);return u!==void 0&&r(e,["requests[]","model"],P(o,u)),e}function mo(o,t,e){const n={};if(s(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(s(t,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const i=s(t,["numberOfImages"]);e!==void 0&&i!=null&&r(e,["parameters","sampleCount"],i);const l=s(t,["aspectRatio"]);e!==void 0&&l!=null&&r(e,["parameters","aspectRatio"],l);const u=s(t,["guidanceScale"]);if(e!==void 0&&u!=null&&r(e,["parameters","guidanceScale"],u),s(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const a=s(t,["safetyFilterLevel"]);e!==void 0&&a!=null&&r(e,["parameters","safetySetting"],a);const c=s(t,["personGeneration"]);e!==void 0&&c!=null&&r(e,["parameters","personGeneration"],c);const d=s(t,["includeSafetyAttributes"]);e!==void 0&&d!=null&&r(e,["parameters","includeSafetyAttributes"],d);const f=s(t,["includeRaiReason"]);e!==void 0&&f!=null&&r(e,["parameters","includeRaiReason"],f);const p=s(t,["language"]);e!==void 0&&p!=null&&r(e,["parameters","language"],p);const h=s(t,["outputMimeType"]);e!==void 0&&h!=null&&r(e,["parameters","outputOptions","mimeType"],h);const m=s(t,["outputCompressionQuality"]);if(e!==void 0&&m!=null&&r(e,["parameters","outputOptions","compressionQuality"],m),s(t,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(s(t,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return n}function ho(o,t){const e={},n=s(t,["model"]);n!=null&&r(e,["_url","model"],P(o,n));const i=s(t,["prompt"]);i!=null&&r(e,["instances[0]","prompt"],i);const l=s(t,["config"]);return l!=null&&r(e,["config"],mo(o,l,e)),e}function go(o,t){const e={};if(s(t,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(s(t,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(s(t,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function yo(o,t){const e={},n=s(t,["model"]);n!=null&&r(e,["_url","model"],P(o,n));const i=s(t,["contents"]);i!=null&&(Array.isArray(i)?r(e,["contents"],_(o,_(o,i).map(u=>z(o,u)))):r(e,["contents"],_(o,i)));const l=s(t,["config"]);return l!=null&&r(e,["config"],go(o,l)),e}function Co(o,t){const e={};if(s(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const n=s(t,["imageBytes"]);n!=null&&r(e,["bytesBase64Encoded"],k(o,n));const i=s(t,["mimeType"]);return i!=null&&r(e,["mimeType"],i),e}function Eo(o,t,e){const n={},i=s(t,["numberOfVideos"]);if(e!==void 0&&i!=null&&r(e,["parameters","sampleCount"],i),s(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(s(t,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const l=s(t,["durationSeconds"]);if(e!==void 0&&l!=null&&r(e,["parameters","durationSeconds"],l),s(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const u=s(t,["aspectRatio"]);if(e!==void 0&&u!=null&&r(e,["parameters","aspectRatio"],u),s(t,["resolution"])!==void 0)throw new Error("resolution parameter is not supported in Gemini API.");const a=s(t,["personGeneration"]);if(e!==void 0&&a!=null&&r(e,["parameters","personGeneration"],a),s(t,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const c=s(t,["negativePrompt"]);if(e!==void 0&&c!=null&&r(e,["parameters","negativePrompt"],c),s(t,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return n}function To(o,t){const e={},n=s(t,["model"]);n!=null&&r(e,["_url","model"],P(o,n));const i=s(t,["prompt"]);i!=null&&r(e,["instances[0]","prompt"],i);const l=s(t,["image"]);l!=null&&r(e,["instances[0]","image"],Co(o,l));const u=s(t,["config"]);return u!=null&&r(e,["config"],Eo(o,u,e)),e}function vo(o,t){const e={},n=s(t,["videoMetadata"]);n!=null&&r(e,["videoMetadata"],n);const i=s(t,["thought"]);i!=null&&r(e,["thought"],i);const l=s(t,["codeExecutionResult"]);l!=null&&r(e,["codeExecutionResult"],l);const u=s(t,["executableCode"]);u!=null&&r(e,["executableCode"],u);const a=s(t,["fileData"]);a!=null&&r(e,["fileData"],a);const c=s(t,["functionCall"]);c!=null&&r(e,["functionCall"],c);const d=s(t,["functionResponse"]);d!=null&&r(e,["functionResponse"],d);const f=s(t,["inlineData"]);f!=null&&r(e,["inlineData"],f);const p=s(t,["text"]);return p!=null&&r(e,["text"],p),e}function H(o,t){const e={},n=s(t,["parts"]);n!=null&&(Array.isArray(n)?r(e,["parts"],n.map(l=>vo(o,l))):r(e,["parts"],n));const i=s(t,["role"]);return i!=null&&r(e,["role"],i),e}function Rt(o,t){const e={},n=s(t,["example"]);n!=null&&r(e,["example"],n);const i=s(t,["pattern"]);i!=null&&r(e,["pattern"],i);const l=s(t,["default"]);l!=null&&r(e,["default"],l);const u=s(t,["maxLength"]);u!=null&&r(e,["maxLength"],u);const a=s(t,["minLength"]);a!=null&&r(e,["minLength"],a);const c=s(t,["minProperties"]);c!=null&&r(e,["minProperties"],c);const d=s(t,["maxProperties"]);d!=null&&r(e,["maxProperties"],d);const f=s(t,["anyOf"]);f!=null&&r(e,["anyOf"],f);const p=s(t,["description"]);p!=null&&r(e,["description"],p);const h=s(t,["enum"]);h!=null&&r(e,["enum"],h);const m=s(t,["format"]);m!=null&&r(e,["format"],m);const g=s(t,["items"]);g!=null&&r(e,["items"],g);const y=s(t,["maxItems"]);y!=null&&r(e,["maxItems"],y);const E=s(t,["maximum"]);E!=null&&r(e,["maximum"],E);const T=s(t,["minItems"]);T!=null&&r(e,["minItems"],T);const C=s(t,["minimum"]);C!=null&&r(e,["minimum"],C);const I=s(t,["nullable"]);I!=null&&r(e,["nullable"],I);const A=s(t,["properties"]);A!=null&&r(e,["properties"],A);const N=s(t,["propertyOrdering"]);N!=null&&r(e,["propertyOrdering"],N);const R=s(t,["required"]);R!=null&&r(e,["required"],R);const F=s(t,["title"]);F!=null&&r(e,["title"],F);const L=s(t,["type"]);return L!=null&&r(e,["type"],L),e}function Io(o,t){const e={},n=s(t,["method"]);n!=null&&r(e,["method"],n);const i=s(t,["category"]);i!=null&&r(e,["category"],i);const l=s(t,["threshold"]);return l!=null&&r(e,["threshold"],l),e}function _o(o,t){const e={},n=s(t,["response"]);n!=null&&r(e,["response"],Rt(o,n));const i=s(t,["description"]);i!=null&&r(e,["description"],i);const l=s(t,["name"]);l!=null&&r(e,["name"],l);const u=s(t,["parameters"]);return u!=null&&r(e,["parameters"],u),e}function Ao(){return{}}function So(o,t){const e={},n=s(t,["mode"]);n!=null&&r(e,["mode"],n);const i=s(t,["dynamicThreshold"]);return i!=null&&r(e,["dynamicThreshold"],i),e}function Mo(o,t){const e={},n=s(t,["dynamicRetrievalConfig"]);return n!=null&&r(e,["dynamicRetrievalConfig"],So(o,n)),e}function Te(o,t){const e={},n=s(t,["functionDeclarations"]);n!=null&&(Array.isArray(n)?r(e,["functionDeclarations"],n.map(c=>_o(o,c))):r(e,["functionDeclarations"],n));const i=s(t,["retrieval"]);i!=null&&r(e,["retrieval"],i),s(t,["googleSearch"])!=null&&r(e,["googleSearch"],Ao());const u=s(t,["googleSearchRetrieval"]);u!=null&&r(e,["googleSearchRetrieval"],Mo(o,u));const a=s(t,["codeExecution"]);return a!=null&&r(e,["codeExecution"],a),e}function Ro(o,t){const e={},n=s(t,["mode"]);n!=null&&r(e,["mode"],n);const i=s(t,["allowedFunctionNames"]);return i!=null&&r(e,["allowedFunctionNames"],i),e}function xo(o,t){const e={},n=s(t,["functionCallingConfig"]);return n!=null&&r(e,["functionCallingConfig"],Ro(o,n)),e}function wo(o,t){const e={},n=s(t,["voiceName"]);return n!=null&&r(e,["voiceName"],n),e}function Po(o,t){const e={},n=s(t,["prebuiltVoiceConfig"]);return n!=null&&r(e,["prebuiltVoiceConfig"],wo(o,n)),e}function No(o,t){const e={},n=s(t,["voiceConfig"]);return n!=null&&r(e,["voiceConfig"],Po(o,n)),e}function Do(o,t){const e={},n=s(t,["includeThoughts"]);return n!=null&&r(e,["includeThoughts"],n),e}function Fo(o,t,e){const n={},i=s(t,["systemInstruction"]);e!==void 0&&i!=null&&r(e,["systemInstruction"],H(o,D(o,i)));const l=s(t,["temperature"]);l!=null&&r(n,["temperature"],l);const u=s(t,["topP"]);u!=null&&r(n,["topP"],u);const a=s(t,["topK"]);a!=null&&r(n,["topK"],a);const c=s(t,["candidateCount"]);c!=null&&r(n,["candidateCount"],c);const d=s(t,["maxOutputTokens"]);d!=null&&r(n,["maxOutputTokens"],d);const f=s(t,["stopSequences"]);f!=null&&r(n,["stopSequences"],f);const p=s(t,["responseLogprobs"]);p!=null&&r(n,["responseLogprobs"],p);const h=s(t,["logprobs"]);h!=null&&r(n,["logprobs"],h);const m=s(t,["presencePenalty"]);m!=null&&r(n,["presencePenalty"],m);const g=s(t,["frequencyPenalty"]);g!=null&&r(n,["frequencyPenalty"],g);const y=s(t,["seed"]);y!=null&&r(n,["seed"],y);const E=s(t,["responseMimeType"]);E!=null&&r(n,["responseMimeType"],E);const T=s(t,["responseSchema"]);T!=null&&r(n,["responseSchema"],Rt(o,Et(o,T)));const C=s(t,["routingConfig"]);C!=null&&r(n,["routingConfig"],C);const I=s(t,["safetySettings"]);e!==void 0&&I!=null&&(Array.isArray(I)?r(e,["safetySettings"],I.map(ce=>Io(o,ce))):r(e,["safetySettings"],I));const A=s(t,["tools"]);e!==void 0&&A!=null&&(Array.isArray(A)?r(e,["tools"],$(o,$(o,A).map(ce=>Te(o,vt(o,ce))))):r(e,["tools"],$(o,A)));const N=s(t,["toolConfig"]);e!==void 0&&N!=null&&r(e,["toolConfig"],xo(o,N));const R=s(t,["labels"]);e!==void 0&&R!=null&&r(e,["labels"],R);const F=s(t,["cachedContent"]);e!==void 0&&F!=null&&r(e,["cachedContent"],G(o,F));const L=s(t,["responseModalities"]);L!=null&&r(n,["responseModalities"],L);const Y=s(t,["mediaResolution"]);Y!=null&&r(n,["mediaResolution"],Y);const O=s(t,["speechConfig"]);O!=null&&r(n,["speechConfig"],No(o,Tt(o,O)));const Ie=s(t,["audioTimestamp"]);Ie!=null&&r(n,["audioTimestamp"],Ie);const _e=s(t,["thinkingConfig"]);return _e!=null&&r(n,["thinkingConfig"],Do(o,_e)),n}function rt(o,t){const e={},n=s(t,["model"]);n!=null&&r(e,["_url","model"],P(o,n));const i=s(t,["contents"]);i!=null&&(Array.isArray(i)?r(e,["contents"],_(o,_(o,i).map(u=>H(o,u)))):r(e,["contents"],_(o,i)));const l=s(t,["config"]);return l!=null&&r(e,["generationConfig"],Fo(o,l,e)),e}function Lo(o,t,e){const n={},i=s(t,["taskType"]);e!==void 0&&i!=null&&r(e,["instances[]","task_type"],i);const l=s(t,["title"]);e!==void 0&&l!=null&&r(e,["instances[]","title"],l);const u=s(t,["outputDimensionality"]);e!==void 0&&u!=null&&r(e,["parameters","outputDimensionality"],u);const a=s(t,["mimeType"]);e!==void 0&&a!=null&&r(e,["instances[]","mimeType"],a);const c=s(t,["autoTruncate"]);return e!==void 0&&c!=null&&r(e,["parameters","autoTruncate"],c),n}function Vo(o,t){const e={},n=s(t,["model"]);n!=null&&r(e,["_url","model"],P(o,n));const i=s(t,["contents"]);i!=null&&r(e,["instances[]","content"],Ct(o,i));const l=s(t,["config"]);return l!=null&&r(e,["config"],Lo(o,l,e)),e}function Uo(o,t,e){const n={},i=s(t,["outputGcsUri"]);e!==void 0&&i!=null&&r(e,["parameters","storageUri"],i);const l=s(t,["negativePrompt"]);e!==void 0&&l!=null&&r(e,["parameters","negativePrompt"],l);const u=s(t,["numberOfImages"]);e!==void 0&&u!=null&&r(e,["parameters","sampleCount"],u);const a=s(t,["aspectRatio"]);e!==void 0&&a!=null&&r(e,["parameters","aspectRatio"],a);const c=s(t,["guidanceScale"]);e!==void 0&&c!=null&&r(e,["parameters","guidanceScale"],c);const d=s(t,["seed"]);e!==void 0&&d!=null&&r(e,["parameters","seed"],d);const f=s(t,["safetyFilterLevel"]);e!==void 0&&f!=null&&r(e,["parameters","safetySetting"],f);const p=s(t,["personGeneration"]);e!==void 0&&p!=null&&r(e,["parameters","personGeneration"],p);const h=s(t,["includeSafetyAttributes"]);e!==void 0&&h!=null&&r(e,["parameters","includeSafetyAttributes"],h);const m=s(t,["includeRaiReason"]);e!==void 0&&m!=null&&r(e,["parameters","includeRaiReason"],m);const g=s(t,["language"]);e!==void 0&&g!=null&&r(e,["parameters","language"],g);const y=s(t,["outputMimeType"]);e!==void 0&&y!=null&&r(e,["parameters","outputOptions","mimeType"],y);const E=s(t,["outputCompressionQuality"]);e!==void 0&&E!=null&&r(e,["parameters","outputOptions","compressionQuality"],E);const T=s(t,["addWatermark"]);e!==void 0&&T!=null&&r(e,["parameters","addWatermark"],T);const C=s(t,["enhancePrompt"]);return e!==void 0&&C!=null&&r(e,["parameters","enhancePrompt"],C),n}function qo(o,t){const e={},n=s(t,["model"]);n!=null&&r(e,["_url","model"],P(o,n));const i=s(t,["prompt"]);i!=null&&r(e,["instances[0]","prompt"],i);const l=s(t,["config"]);return l!=null&&r(e,["config"],Uo(o,l,e)),e}function Go(o,t,e){const n={},i=s(t,["systemInstruction"]);e!==void 0&&i!=null&&r(e,["systemInstruction"],H(o,D(o,i)));const l=s(t,["tools"]);e!==void 0&&l!=null&&(Array.isArray(l)?r(e,["tools"],l.map(a=>Te(o,a))):r(e,["tools"],l));const u=s(t,["generationConfig"]);return e!==void 0&&u!=null&&r(e,["generationConfig"],u),n}function ko(o,t){const e={},n=s(t,["model"]);n!=null&&r(e,["_url","model"],P(o,n));const i=s(t,["contents"]);i!=null&&(Array.isArray(i)?r(e,["contents"],_(o,_(o,i).map(u=>H(o,u)))):r(e,["contents"],_(o,i)));const l=s(t,["config"]);return l!=null&&r(e,["config"],Go(o,l,e)),e}function Bo(o,t){const e={},n=s(t,["model"]);n!=null&&r(e,["_url","model"],P(o,n));const i=s(t,["contents"]);i!=null&&(Array.isArray(i)?r(e,["contents"],_(o,_(o,i).map(u=>H(o,u)))):r(e,["contents"],_(o,i)));const l=s(t,["config"]);return l!=null&&r(e,["config"],l),e}function Ho(o,t){const e={},n=s(t,["gcsUri"]);n!=null&&r(e,["gcsUri"],n);const i=s(t,["imageBytes"]);i!=null&&r(e,["bytesBase64Encoded"],k(o,i));const l=s(t,["mimeType"]);return l!=null&&r(e,["mimeType"],l),e}function Oo(o,t,e){const n={},i=s(t,["numberOfVideos"]);e!==void 0&&i!=null&&r(e,["parameters","sampleCount"],i);const l=s(t,["outputGcsUri"]);e!==void 0&&l!=null&&r(e,["parameters","storageUri"],l);const u=s(t,["fps"]);e!==void 0&&u!=null&&r(e,["parameters","fps"],u);const a=s(t,["durationSeconds"]);e!==void 0&&a!=null&&r(e,["parameters","durationSeconds"],a);const c=s(t,["seed"]);e!==void 0&&c!=null&&r(e,["parameters","seed"],c);const d=s(t,["aspectRatio"]);e!==void 0&&d!=null&&r(e,["parameters","aspectRatio"],d);const f=s(t,["resolution"]);e!==void 0&&f!=null&&r(e,["parameters","resolution"],f);const p=s(t,["personGeneration"]);e!==void 0&&p!=null&&r(e,["parameters","personGeneration"],p);const h=s(t,["pubsubTopic"]);e!==void 0&&h!=null&&r(e,["parameters","pubsubTopic"],h);const m=s(t,["negativePrompt"]);e!==void 0&&m!=null&&r(e,["parameters","negativePrompt"],m);const g=s(t,["enhancePrompt"]);return e!==void 0&&g!=null&&r(e,["parameters","enhancePrompt"],g),n}function $o(o,t){const e={},n=s(t,["model"]);n!=null&&r(e,["_url","model"],P(o,n));const i=s(t,["prompt"]);i!=null&&r(e,["instances[0]","prompt"],i);const l=s(t,["image"]);l!=null&&r(e,["instances[0]","image"],Ho(o,l));const u=s(t,["config"]);return u!=null&&r(e,["config"],Oo(o,u,e)),e}function Yo(o,t){const e={},n=s(t,["thought"]);n!=null&&r(e,["thought"],n);const i=s(t,["codeExecutionResult"]);i!=null&&r(e,["codeExecutionResult"],i);const l=s(t,["executableCode"]);l!=null&&r(e,["executableCode"],l);const u=s(t,["fileData"]);u!=null&&r(e,["fileData"],u);const a=s(t,["functionCall"]);a!=null&&r(e,["functionCall"],a);const c=s(t,["functionResponse"]);c!=null&&r(e,["functionResponse"],c);const d=s(t,["inlineData"]);d!=null&&r(e,["inlineData"],d);const f=s(t,["text"]);return f!=null&&r(e,["text"],f),e}function xt(o,t){const e={},n=s(t,["parts"]);n!=null&&(Array.isArray(n)?r(e,["parts"],n.map(l=>Yo(o,l))):r(e,["parts"],n));const i=s(t,["role"]);return i!=null&&r(e,["role"],i),e}function Ko(o,t){const e={},n=s(t,["citationSources"]);return n!=null&&r(e,["citations"],n),e}function Wo(o,t){const e={},n=s(t,["content"]);n!=null&&r(e,["content"],xt(o,n));const i=s(t,["citationMetadata"]);i!=null&&r(e,["citationMetadata"],Ko(o,i));const l=s(t,["tokenCount"]);l!=null&&r(e,["tokenCount"],l);const u=s(t,["finishReason"]);u!=null&&r(e,["finishReason"],u);const a=s(t,["avgLogprobs"]);a!=null&&r(e,["avgLogprobs"],a);const c=s(t,["groundingMetadata"]);c!=null&&r(e,["groundingMetadata"],c);const d=s(t,["index"]);d!=null&&r(e,["index"],d);const f=s(t,["logprobsResult"]);f!=null&&r(e,["logprobsResult"],f);const p=s(t,["safetyRatings"]);return p!=null&&r(e,["safetyRatings"],p),e}function st(o,t){const e={},n=s(t,["candidates"]);n!=null&&(Array.isArray(n)?r(e,["candidates"],n.map(a=>Wo(o,a))):r(e,["candidates"],n));const i=s(t,["modelVersion"]);i!=null&&r(e,["modelVersion"],i);const l=s(t,["promptFeedback"]);l!=null&&r(e,["promptFeedback"],l);const u=s(t,["usageMetadata"]);return u!=null&&r(e,["usageMetadata"],u),e}function Jo(o,t){const e={},n=s(t,["values"]);return n!=null&&r(e,["values"],n),e}function zo(){return{}}function Xo(o,t){const e={},n=s(t,["embeddings"]);return n!=null&&(Array.isArray(n)?r(e,["embeddings"],n.map(l=>Jo(o,l))):r(e,["embeddings"],n)),s(t,["metadata"])!=null&&r(e,["metadata"],zo()),e}function bo(o,t){const e={},n=s(t,["bytesBase64Encoded"]);n!=null&&r(e,["imageBytes"],k(o,n));const i=s(t,["mimeType"]);return i!=null&&r(e,["mimeType"],i),e}function wt(o,t){const e={},n=s(t,["safetyAttributes","categories"]);n!=null&&r(e,["categories"],n);const i=s(t,["safetyAttributes","scores"]);i!=null&&r(e,["scores"],i);const l=s(t,["contentType"]);return l!=null&&r(e,["contentType"],l),e}function Qo(o,t){const e={},n=s(t,["_self"]);n!=null&&r(e,["image"],bo(o,n));const i=s(t,["raiFilteredReason"]);i!=null&&r(e,["raiFilteredReason"],i);const l=s(t,["_self"]);return l!=null&&r(e,["safetyAttributes"],wt(o,l)),e}function Zo(o,t){const e={},n=s(t,["predictions"]);n!=null&&(Array.isArray(n)?r(e,["generatedImages"],n.map(l=>Qo(o,l))):r(e,["generatedImages"],n));const i=s(t,["positivePromptSafetyAttributes"]);return i!=null&&r(e,["positivePromptSafetyAttributes"],wt(o,i)),e}function jo(o,t){const e={},n=s(t,["totalTokens"]);n!=null&&r(e,["totalTokens"],n);const i=s(t,["cachedContentTokenCount"]);return i!=null&&r(e,["cachedContentTokenCount"],i),e}function ei(o,t){const e={},n=s(t,["video","uri"]);n!=null&&r(e,["uri"],n);const i=s(t,["video","encodedVideo"]);i!=null&&r(e,["videoBytes"],k(o,i));const l=s(t,["encoding"]);return l!=null&&r(e,["mimeType"],l),e}function ti(o,t){const e={},n=s(t,["_self"]);return n!=null&&r(e,["video"],ei(o,n)),e}function ni(o,t){const e={},n=s(t,["generatedSamples"]);n!=null&&(Array.isArray(n)?r(e,["generatedVideos"],n.map(u=>ti(o,u))):r(e,["generatedVideos"],n));const i=s(t,["raiMediaFilteredCount"]);i!=null&&r(e,["raiMediaFilteredCount"],i);const l=s(t,["raiMediaFilteredReasons"]);return l!=null&&r(e,["raiMediaFilteredReasons"],l),e}function oi(o,t){const e={},n=s(t,["name"]);n!=null&&r(e,["name"],n);const i=s(t,["metadata"]);i!=null&&r(e,["metadata"],i);const l=s(t,["done"]);l!=null&&r(e,["done"],l);const u=s(t,["error"]);u!=null&&r(e,["error"],u);const a=s(t,["response"]);a!=null&&r(e,["response"],a);const c=s(t,["response","generateVideoResponse"]);return c!=null&&r(e,["result"],ni(o,c)),e}function ii(o,t){const e={},n=s(t,["videoMetadata"]);n!=null&&r(e,["videoMetadata"],n);const i=s(t,["thought"]);i!=null&&r(e,["thought"],i);const l=s(t,["codeExecutionResult"]);l!=null&&r(e,["codeExecutionResult"],l);const u=s(t,["executableCode"]);u!=null&&r(e,["executableCode"],u);const a=s(t,["fileData"]);a!=null&&r(e,["fileData"],a);const c=s(t,["functionCall"]);c!=null&&r(e,["functionCall"],c);const d=s(t,["functionResponse"]);d!=null&&r(e,["functionResponse"],d);const f=s(t,["inlineData"]);f!=null&&r(e,["inlineData"],f);const p=s(t,["text"]);return p!=null&&r(e,["text"],p),e}function Pt(o,t){const e={},n=s(t,["parts"]);n!=null&&(Array.isArray(n)?r(e,["parts"],n.map(l=>ii(o,l))):r(e,["parts"],n));const i=s(t,["role"]);return i!=null&&r(e,["role"],i),e}function ri(o,t){const e={},n=s(t,["citations"]);return n!=null&&r(e,["citations"],n),e}function si(o,t){const e={},n=s(t,["content"]);n!=null&&r(e,["content"],Pt(o,n));const i=s(t,["citationMetadata"]);i!=null&&r(e,["citationMetadata"],ri(o,i));const l=s(t,["finishMessage"]);l!=null&&r(e,["finishMessage"],l);const u=s(t,["finishReason"]);u!=null&&r(e,["finishReason"],u);const a=s(t,["avgLogprobs"]);a!=null&&r(e,["avgLogprobs"],a);const c=s(t,["groundingMetadata"]);c!=null&&r(e,["groundingMetadata"],c);const d=s(t,["index"]);d!=null&&r(e,["index"],d);const f=s(t,["logprobsResult"]);f!=null&&r(e,["logprobsResult"],f);const p=s(t,["safetyRatings"]);return p!=null&&r(e,["safetyRatings"],p),e}function lt(o,t){const e={},n=s(t,["candidates"]);n!=null&&(Array.isArray(n)?r(e,["candidates"],n.map(d=>si(o,d))):r(e,["candidates"],n));const i=s(t,["createTime"]);i!=null&&r(e,["createTime"],i);const l=s(t,["responseId"]);l!=null&&r(e,["responseId"],l);const u=s(t,["modelVersion"]);u!=null&&r(e,["modelVersion"],u);const a=s(t,["promptFeedback"]);a!=null&&r(e,["promptFeedback"],a);const c=s(t,["usageMetadata"]);return c!=null&&r(e,["usageMetadata"],c),e}function li(o,t){const e={},n=s(t,["truncated"]);n!=null&&r(e,["truncated"],n);const i=s(t,["token_count"]);return i!=null&&r(e,["tokenCount"],i),e}function ai(o,t){const e={},n=s(t,["values"]);n!=null&&r(e,["values"],n);const i=s(t,["statistics"]);return i!=null&&r(e,["statistics"],li(o,i)),e}function ui(o,t){const e={},n=s(t,["billableCharacterCount"]);return n!=null&&r(e,["billableCharacterCount"],n),e}function ci(o,t){const e={},n=s(t,["predictions[]","embeddings"]);n!=null&&(Array.isArray(n)?r(e,["embeddings"],n.map(l=>ai(o,l))):r(e,["embeddings"],n));const i=s(t,["metadata"]);return i!=null&&r(e,["metadata"],ui(o,i)),e}function di(o,t){const e={},n=s(t,["gcsUri"]);n!=null&&r(e,["gcsUri"],n);const i=s(t,["bytesBase64Encoded"]);i!=null&&r(e,["imageBytes"],k(o,i));const l=s(t,["mimeType"]);return l!=null&&r(e,["mimeType"],l),e}function Nt(o,t){const e={},n=s(t,["safetyAttributes","categories"]);n!=null&&r(e,["categories"],n);const i=s(t,["safetyAttributes","scores"]);i!=null&&r(e,["scores"],i);const l=s(t,["contentType"]);return l!=null&&r(e,["contentType"],l),e}function fi(o,t){const e={},n=s(t,["_self"]);n!=null&&r(e,["image"],di(o,n));const i=s(t,["raiFilteredReason"]);i!=null&&r(e,["raiFilteredReason"],i);const l=s(t,["_self"]);l!=null&&r(e,["safetyAttributes"],Nt(o,l));const u=s(t,["prompt"]);return u!=null&&r(e,["enhancedPrompt"],u),e}function pi(o,t){const e={},n=s(t,["predictions"]);n!=null&&(Array.isArray(n)?r(e,["generatedImages"],n.map(l=>fi(o,l))):r(e,["generatedImages"],n));const i=s(t,["positivePromptSafetyAttributes"]);return i!=null&&r(e,["positivePromptSafetyAttributes"],Nt(o,i)),e}function mi(o,t){const e={},n=s(t,["totalTokens"]);return n!=null&&r(e,["totalTokens"],n),e}function hi(o,t){const e={},n=s(t,["tokensInfo"]);return n!=null&&r(e,["tokensInfo"],n),e}function gi(o,t){const e={},n=s(t,["gcsUri"]);n!=null&&r(e,["uri"],n);const i=s(t,["bytesBase64Encoded"]);i!=null&&r(e,["videoBytes"],k(o,i));const l=s(t,["mimeType"]);return l!=null&&r(e,["mimeType"],l),e}function yi(o,t){const e={},n=s(t,["_self"]);return n!=null&&r(e,["video"],gi(o,n)),e}function Ci(o,t){const e={},n=s(t,["videos"]);n!=null&&(Array.isArray(n)?r(e,["generatedVideos"],n.map(u=>yi(o,u))):r(e,["generatedVideos"],n));const i=s(t,["raiMediaFilteredCount"]);i!=null&&r(e,["raiMediaFilteredCount"],i);const l=s(t,["raiMediaFilteredReasons"]);return l!=null&&r(e,["raiMediaFilteredReasons"],l),e}function Ei(o,t){const e={},n=s(t,["name"]);n!=null&&r(e,["name"],n);const i=s(t,["metadata"]);i!=null&&r(e,["metadata"],i);const l=s(t,["done"]);l!=null&&r(e,["done"],l);const u=s(t,["error"]);u!=null&&r(e,["error"],u);const a=s(t,["response"]);a!=null&&r(e,["response"],a);const c=s(t,["response"]);return c!=null&&r(e,["result"],Ci(o,c)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Ti(o,t){const e={},n=s(t,["config"]);n!=null&&r(e,["setup"],Ai(o,n));const i=s(t,["model"]);return i!==void 0&&r(e,["setup","model"],i),e}function vi(o,t){const e={},n=s(t,["config"]);n!=null&&r(e,["setup"],Si(o,n));const i=s(t,["model"]);return i!==void 0&&r(e,["setup","model"],i),e}function Ii(o,t){const e={},n=s(t,["setupComplete"]);n!==void 0&&r(e,["setupComplete"],n);const i=s(t,["serverContent"]);i!=null&&r(e,["serverContent"],Mi(o,i));const l=s(t,["toolCall"]);l!=null&&r(e,["toolCall"],Pi(o,l));const u=s(t,["toolCallCancellation"]);return u!=null&&r(e,["toolCallCancellation"],Di(o,u)),e}function _i(o,t){const e={},n=s(t,["setupComplete"]);n!==void 0&&r(e,["setupComplete"],n);const i=s(t,["serverContent"]);i!=null&&r(e,["serverContent"],Ri(o,i));const l=s(t,["toolCall"]);l!=null&&r(e,["toolCall"],Ni(o,l));const u=s(t,["toolCallCancellation"]);return u!=null&&r(e,["toolCallCancellation"],Fi(o,u)),e}function Ai(o,t){const e={},n=s(t,["generationConfig"]);n!==void 0&&r(e,["generationConfig"],n);const i=s(t,["responseModalities"]);i!==void 0&&r(e,["generationConfig","responseModalities"],i);const l=s(t,["speechConfig"]);l!==void 0&&r(e,["generationConfig","speechConfig"],l);const u=s(t,["systemInstruction"]);u!=null&&r(e,["systemInstruction"],z(o,u));const a=s(t,["tools"]);return a!=null&&Array.isArray(a)&&r(e,["tools"],a.map(c=>Mt(o,c))),e}function Si(o,t){const e={},n=s(t,["generationConfig"]);n!==void 0&&r(e,["generationConfig"],n);const i=s(t,["responseModalities"]);i!==void 0?r(e,["generationConfig","responseModalities"],i):r(e,["generationConfig","responseModalities"],["AUDIO"]);const l=s(t,["speechConfig"]);l!==void 0&&r(e,["generationConfig","speechConfig"],l);const u=s(t,["systemInstruction"]);u!=null&&r(e,["systemInstruction"],H(o,u));const a=s(t,["tools"]);return a!=null&&Array.isArray(a)&&r(e,["tools"],a.map(c=>Te(o,c))),e}function Mi(o,t){const e={},n=s(t,["modelTurn"]);n!=null&&r(e,["modelTurn"],xt(o,n));const i=s(t,["turnComplete"]);i!==void 0&&r(e,["turnComplete"],i);const l=s(t,["interrupted"]);return l!==void 0&&r(e,["interrupted"],l),e}function Ri(o,t){const e={},n=s(t,["modelTurn"]);n!=null&&r(e,["modelTurn"],Pt(o,n));const i=s(t,["turnComplete"]);i!==void 0&&r(e,["turnComplete"],i);const l=s(t,["interrupted"]);return l!==void 0&&r(e,["interrupted"],l),e}function xi(o,t){const e={},n=s(t,["id"]);n!==void 0&&r(e,["id"],n);const i=s(t,["args"]);i!==void 0&&r(e,["args"],i);const l=s(t,["name"]);return l!==void 0&&r(e,["name"],l),e}function wi(o,t){const e={},n=s(t,["args"]);n!==void 0&&r(e,["args"],n);const i=s(t,["name"]);return i!==void 0&&r(e,["name"],i),e}function Pi(o,t){const e={},n=s(t,["functionCalls"]);return n!=null&&Array.isArray(n)&&r(e,["functionCalls"],n.map(i=>xi(o,i))),e}function Ni(o,t){const e={},n=s(t,["functionCalls"]);return n!=null&&Array.isArray(n)&&r(e,["functionCalls"],n.map(i=>wi(o,i))),e}function Di(o,t){const e={},n=s(t,["ids"]);return n!==void 0&&r(e,["ids"],n),e}function Fi(o,t){const e={},n=s(t,["ids"]);return n!==void 0&&r(e,["ids"],n),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Li="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function Vi(o,t,e){let n,i;e.data instanceof Blob?i=JSON.parse(await e.data.text()):i=JSON.parse(e.data),o.isVertexAI()?n=_i(o,i):n=Ii(o,i),t(n)}class Ui{constructor(t,e,n){this.apiClient=t,this.auth=e,this.webSocketFactory=n}async connect(t){var e,n;const i=this.apiClient.getWebsocketBaseUrl(),l=this.apiClient.getApiVersion();let u;const a=Bi(this.apiClient.getDefaultHeaders());if(this.apiClient.isVertexAI())u=`${i}/ws/google.cloud.aiplatform.${l}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(a);else{const C=this.apiClient.getApiKey();u=`${i}/ws/google.ai.generativelanguage.${l}.GenerativeService.BidiGenerateContent?key=${C}`}let c=()=>{};const d=new Promise(C=>{c=C}),f=t.callbacks,p=function(){var C;(C=f==null?void 0:f.onopen)===null||C===void 0||C.call(f),c({})},h=this.apiClient,m={onopen:p,onmessage:C=>{Vi(h,f.onmessage,C)},onerror:(e=f==null?void 0:f.onerror)!==null&&e!==void 0?e:function(C){},onclose:(n=f==null?void 0:f.onclose)!==null&&n!==void 0?n:function(C){}},g=this.webSocketFactory.create(u,ki(a),m);g.connect(),await d;let y=P(this.apiClient,t.model);if(this.apiClient.isVertexAI()&&y.startsWith("publishers/")){const C=this.apiClient.getProject(),I=this.apiClient.getLocation();y=`projects/${C}/locations/${I}/`+y}let E={};const T={model:y,config:t.config,callbacks:t.callbacks};return this.apiClient.isVertexAI()?E=vi(this.apiClient,T):E=Ti(this.apiClient,T),g.send(JSON.stringify(E)),new Gi(g,this.apiClient)}}const qi={turnComplete:!0};class Gi{constructor(t,e){this.conn=t,this.apiClient=e}tLiveClientContent(t,e){if(e.turns!==null&&e.turns!==void 0){let n=[];try{n=_(t,e.turns),t.isVertexAI()?n=n.map(i=>H(t,i)):n=n.map(i=>z(t,i))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof e.turns}'`)}return{clientContent:{turns:n,turnComplete:e.turnComplete}}}return{clientContent:{turnComplete:e.turnComplete}}}tLiveClientRealtimeInput(t,e){let n={};if(!("media"in e)||!e.media)throw new Error(`Failed to convert realtime input "media", type: '${typeof e.media}'`);return n={realtimeInput:{mediaChunks:[e.media]}},n}tLiveClienttToolResponse(t,e){let n=[];if(e.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(e.functionResponses)?n=e.functionResponses:n=[e.functionResponses],n.length===0)throw new Error("functionResponses is required.");for(const l of n){if(typeof l!="object"||l===null||!("name"in l)||!("response"in l))throw new Error(`Could not parse function response, type '${typeof l}'.`);if(!t.isVertexAI()&&!("id"in l))throw new Error(Li)}return{toolResponse:{functionResponses:n}}}sendClientContent(t){t=Object.assign(Object.assign({},qi),t);const e=this.tLiveClientContent(this.apiClient,t);this.conn.send(JSON.stringify(e))}sendRealtimeInput(t){if(t.media==null)throw new Error("Media is required.");const e=this.tLiveClientRealtimeInput(this.apiClient,t);this.conn.send(JSON.stringify(e))}sendToolResponse(t){if(t.functionResponses==null)throw new Error("Tool response parameters are required.");const e=this.tLiveClienttToolResponse(this.apiClient,t);this.conn.send(JSON.stringify(e))}close(){this.conn.close()}}function ki(o){const t={};return o.forEach((e,n)=>{t[n]=e}),t}function Bi(o){const t=new Headers;for(const[e,n]of Object.entries(o))t.append(e,n);return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Hi extends ue{constructor(t){super(),this.apiClient=t,this.generateContent=async e=>await this.generateContentInternal(e),this.generateContentStream=async e=>await this.generateContentStreamInternal(e),this.generateImages=async e=>await this.generateImagesInternal(e).then(n=>{var i;let l;const u=[];if(n!=null&&n.generatedImages)for(const c of n.generatedImages)c&&(c!=null&&c.safetyAttributes)&&((i=c==null?void 0:c.safetyAttributes)===null||i===void 0?void 0:i.contentType)==="Positive Prompt"?l=c==null?void 0:c.safetyAttributes:u.push(c);let a;return l?a={generatedImages:u,positivePromptSafetyAttributes:l}:a={generatedImages:u},a})}async generateContentInternal(t){var e,n;let i,l="",u={};if(this.apiClient.isVertexAI()){const a=rt(this.apiClient,t);return l=v("{model}:generateContent",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions}).then(c=>c.json()),i.then(c=>{const d=lt(this.apiClient,c),f=new X;return Object.assign(f,d),f})}else{const a=it(this.apiClient,t);return l=v("{model}:generateContent",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions}).then(c=>c.json()),i.then(c=>{const d=st(this.apiClient,c),f=new X;return Object.assign(f,d),f})}}async generateContentStreamInternal(t){var e,n;let i,l="",u={};if(this.apiClient.isVertexAI()){const a=rt(this.apiClient,t);l=v("{model}:streamGenerateContent?alt=sse",a._url),u=a._query,delete a.config,delete a._url,delete a._query;const c=this.apiClient;return i=c.requestStream({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions}),i.then(function(d){return ie(this,arguments,function*(){var f,p,h,m;try{for(var g=!0,y=pe(d),E;E=yield x(y.next()),f=E.done,!f;g=!0){m=E.value,g=!1;const C=lt(c,m),I=new X;Object.assign(I,C),yield yield x(I)}}catch(T){p={error:T}}finally{try{!g&&!f&&(h=y.return)&&(yield x(h.call(y)))}finally{if(p)throw p.error}}})})}else{const a=it(this.apiClient,t);l=v("{model}:streamGenerateContent?alt=sse",a._url),u=a._query,delete a.config,delete a._url,delete a._query;const c=this.apiClient;return i=c.requestStream({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions}),i.then(function(d){return ie(this,arguments,function*(){var f,p,h,m;try{for(var g=!0,y=pe(d),E;E=yield x(y.next()),f=E.done,!f;g=!0){m=E.value,g=!1;const C=st(c,m),I=new X;Object.assign(I,C),yield yield x(I)}}catch(T){p={error:T}}finally{try{!g&&!f&&(h=y.return)&&(yield x(h.call(y)))}finally{if(p)throw p.error}}})})}}async embedContent(t){var e,n;let i,l="",u={};if(this.apiClient.isVertexAI()){const a=Vo(this.apiClient,t);return l=v("{model}:predict",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions}).then(c=>c.json()),i.then(c=>{const d=ci(this.apiClient,c),f=new Ze;return Object.assign(f,d),f})}else{const a=po(this.apiClient,t);return l=v("{model}:batchEmbedContents",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions}).then(c=>c.json()),i.then(c=>{const d=Xo(this.apiClient,c),f=new Ze;return Object.assign(f,d),f})}}async generateImagesInternal(t){var e,n;let i,l="",u={};if(this.apiClient.isVertexAI()){const a=qo(this.apiClient,t);return l=v("{model}:predict",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions}).then(c=>c.json()),i.then(c=>{const d=pi(this.apiClient,c),f=new je;return Object.assign(f,d),f})}else{const a=ho(this.apiClient,t);return l=v("{model}:predict",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions}).then(c=>c.json()),i.then(c=>{const d=Zo(this.apiClient,c),f=new je;return Object.assign(f,d),f})}}async countTokens(t){var e,n;let i,l="",u={};if(this.apiClient.isVertexAI()){const a=ko(this.apiClient,t);return l=v("{model}:countTokens",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions}).then(c=>c.json()),i.then(c=>{const d=mi(this.apiClient,c),f=new et;return Object.assign(f,d),f})}else{const a=yo(this.apiClient,t);return l=v("{model}:countTokens",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions}).then(c=>c.json()),i.then(c=>{const d=jo(this.apiClient,c),f=new et;return Object.assign(f,d),f})}}async computeTokens(t){var e;let n,i="",l={};if(this.apiClient.isVertexAI()){const u=Bo(this.apiClient,t);return i=v("{model}:computeTokens",u._url),l=u._query,delete u.config,delete u._url,delete u._query,n=this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions}).then(a=>a.json()),n.then(a=>{const c=hi(this.apiClient,a),d=new wn;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideos(t){var e,n;let i,l="",u={};if(this.apiClient.isVertexAI()){const a=$o(this.apiClient,t);return l=v("{model}:predictLongRunning",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions}).then(c=>c.json()),i.then(c=>Ei(this.apiClient,c))}else{const a=To(this.apiClient,t);return l=v("{model}:predictLongRunning",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions}).then(c=>c.json()),i.then(c=>oi(this.apiClient,c))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Oi(o,t){const e={},n=s(t,["operationName"]);n!=null&&r(e,["_url","operationName"],n);const i=s(t,["config"]);return i!=null&&r(e,["config"],i),e}function $i(o,t){const e={},n=s(t,["operationName"]);n!=null&&r(e,["_url","operationName"],n);const i=s(t,["config"]);return i!=null&&r(e,["config"],i),e}function Yi(o,t){const e={},n=s(t,["operationName"]);n!=null&&r(e,["operationName"],n);const i=s(t,["resourceName"]);i!=null&&r(e,["_url","resourceName"],i);const l=s(t,["config"]);return l!=null&&r(e,["config"],l),e}function Ki(o,t){const e={},n=s(t,["video","uri"]);n!=null&&r(e,["uri"],n);const i=s(t,["video","encodedVideo"]);i!=null&&r(e,["videoBytes"],k(o,i));const l=s(t,["encoding"]);return l!=null&&r(e,["mimeType"],l),e}function Wi(o,t){const e={},n=s(t,["_self"]);return n!=null&&r(e,["video"],Ki(o,n)),e}function Ji(o,t){const e={},n=s(t,["generatedSamples"]);n!=null&&(Array.isArray(n)?r(e,["generatedVideos"],n.map(u=>Wi(o,u))):r(e,["generatedVideos"],n));const i=s(t,["raiMediaFilteredCount"]);i!=null&&r(e,["raiMediaFilteredCount"],i);const l=s(t,["raiMediaFilteredReasons"]);return l!=null&&r(e,["raiMediaFilteredReasons"],l),e}function zi(o,t){const e={},n=s(t,["name"]);n!=null&&r(e,["name"],n);const i=s(t,["metadata"]);i!=null&&r(e,["metadata"],i);const l=s(t,["done"]);l!=null&&r(e,["done"],l);const u=s(t,["error"]);u!=null&&r(e,["error"],u);const a=s(t,["response"]);a!=null&&r(e,["response"],a);const c=s(t,["response","generateVideoResponse"]);return c!=null&&r(e,["result"],Ji(o,c)),e}function Xi(o,t){const e={},n=s(t,["gcsUri"]);n!=null&&r(e,["uri"],n);const i=s(t,["bytesBase64Encoded"]);i!=null&&r(e,["videoBytes"],k(o,i));const l=s(t,["mimeType"]);return l!=null&&r(e,["mimeType"],l),e}function bi(o,t){const e={},n=s(t,["_self"]);return n!=null&&r(e,["video"],Xi(o,n)),e}function Qi(o,t){const e={},n=s(t,["videos"]);n!=null&&(Array.isArray(n)?r(e,["generatedVideos"],n.map(u=>bi(o,u))):r(e,["generatedVideos"],n));const i=s(t,["raiMediaFilteredCount"]);i!=null&&r(e,["raiMediaFilteredCount"],i);const l=s(t,["raiMediaFilteredReasons"]);return l!=null&&r(e,["raiMediaFilteredReasons"],l),e}function at(o,t){const e={},n=s(t,["name"]);n!=null&&r(e,["name"],n);const i=s(t,["metadata"]);i!=null&&r(e,["metadata"],i);const l=s(t,["done"]);l!=null&&r(e,["done"],l);const u=s(t,["error"]);u!=null&&r(e,["error"],u);const a=s(t,["response"]);a!=null&&r(e,["response"],a);const c=s(t,["response"]);return c!=null&&r(e,["result"],Qi(o,c)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Zi extends ue{constructor(t){super(),this.apiClient=t}async get(t){const e=t.operation,n=t.config;if(e.name===void 0||e.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const l=e.name.split("/operations/")[0];var i=void 0;return n&&"httpOptions"in n&&(i=n.httpOptions),this.fetchPredictVideosOperationInternal({operationName:e.name,resourceName:l,config:{httpOptions:i}})}else return this.getVideosOperationInternal({operationName:e.name,config:n})}async getVideosOperationInternal(t){var e,n;let i,l="",u={};if(this.apiClient.isVertexAI()){const a=$i(this.apiClient,t);return l=v("{operationName}",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions}).then(c=>c.json()),i.then(c=>at(this.apiClient,c))}else{const a=Oi(this.apiClient,t);return l=v("{operationName}",a._url),u=a._query,delete a.config,delete a._url,delete a._query,i=this.apiClient.request({path:l,queryParams:u,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions}).then(c=>c.json()),i.then(c=>zi(this.apiClient,c))}}async fetchPredictVideosOperationInternal(t){var e;let n,i="",l={};if(this.apiClient.isVertexAI()){const u=Yi(this.apiClient,t);return i=v("{resourceName}:fetchPredictOperation",u._url),l=u._query,delete u.config,delete u._url,delete u._query,n=this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions}).then(a=>a.json()),n.then(a=>at(this.apiClient,a))}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const ji="Content-Type",er="User-Agent",tr="x-goog-api-client",nr="0.7.0",or=`google-genai-sdk/${nr}`,ir="v1beta1",rr="v1beta",ut=/^data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class sr extends Error{constructor(t,e){e?super(t,{cause:e}):super(t,{cause:new Error().stack}),this.message=t,this.name="ClientError"}}class ct extends Error{constructor(t,e){e?super(t,{cause:e}):super(t,{cause:new Error().stack}),this.message=t,this.name="ServerError"}}class lr{constructor(t){var e,n;this.clientOptions=Object.assign(Object.assign({},t),{project:t.project,location:t.location,apiKey:t.apiKey,vertexai:t.vertexai});const i={};this.clientOptions.vertexai?(i.apiVersion=(e=this.clientOptions.apiVersion)!==null&&e!==void 0?e:ir,this.getProject()||this.getLocation()?(i.baseUrl=`https://${this.clientOptions.location}-aiplatform.googleapis.com/`,this.clientOptions.apiKey=void 0):(i.baseUrl="https://aiplatform.googleapis.com/",this.clientOptions.project=void 0,this.clientOptions.location=void 0)):(i.apiVersion=(n=this.clientOptions.apiVersion)!==null&&n!==void 0?n:rr,i.baseUrl="https://generativelanguage.googleapis.com/"),i.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=i,t.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(i,t.httpOptions))}isVertexAI(){var t;return(t=this.clientOptions.vertexai)!==null&&t!==void 0?t:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(t){if(!t||t.baseUrl===void 0||t.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const n=[t.baseUrl.endsWith("/")?t.baseUrl.slice(0,-1):t.baseUrl];return t.apiVersion&&t.apiVersion!==""&&n.push(t.apiVersion),n.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const t=this.getBaseUrl(),e=new URL(t);return e.protocol="wss",e.toString()}setBaseUrl(t){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=t;else throw new Error("HTTP options are not correctly set.")}constructUrl(t,e){const n=[this.getRequestUrlInternal(e)];return this.clientOptions.vertexai&&!this.clientOptions.apiKey&&!t.startsWith("projects/")&&n.push(this.getBaseResourcePath()),t!==""&&n.push(t),new URL(`${n.join("/")}`)}async request(t){let e=this.clientOptions.httpOptions;t.httpOptions&&(e=this.patchHttpOptions(this.clientOptions.httpOptions,t.httpOptions));const n=this.constructUrl(t.path,e);if(t.queryParams)for(const[l,u]of Object.entries(t.queryParams))n.searchParams.append(l,String(u));let i={};if(t.httpMethod==="GET"){if(t.body&&t.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else i.body=t.body;return i=await this.includeExtraHttpOptionsToRequestInit(i,e),this.unaryApiCall(n,i,t.httpMethod)}patchHttpOptions(t,e){const n=JSON.parse(JSON.stringify(t));for(const[i,l]of Object.entries(e))typeof l=="object"?n[i]=Object.assign(Object.assign({},n[i]),l):l!==void 0&&(n[i]=l);return n}async requestStream(t){let e=this.clientOptions.httpOptions;t.httpOptions&&(e=this.patchHttpOptions(this.clientOptions.httpOptions,t.httpOptions));const n=this.constructUrl(t.path,e);(!n.searchParams.has("alt")||n.searchParams.get("alt")!=="sse")&&n.searchParams.set("alt","sse");let i={};return i.body=t.body,i=await this.includeExtraHttpOptionsToRequestInit(i,e),this.streamApiCall(n,i,t.httpMethod)}async includeExtraHttpOptionsToRequestInit(t,e){if(e&&e.timeout&&e.timeout>0){const n=new AbortController,i=n.signal;setTimeout(()=>n.abort(),e.timeout),t.signal=i}return t.headers=await this.getHeadersInternal(e),t}async unaryApiCall(t,e,n){return this.apiCall(t.toString(),Object.assign(Object.assign({},e),{method:n})).then(async i=>(await dt(i),new At(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}async streamApiCall(t,e,n){return this.apiCall(t.toString(),Object.assign(Object.assign({},e),{method:n})).then(async i=>(await dt(i),this.processStreamResponse(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}processStreamResponse(t){var e;return ie(this,arguments,function*(){const i=(e=t==null?void 0:t.body)===null||e===void 0?void 0:e.getReader(),l=new TextDecoder("utf-8");if(!i)throw new Error("Response body is empty");try{let u="";for(;;){const{done:a,value:c}=yield x(i.read());if(a){if(u.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const d=l.decode(c);u+=d;let f=u.match(ut);for(;f;){const p=f[1];try{const h=JSON.parse(p);yield yield x(h),u=u.slice(f[0].length),f=u.match(ut)}catch(h){throw new Error(`exception parsing stream chunk ${p}. ${h}`)}}}}finally{i.releaseLock()}})}async apiCall(t,e){return fetch(t,e).catch(n=>{throw new Error(`exception ${n} sending request`)})}getDefaultHeaders(){const t={},e=or+" "+this.clientOptions.userAgentExtra;return t[er]=e,t[tr]=e,t[ji]="application/json",t}async getHeadersInternal(t){const e=new Headers;if(t&&t.headers)for(const[n,i]of Object.entries(t.headers))e.append(n,i);return await this.clientOptions.auth.addAuthHeaders(e),e}async uploadFile(t,e){var n;const i={};e!=null&&(i.mimeType=e.mimeType,i.name=e.name,i.displayName=e.displayName),i.name&&!i.name.startsWith("files/")&&(i.name=`files/${i.name}`);const l=this.clientOptions.uploader,u=await l.stat(t);i.sizeBytes=String(u.size);const a=(n=e==null?void 0:e.mimeType)!==null&&n!==void 0?n:u.type;if(a===void 0||a==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");i.mimeType=a;const c=await this.fetchUploadUrl(i,e);return l.upload(t,c,this)}async fetchUploadUrl(t,e){var n;let i={};e!=null&&e.httpOptions?i=e.httpOptions:i={apiVersion:"",headers:{"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${t.sizeBytes}`,"X-Goog-Upload-Header-Content-Type":`${t.mimeType}`}};const l={file:t},u=await this.request({path:v("upload/v1beta/files",l._url),body:JSON.stringify(l),httpMethod:"POST",httpOptions:i});if(!u||!(u!=null&&u.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const a=(n=u==null?void 0:u.headers)===null||n===void 0?void 0:n["x-goog-upload-url"];if(a===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return a}}async function dt(o){var t;if(o===void 0)throw new ct("response is undefined");if(!o.ok){const e=o.status,n=o.statusText;let i;!((t=o.headers.get("content-type"))===null||t===void 0)&&t.includes("application/json")?i=await o.json():i={error:{message:"exception parsing response",code:o.status,status:o.statusText}};const l=`got status: ${e} ${n}. ${JSON.stringify(i)}`;throw e>=400&&e<500?new sr(l):e>=500&&e<600?new ct(l):new Error(l)}}const ar=1024*1024*8;async function ur(o,t,e){var n,i;let l=0,u=0,a=new At(new Response),c="upload";for(l=o.size;u<l;){const f=Math.min(ar,l-u),p=o.slice(u,u+f);if(u+f>=l&&(c+=", finalize"),a=await e.request({path:"",body:p,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:t,headers:{"X-Goog-Upload-Command":c,"X-Goog-Upload-Offset":String(u),"Content-Length":String(f)}}}),u+=f,((n=a==null?void 0:a.headers)===null||n===void 0?void 0:n["x-goog-upload-status"])!=="active")break;if(l<=u)throw new Error("All content has been uploaded, but the upload status is not finalized.")}const d=await(a==null?void 0:a.json());if(((i=a==null?void 0:a.headers)===null||i===void 0?void 0:i["x-goog-upload-status"])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return d.file}async function cr(o){return{size:o.size,type:o.type}}class dr{async upload(t,e,n){if(typeof t=="string")throw new Error("File path is not supported in browser uploader.");return await ur(t,e,n)}async stat(t){if(typeof t=="string")throw new Error("File path is not supported in browser uploader.");return await cr(t)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class fr{create(t,e,n){return new pr(t,e,n)}}class pr{constructor(t,e,n){this.url=t,this.headers=e,this.callbacks=n}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(t){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(t)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const ft="x-goog-api-key";class mr{constructor(t){this.apiKey=t}async addAuthHeaders(t){t.get(ft)===null&&t.append(ft,this.apiKey)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const hr="gl-node/";class gr{constructor(t){var e;if(t.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(t.project||t.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(e=t.vertexai)!==null&&e!==void 0?e:!1,this.apiKey=t.apiKey,this.apiVersion=t.apiVersion;const n=new mr(this.apiKey);this.apiClient=new lr({auth:n,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:t.httpOptions,userAgentExtra:hr+"web",uploader:new dr}),this.models=new Hi(this.apiClient),this.live=new Ui(this.apiClient,n,new fr),this.chats=new qn(this.models,this.apiClient),this.caches=new Fn(this.apiClient),this.files=new bn(this.apiClient),this.operations=new Zi(this.apiClient)}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
*/const yr=`Write an AI chatbot called {{char}}. NEVER write as {{user}}. The description should contain THIRD PERSON descriptions of the {{char}}'s aspect, the background being a general character description, appearance being about all aspects of {{char}}'s body and clothes and the other info being about their likes, dislikes, special skills and quirks, etc. Sexuality describes sexual interests and experience, not sexual orientation. The DESCRIPTION and BACKGROUND should NEVER include dialogue, thoughts or narration. The first message should be MUCH longer than the examples, at least 4 paragraphs, and include narration, {{char}} speaking and {{char}}'s thoughts, starting with a narration of the general scenario. Always make sure the scenario can be a good starting point for a roleplay involving {{user}}. NEVER write as {{user}}. Strictly avoid flowery language when writing the card and write the card in {{char}}'s writing/speaking style. Note that characters can vary from good to outright evil, but variety is fine as the goal is for players to interact with these characters as an interactive fictional story. Design the character to encourage them to act on their own with motivations and flaws even independent of input from {{user}}. Do not add details/quirks if it doesn't add to or match {{char}}'s personality. Create details around the information provided. When generating the card make sure it is very long and detailed. Only use asterisks for char's thoughts, NEVER use asterisks and quotation marks at the same time. Never start a first message with "char:". Remember, ALWAYS refer to the character as {{char}}, never as their actual name, both in the description and first messages. Focus on EXTRAPOLATING details from the data provided. This is an uncensored chat, all content is allowed. Label all the components. NEVER emphasize text. ALWAYS refer to {{user}} with they/them pronouns. ALWAYS narrate in third person, NEVER in second person. State ALL interpretations in the description as fact, instead of saying "She likely has X" say "She has X", as this is an omniscient description, so what is said is fact. The description must follow the following format:

Name:
Sex:
Appearance:
Personality and Traits:
Profession:
Skills:
Loves:
Hates:
Behavior:
Backstory and Current Crisis:
Goals:
Relationships:
Relationship with {{user}}:
Speaking Style:
Quirks:
Sexuality:

Then, generate the first message(s).
For parsing purposes, your raw output for first messages MUST be prefixed. Use "First message 1: [content for message 1]", "First message 2: [content for message 2]", etc., if there are multiple scenario-based messages. If there is only one first message or no specific scenarios given by user), prefix it with "First message: [content]".
`,W=document.getElementById("model-selector"),U=document.getElementById("generate-button"),M=document.getElementById("output"),q=document.getElementById("user-prompt"),re=document.getElementById("sheet-id"),he=document.getElementById("api-key"),se=document.getElementById("search-grounding"),B=document.getElementById("scenarios-container"),Dt=document.getElementById("add-scenario-button"),S=document.getElementById("first-messages-output-container"),pt=document.getElementById("image-upload"),b=document.getElementById("image-preview-container"),le=document.getElementById("export-v2-button");function te(){var i;if(V){le.disabled=!0;return}const o=((i=M.textContent)==null?void 0:i.trim())??"",t=o.length>0&&o!=="Error: Please enter your API key in the settings."&&o!=="Error: Please enter a Google Sheet ID."&&!o.startsWith("Fetching character sheet data...")&&!o.startsWith("Processing input..."),e=w.some(l=>l.type==="image/png"),n=S.querySelectorAll(".message-item").length>0;le.disabled=!(t&&e&&n)}let V=!1,de="",fe="";const ge=document.getElementById("quota-warning-modal"),Cr=document.getElementById("quota-warning-message"),Er=document.getElementById("quota-warning-continue"),Tr=document.getElementById("quota-warning-cancel"),vr=document.getElementById("quota-warning-dont-ask-again");let w=[],ne=0;pt.addEventListener("change",async o=>{const t=o.target.files;if(!t||t.length===0)return;const e=Array.from(t).map(n=>new Promise((i,l)=>{if(!n.type.startsWith("image/")&&!n.type.startsWith("video/")){console.warn(`File "${n.name}" is not an image or video and will be skipped.`),i(null);return}const u=new FileReader;u.onload=a=>{var d;const c=(d=a.target)==null?void 0:d.result;c?i({data:c.split(",")[1],type:n.type,name:n.name}):(console.warn(`Could not read file "${n.name}".`),i(null))},u.onerror=a=>{console.error(`Error reading file "${n.name}":`,a),l(a)},u.readAsDataURL(n)}));try{const n=(await Promise.all(e)).filter(i=>i!==null);n.length>0&&(w.push(...n),J(),ve(n.length))}catch(n){console.error("An error occurred while processing uploaded files:",n)}pt.value=""});function J(){b.innerHTML="",w.length===0?b.style.display="none":(b.style.display="flex",w.forEach((o,t)=>{const e=document.createElement("div");e.className="image-preview-wrapper";const n=`data:${o.type};base64,${o.data}`;let i;if(o.type.startsWith("image/"))i=document.createElement("img"),i.src=n;else if(o.type.startsWith("video/"))i=document.createElement("video"),i.src=n,i.autoplay=!0,i.muted=!0,i.loop=!0;else return;i.className="image-preview",i.title=o.name;const l=document.createElement("button");l.textContent="X",l.className="remove-image-button",l.title="Remove image",l.onclick=()=>{Ir(t)},e.appendChild(i),e.appendChild(l),b.appendChild(e)})),te()}function Ir(o){w.splice(o,1),ve(0),J()}function Ft(o=""){const t=document.createElement("div");t.classList.add("scenario-item");const e=document.createElement("textarea");e.placeholder=`Scenario ${B.querySelectorAll(".scenario-item").length+1}`,e.value=o,e.addEventListener("input",()=>{e.style.height="auto",e.style.height=`${e.scrollHeight}px`,mt()});const n=document.createElement("button");n.textContent="-",n.type="button",n.addEventListener("click",()=>{_r(t),mt()}),t.appendChild(e),t.appendChild(n),B.insertBefore(t,Dt),e.dispatchEvent(new Event("input",{bubbles:!0}))}function _r(o){B.removeChild(o),B.querySelectorAll(".scenario-item textarea").forEach((e,n)=>{e.placeholder=`Scenario ${n+1}`})}Dt.addEventListener("click",()=>Ft());const Lt="character-card-sheet-id",Vt="character-card-user-prompt",Ut="character-card-output",qt="character-card-model-selector",Gt="character-card-api-key",kt="character-card-search-grounding",ye="character-card-scenarios",Ce="character-card-images",Bt="character-card-quota-warning-dont-ask-again";function ve(o=0){try{localStorage.setItem(Ce,JSON.stringify(w))}catch(t){if(console.error("Failed to save images to localStorage. The file might be too large.",t),o>0){if(ne=o,localStorage.getItem(Bt)==="true"){console.warn("A file was too large to save to localStorage, but the user has opted out of warnings.");return}Cr.textContent="Adding the new file(s) exceeds the browser's storage limit and they will not be saved on reload.",ge.style.display="flex"}}}function mt(){const o=B.querySelectorAll(".scenario-item textarea"),t=Array.from(o).map(e=>e.value);localStorage.setItem(ye,JSON.stringify(t))}function Ar(){const o=localStorage.getItem(qt);o&&Array.from(W.options).some(a=>a.value===o)&&(W.value=o);const t=localStorage.getItem(Lt);t&&(re.value=t);const e=localStorage.getItem(kt);e&&(se.checked=e==="true");const n=localStorage.getItem(Vt);n&&(q.value=n,q.dispatchEvent(new Event("input",{bubbles:!0})));const i=localStorage.getItem(Ce);if(i)try{w=JSON.parse(i).map(c=>({data:c.data||"",type:c.type||"image/png",name:c.name||"unknown_file"})),Array.isArray(w)?J():w=[]}catch(a){console.error("Failed to parse saved images:",a),w=[],localStorage.removeItem(Ce)}const l=localStorage.getItem(ye);if(l)try{const a=JSON.parse(l);Array.isArray(a)&&a.forEach(c=>Ft(c))}catch(a){console.error("Failed to parse saved scenarios:",a),localStorage.removeItem(ye)}B.querySelectorAll(".scenario-item").length;const u=localStorage.getItem(Ut);u&&Ht(u),J(),he.value=""}function Sr(){Tr.addEventListener("click",()=>{ge.style.display="none",ne>0?(w.splice(-ne),ne=0):w.pop(),J(),ve(0)}),Er.addEventListener("click",()=>{vr.checked&&localStorage.setItem(Bt,"true"),ge.style.display="none"})}W.addEventListener("change",()=>localStorage.setItem(qt,W.value));se.addEventListener("change",()=>localStorage.setItem(kt,String(se.checked)));he.addEventListener("input",()=>{localStorage.setItem(Gt,he.value)});re.addEventListener("input",()=>localStorage.setItem(Lt,re.value));document.addEventListener("keydown",o=>{o.ctrlKey&&o.key==="Enter"&&(o.preventDefault(),U.click())});q.addEventListener("input",()=>{localStorage.setItem(Vt,q.value),q.style.height="auto",q.style.height=`${q.scrollHeight}px`});U.addEventListener("click",async()=>{if(V){if(V=!1,U.innerText="Generate Character Card",U.style.backgroundColor="",M.innerHTML=de,S.innerHTML=fe,de){const a=M.textContent||"",c=ae(a);M.appendChild(c)}fe?(S.style.display="block",S.querySelectorAll(".message-item").forEach(c=>{const d=c.querySelector(".message-content");if(d){const f=ae(d.textContent||"");d.appendChild(f)}})):S.style.display="none",te();return}V=!0,te(),de=M.innerHTML,fe=S.innerHTML;const o=W.value,t=q.value,e=re.value,n=localStorage.getItem(Gt);if(!n){M.textContent="Error: Please enter your API key in the settings.",V=!1;return}if(!e){M.textContent="Error: Please enter a Google Sheet ID.",V=!1;return}const i=new gr({apiKey:n}),l=`https://docs.google.com/spreadsheets/d/${e}/gviz/tq?tqx=out:csv`;let u=!1;U.innerText="Cancel",U.style.backgroundColor="red",M.textContent="Fetching character sheet data...",S.innerHTML="<h2>First Messages</h2>";try{const a=await fetch(l);if(!a.ok)throw new Error(`Network response was not ok. Status: ${a.status}. Make sure the Google Sheet is public.`);if(!V)return;const d=(await a.text()).replace(/"/g,"");M.textContent="Processing input...";let f="";B.querySelectorAll(".scenario-item textarea").forEach((A,N)=>{const R=A.value.trim();R&&(f+=`Scenario ${N+1}: ${R}
`)});const h=`Generate a complete character card and first message(s) based on the provided scenarios.
    
    User-provided context:
    ${t||"No additional context provided."}
    
    ${f?`Scenarios:
${f}`:"No specific scenarios provided. Generate three unique first messages."}

    Reference character data from sheet:
    ${d}
    `;let m=yr;f?m+=`

The user has provided specific scenarios. Ensure each "First message N:" corresponds to one of the provided scenarios.`:m+=`

Generate three detailed first messages, starting with "First message N:".`;const g=[...w.map(A=>({inlineData:{mimeType:A.type,data:A.data}})),{text:h}],E={safetySettings:[{category:"HARM_CATEGORY_HARASSMENT",threshold:"OFF"},{category:"HARM_CATEGORY_HATE_SPEECH",threshold:"OFF"},{category:"HARM_CATEGORY_SEXUALLY_EXPLICIT",threshold:"OFF"},{category:"HARM_CATEGORY_DANGEROUS_CONTENT",threshold:"OFF"},{category:"HARM_CATEGORY_CIVIC_INTEGRITY",threshold:"BLOCK_NONE"}],systemInstruction:m};se.checked&&(E.tools=[{googleSearch:{}}]);const C=await i.chats.create({model:o,config:E}).sendMessageStream({message:g});let I="";M.textContent="",S.innerHTML="<h2>First Messages</h2>";for await(const A of C){if(!V)break;I+=A.text,M.textContent=I}V&&Ht(I)}catch(a){u=!0,console.error(a),M.textContent=`Error: ${a instanceof Error?a.message:"An unknown error occurred."}`,S.innerHTML="<h2>First Messages</h2>"}finally{const a=V;V=!1,U.innerText="Generate Character Card",U.style.backgroundColor="";const c=Mr();c&&!u&&a&&localStorage.setItem(Ut,c),te()}});function Mr(){let o=M.textContent||"";const t=S.querySelectorAll(".message-item");if(t.length>0){o.length>0&&o.trim()!==""&&(o+=`

`);const e=[];t.forEach(n=>{const i=n.querySelector(".message-label"),l=n.querySelector(".message-content");let u="";i&&i.textContent&&(u+=i.textContent+`
`),l&&l.textContent&&(u+=l.textContent),u.trim()!==""&&e.push(u.trim())}),o+=e.join(`

`)}return o.trim()}function ae(o){const t=document.createElement("button");t.className="copy-button",t.title="Copy to clipboard";const e=document.createElement("img");return e.src="icons/copy.svg",e.alt="Copy",t.appendChild(e),t.addEventListener("click",()=>{navigator.clipboard.writeText(o).then(()=>{t.classList.add("copied"),setTimeout(()=>{t.classList.remove("copied")},2e3)}).catch(n=>{console.error("Failed to copy text: ",n)})}),t}function Ht(o){const t=document.querySelector(".output-container");M.textContent="",t.style.position="relative",S.innerHTML=" <h2>First Messages</h2>",S.style.display="none";let e=o,n="";const i=o.match(/First message[ 1]*:/i);if(i&&typeof i.index=="number"){const l=i.index;e=o.substring(0,l).trim(),n=o.substring(l).trim()}else e=o.trim(),n="";if(e){M.textContent=e;const l=ae(e);M.appendChild(l)}if(n){const l=/First message(?:\s+(\d+))?:([\s\S]*?)(?=First message(?:\s+\d+)?:|$)/gi;let u=0,a;for(;(a=l.exec(n))!==null;){const c=a[1];let d=a[2].trim(),f=c?`First message ${c}:`:"First message:";if(d){const p=document.createElement("details");p.setAttribute("open",""),p.classList.add("message-item"),p.style.position="relative";const h=document.createElement("summary");h.classList.add("message-label"),h.textContent=f;const m=document.createElement("pre");m.classList.add("message-content"),m.textContent=d;const g=ae(d);p.appendChild(h),m.appendChild(g),p.appendChild(m),S.appendChild(p),u++}}u>0&&(S.style.display="block")}S.querySelectorAll(".message-item").length>0?S.style.display="block":S.style.display="none"}const Rr=function(){const o=new Uint32Array(256);for(let t=0;t<256;t++){let e=t;for(let n=0;n<8;n++)e=e&1?3988292384^e>>>1:e>>>1;o[t]=e}return function(t){let e=-1;for(let n=0;n<t.length;n++)e=e>>>8^o[(e^t[n])&255];return(e^-1)>>>0}}();function xr(o,t){const e=new TextEncoder().encode(o),n=new TextEncoder().encode(t),i=new Uint8Array([116,69,88,116]),l=new Uint8Array(e.length+1+n.length);l.set(e,0),l.set([0],e.length),l.set(n,e.length+1);const u=new Uint8Array(4);new DataView(u.buffer).setUint32(0,l.length,!1);const a=new Uint8Array(i.length+l.length);a.set(i,0),a.set(l,i.length);const c=new Uint8Array(4);new DataView(c.buffer).setUint32(0,Rr(a),!1);const d=new Uint8Array(8+l.length+4);return d.set(u,0),d.set(i,4),d.set(l,8),d.set(c,8+l.length),d}function wr(o){return new Promise((t,e)=>{const n=new Image;n.onload=()=>{const i=document.createElement("canvas");i.width=n.width,i.height=n.height;const l=i.getContext("2d");if(!l)return e(new Error("Could not get canvas context"));l.drawImage(n,0,0);const u=i.toDataURL("image/png");t(u.split(",")[1])},n.onerror=()=>{e(new Error("Failed to load image for re-encoding."))},n.src=`data:${o.type};base64,${o.data}`})}async function Pr(){var d;if(le.disabled)return;const o=((d=M.textContent)==null?void 0:d.trim())??"",t=S.querySelectorAll(".message-item .message-content"),e=Array.from(t).map(f=>{var p;return((p=f.textContent)==null?void 0:p.trim())??""}),n=w.find(f=>f.type==="image/png");if(!n||!o||e.length===0){console.error("Not enough data to export V2 card."),alert("Export failed. Make sure you have a description, first message, and at least one PNG image uploaded.");return}const i=o.match(/^Name:\s*(.*"(.*)"|([a-zA-Z]+))/),l=i?(i[2]||i[3]).trim():"Character",u=e.slice(1),a={spec:"chara_card_v2",spec_version:"2.0",data:{name:l,description:o,personality:"",scenario:"",first_mes:e[0],mes_example:"",creator_notes:"",system_prompt:"",post_history_instructions:"",alternate_greetings:u,tags:[],creator:"",character_version:"",extensions:{}}},c=btoa(unescape(encodeURIComponent(JSON.stringify(a))));try{const f=await wr(n),p=Uint8Array.from(atob(f),C=>C.charCodeAt(0));let h=-1;for(let C=p.length-8;C>=4;C--)if(p[C]===73&&p[C+1]===69&&p[C+2]===78&&p[C+3]===68){h=C-4;break}if(h===-1){console.error("Could not find IEND chunk in the re-encoded image. This should not happen."),alert("An unexpected error occurred while creating the character card. Could not find IEND chunk.");return}const m=xr("chara",c),g=new Uint8Array(p.length+m.length);g.set(p.subarray(0,h),0),g.set(m,h),g.set(p.subarray(h),h+m.length);const y=new Blob([g],{type:"image/png"}),E=URL.createObjectURL(y),T=document.createElement("a");T.href=E,T.download=`${a.data.name.replace(/[^a-z0-9]/gi,"_")}.png`,document.body.appendChild(T),T.click(),document.body.removeChild(T),URL.revokeObjectURL(E)}catch(f){console.error("Failed to export V2 card:",f),alert(`An error occurred during export: ${f instanceof Error?f.message:"Unknown error"}`)}}le.addEventListener("click",Pr);Sr();Ar();
