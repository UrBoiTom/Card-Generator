(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function e(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(i){if(i.ep)return;i.ep=!0;const a=e(i);fetch(i.href,a)}})();/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ve{}function v(o,t){const e=/\{([^}]+)\}/g;return o.replace(e,(n,i)=>{if(Object.prototype.hasOwnProperty.call(t,i)){const a=t[i];return a!=null?String(a):""}else throw new Error(`Key '${i}' not found in valueMap.`)})}function r(o,t,e){for(let a=0;a<t.length-1;a++){const l=t[a];if(l.endsWith("[]")){const u=l.slice(0,-2);if(!(u in o))if(Array.isArray(e))o[u]=Array.from({length:e.length},()=>({}));else throw new Error(`Value must be a list given an array path ${l}`);if(Array.isArray(o[u])){const c=o[u];if(Array.isArray(e))for(let d=0;d<c.length;d++){const f=c[d];r(f,t.slice(a+1),e[d])}else for(const d of c)r(d,t.slice(a+1),e)}return}else if(l.endsWith("[0]")){const u=l.slice(0,-3);u in o||(o[u]=[{}]);const c=o[u];r(c[0],t.slice(a+1),e);return}(!o[l]||typeof o[l]!="object")&&(o[l]={}),o=o[l]}const n=t[t.length-1],i=o[n];if(i!==void 0){if(!e||typeof e=="object"&&Object.keys(e).length===0||e===i)return;if(typeof i=="object"&&typeof e=="object"&&i!==null&&e!==null)Object.assign(i,e);else throw new Error(`Cannot set value for an existing key. Key: ${n}`)}else o[n]=e}function s(o,t){try{if(t.length===1&&t[0]==="_self")return o;for(let e=0;e<t.length;e++){if(typeof o!="object"||o===null)return;const n=t[e];if(n.endsWith("[]")){const i=n.slice(0,-2);if(i in o){const a=o[i];return Array.isArray(a)?a.map(l=>s(l,t.slice(e+1))):void 0}else return}else o=o[n]}return o}catch(e){if(e instanceof TypeError)return;throw e}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function F(o,t){if(!t||typeof t!="string")throw new Error("model is required and must be a string");if(o.isVertexAI()){if(t.startsWith("publishers/")||t.startsWith("projects/")||t.startsWith("models/"))return t;if(t.indexOf("/")>=0){const e=t.split("/",2);return`publishers/${e[0]}/models/${e[1]}`}else return`publishers/google/models/${t}`}else return t.startsWith("models/")||t.startsWith("tunedModels/")?t:`models/${t}`}function Xt(o,t){const e=F(o,t);return e?e.startsWith("publishers/")&&o.isVertexAI()?`projects/${o.getProject()}/locations/${o.getLocation()}/${e}`:e.startsWith("models/")&&o.isVertexAI()?`projects/${o.getProject()}/locations/${o.getLocation()}/publishers/google/${e}`:e:""}function je(o,t){if(t==null)throw new Error("PartUnion is required");if(typeof t=="object")return t;if(typeof t=="string")return{text:t};throw new Error(`Unsupported part type: ${typeof t}`)}function te(o,t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("PartListUnion is required");return Array.isArray(t)?t.map(e=>je(o,e)):[je(o,t)]}function Qt(o){return o!=null&&typeof o=="object"&&"parts"in o&&Array.isArray(o.parts)}function xn(o){return o!=null&&typeof o=="object"&&"functionCall"in o}function ke(o){return!(o==null||xn(o))}function Zt(o){return o==null||Array.isArray(o)&&o.length===0?!1:o.every(ke)}function q(o,t){if(t==null)throw new Error("ContentUnion is required");return Qt(t)?t:ke(t)?{role:"user",parts:te(o,t)}:{role:"model",parts:te(o,t)}}function jt(o,t){if(!t)return[];if(o.isVertexAI()&&Array.isArray(t))return t.flatMap(e=>{const n=q(o,e);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]});if(o.isVertexAI()){const e=q(o,t);return e.parts&&e.parts.length>0&&e.parts[0].text!==void 0?[e.parts[0].text]:[]}return Array.isArray(t)?t.map(e=>q(o,e)):[q(o,t)]}function ue(o,t,e){e.length!==0&&(Zt(e)?t.push({role:"user",parts:te(o,e)}):t.push({role:"model",parts:te(o,e)}),e.length=0)}function Rn(o,t,e,n){ke(n)===Zt(e)||(ue(o,t,e),e.length=0),e.push(n)}function S(o,t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("contents are required");if(!Array.isArray(t))return[q(o,t)];const e=[],n=[];for(const i of t)if(Qt(i))ue(o,e,n),e.push(i);else if(typeof i=="string"||typeof i=="object"&&!Array.isArray(i))Rn(o,e,n,i);else if(Array.isArray(i))ue(o,e,n),e.push({role:"user",parts:te(o,i)});else throw new Error(`Unsupported content type: ${typeof i}`);return ue(o,e,n),e}function ce(o,t){if(!o.isVertexAI()&&"default"in t)throw new Error("Default value is not supported in the response schema for the Gemini API.");if("anyOf"in t&&t.anyOf!==void 0)for(const e of t.anyOf)ce(o,e);if("items"in t&&t.items!==void 0&&ce(o,t.items),"properties"in t&&t.properties!==void 0)for(const e of Object.values(t.properties))ce(o,e)}function en(o,t){return ce(o,t),t}function tn(o,t){if(typeof t=="object"&&"voiceConfig"in t)return t;if(typeof t=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:t}}};throw new Error(`Unsupported speechConfig type: ${typeof t}`)}function nn(o,t){return t}function Q(o,t){if(!Array.isArray(t))throw new Error("tool is required and must be an array of Tools");return t}function Pn(o,t,e,n=1){const i=!t.startsWith(`${e}/`)&&t.split("/").length===n;return o.isVertexAI()?t.startsWith("projects/")?t:t.startsWith("locations/")?`projects/${o.getProject()}/${t}`:t.startsWith(`${e}/`)?`projects/${o.getProject()}/locations/${o.getLocation()}/${t}`:i?`projects/${o.getProject()}/locations/${o.getLocation()}/${e}/${t}`:t:i?`${e}/${t}`:t}function $(o,t){if(typeof t!="string")throw new Error("name must be a string");return Pn(o,t,"cachedContents")}function Y(o,t){if(typeof t!="string")throw new Error("fromImageBytes must be a string");return t}function on(o,t){if(typeof t!="string")throw new Error("fromName must be a string");return t.startsWith("files/")?t.split("files/")[1]:t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Nn(o,t){const e={};if(s(t,["videoMetadata"])!==void 0)throw new Error("videoMetadata parameter is not supported in Gemini API.");const n=s(t,["thought"]);n!=null&&r(e,["thought"],n);const i=s(t,["codeExecutionResult"]);i!=null&&r(e,["codeExecutionResult"],i);const a=s(t,["executableCode"]);a!=null&&r(e,["executableCode"],a);const l=s(t,["fileData"]);l!=null&&r(e,["fileData"],l);const u=s(t,["functionCall"]);u!=null&&r(e,["functionCall"],u);const c=s(t,["functionResponse"]);c!=null&&r(e,["functionResponse"],c);const d=s(t,["inlineData"]);d!=null&&r(e,["inlineData"],d);const f=s(t,["text"]);return f!=null&&r(e,["text"],f),e}function et(o,t){const e={},n=s(t,["parts"]);n!=null&&(Array.isArray(n)?r(e,["parts"],n.map(a=>Nn(o,a))):r(e,["parts"],n));const i=s(t,["role"]);return i!=null&&r(e,["role"],i),e}function Dn(o,t){const e={};if(s(t,["response"])!==void 0)throw new Error("response parameter is not supported in Gemini API.");const n=s(t,["description"]);n!=null&&r(e,["description"],n);const i=s(t,["name"]);i!=null&&r(e,["name"],i);const a=s(t,["parameters"]);return a!=null&&r(e,["parameters"],a),e}function Ln(){return{}}function Fn(o,t){const e={},n=s(t,["mode"]);n!=null&&r(e,["mode"],n);const i=s(t,["dynamicThreshold"]);return i!=null&&r(e,["dynamicThreshold"],i),e}function Vn(o,t){const e={},n=s(t,["dynamicRetrievalConfig"]);return n!=null&&r(e,["dynamicRetrievalConfig"],Fn(o,n)),e}function Un(o,t){const e={},n=s(t,["functionDeclarations"]);if(n!=null&&(Array.isArray(n)?r(e,["functionDeclarations"],n.map(u=>Dn(o,u))):r(e,["functionDeclarations"],n)),s(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");s(t,["googleSearch"])!=null&&r(e,["googleSearch"],Ln());const a=s(t,["googleSearchRetrieval"]);a!=null&&r(e,["googleSearchRetrieval"],Vn(o,a));const l=s(t,["codeExecution"]);return l!=null&&r(e,["codeExecution"],l),e}function Gn(o,t){const e={},n=s(t,["mode"]);n!=null&&r(e,["mode"],n);const i=s(t,["allowedFunctionNames"]);return i!=null&&r(e,["allowedFunctionNames"],i),e}function qn(o,t){const e={},n=s(t,["functionCallingConfig"]);return n!=null&&r(e,["functionCallingConfig"],Gn(o,n)),e}function kn(o,t,e){const n={},i=s(t,["ttl"]);e!==void 0&&i!=null&&r(e,["ttl"],i);const a=s(t,["expireTime"]);e!==void 0&&a!=null&&r(e,["expireTime"],a);const l=s(t,["displayName"]);e!==void 0&&l!=null&&r(e,["displayName"],l);const u=s(t,["contents"]);e!==void 0&&u!=null&&(Array.isArray(u)?r(e,["contents"],S(o,S(o,u).map(p=>et(o,p)))):r(e,["contents"],S(o,u)));const c=s(t,["systemInstruction"]);e!==void 0&&c!=null&&r(e,["systemInstruction"],et(o,q(o,c)));const d=s(t,["tools"]);e!==void 0&&d!=null&&(Array.isArray(d)?r(e,["tools"],d.map(p=>Un(o,p))):r(e,["tools"],d));const f=s(t,["toolConfig"]);return e!==void 0&&f!=null&&r(e,["toolConfig"],qn(o,f)),n}function Bn(o,t){const e={},n=s(t,["model"]);n!=null&&r(e,["model"],Xt(o,n));const i=s(t,["config"]);return i!=null&&r(e,["config"],kn(o,i,e)),e}function Hn(o,t){const e={},n=s(t,["name"]);n!=null&&r(e,["_url","name"],$(o,n));const i=s(t,["config"]);return i!=null&&r(e,["config"],i),e}function On(o,t){const e={},n=s(t,["name"]);n!=null&&r(e,["_url","name"],$(o,n));const i=s(t,["config"]);return i!=null&&r(e,["config"],i),e}function $n(o,t,e){const n={},i=s(t,["ttl"]);e!==void 0&&i!=null&&r(e,["ttl"],i);const a=s(t,["expireTime"]);return e!==void 0&&a!=null&&r(e,["expireTime"],a),n}function Yn(o,t){const e={},n=s(t,["name"]);n!=null&&r(e,["_url","name"],$(o,n));const i=s(t,["config"]);return i!=null&&r(e,["config"],$n(o,i,e)),e}function Kn(o,t,e){const n={},i=s(t,["pageSize"]);e!==void 0&&i!=null&&r(e,["_query","pageSize"],i);const a=s(t,["pageToken"]);return e!==void 0&&a!=null&&r(e,["_query","pageToken"],a),n}function bn(o,t){const e={},n=s(t,["config"]);return n!=null&&r(e,["config"],Kn(o,n,e)),e}function Wn(o,t){const e={},n=s(t,["videoMetadata"]);n!=null&&r(e,["videoMetadata"],n);const i=s(t,["thought"]);i!=null&&r(e,["thought"],i);const a=s(t,["codeExecutionResult"]);a!=null&&r(e,["codeExecutionResult"],a);const l=s(t,["executableCode"]);l!=null&&r(e,["executableCode"],l);const u=s(t,["fileData"]);u!=null&&r(e,["fileData"],u);const c=s(t,["functionCall"]);c!=null&&r(e,["functionCall"],c);const d=s(t,["functionResponse"]);d!=null&&r(e,["functionResponse"],d);const f=s(t,["inlineData"]);f!=null&&r(e,["inlineData"],f);const p=s(t,["text"]);return p!=null&&r(e,["text"],p),e}function tt(o,t){const e={},n=s(t,["parts"]);n!=null&&(Array.isArray(n)?r(e,["parts"],n.map(a=>Wn(o,a))):r(e,["parts"],n));const i=s(t,["role"]);return i!=null&&r(e,["role"],i),e}function Jn(o,t){const e={},n=s(t,["example"]);n!=null&&r(e,["example"],n);const i=s(t,["pattern"]);i!=null&&r(e,["pattern"],i);const a=s(t,["default"]);a!=null&&r(e,["default"],a);const l=s(t,["maxLength"]);l!=null&&r(e,["maxLength"],l);const u=s(t,["minLength"]);u!=null&&r(e,["minLength"],u);const c=s(t,["minProperties"]);c!=null&&r(e,["minProperties"],c);const d=s(t,["maxProperties"]);d!=null&&r(e,["maxProperties"],d);const f=s(t,["anyOf"]);f!=null&&r(e,["anyOf"],f);const p=s(t,["description"]);p!=null&&r(e,["description"],p);const m=s(t,["enum"]);m!=null&&r(e,["enum"],m);const h=s(t,["format"]);h!=null&&r(e,["format"],h);const g=s(t,["items"]);g!=null&&r(e,["items"],g);const y=s(t,["maxItems"]);y!=null&&r(e,["maxItems"],y);const C=s(t,["maximum"]);C!=null&&r(e,["maximum"],C);const T=s(t,["minItems"]);T!=null&&r(e,["minItems"],T);const E=s(t,["minimum"]);E!=null&&r(e,["minimum"],E);const I=s(t,["nullable"]);I!=null&&r(e,["nullable"],I);const _=s(t,["properties"]);_!=null&&r(e,["properties"],_);const M=s(t,["propertyOrdering"]);M!=null&&r(e,["propertyOrdering"],M);const x=s(t,["required"]);x!=null&&r(e,["required"],x);const N=s(t,["title"]);N!=null&&r(e,["title"],N);const V=s(t,["type"]);return V!=null&&r(e,["type"],V),e}function zn(o,t){const e={},n=s(t,["response"]);n!=null&&r(e,["response"],Jn(o,n));const i=s(t,["description"]);i!=null&&r(e,["description"],i);const a=s(t,["name"]);a!=null&&r(e,["name"],a);const l=s(t,["parameters"]);return l!=null&&r(e,["parameters"],l),e}function Xn(){return{}}function Qn(o,t){const e={},n=s(t,["mode"]);n!=null&&r(e,["mode"],n);const i=s(t,["dynamicThreshold"]);return i!=null&&r(e,["dynamicThreshold"],i),e}function Zn(o,t){const e={},n=s(t,["dynamicRetrievalConfig"]);return n!=null&&r(e,["dynamicRetrievalConfig"],Qn(o,n)),e}function jn(o,t){const e={},n=s(t,["functionDeclarations"]);n!=null&&(Array.isArray(n)?r(e,["functionDeclarations"],n.map(c=>zn(o,c))):r(e,["functionDeclarations"],n));const i=s(t,["retrieval"]);i!=null&&r(e,["retrieval"],i),s(t,["googleSearch"])!=null&&r(e,["googleSearch"],Xn());const l=s(t,["googleSearchRetrieval"]);l!=null&&r(e,["googleSearchRetrieval"],Zn(o,l));const u=s(t,["codeExecution"]);return u!=null&&r(e,["codeExecution"],u),e}function eo(o,t){const e={},n=s(t,["mode"]);n!=null&&r(e,["mode"],n);const i=s(t,["allowedFunctionNames"]);return i!=null&&r(e,["allowedFunctionNames"],i),e}function to(o,t){const e={},n=s(t,["functionCallingConfig"]);return n!=null&&r(e,["functionCallingConfig"],eo(o,n)),e}function no(o,t,e){const n={},i=s(t,["ttl"]);e!==void 0&&i!=null&&r(e,["ttl"],i);const a=s(t,["expireTime"]);e!==void 0&&a!=null&&r(e,["expireTime"],a);const l=s(t,["displayName"]);e!==void 0&&l!=null&&r(e,["displayName"],l);const u=s(t,["contents"]);e!==void 0&&u!=null&&(Array.isArray(u)?r(e,["contents"],S(o,S(o,u).map(p=>tt(o,p)))):r(e,["contents"],S(o,u)));const c=s(t,["systemInstruction"]);e!==void 0&&c!=null&&r(e,["systemInstruction"],tt(o,q(o,c)));const d=s(t,["tools"]);e!==void 0&&d!=null&&(Array.isArray(d)?r(e,["tools"],d.map(p=>jn(o,p))):r(e,["tools"],d));const f=s(t,["toolConfig"]);return e!==void 0&&f!=null&&r(e,["toolConfig"],to(o,f)),n}function oo(o,t){const e={},n=s(t,["model"]);n!=null&&r(e,["model"],Xt(o,n));const i=s(t,["config"]);return i!=null&&r(e,["config"],no(o,i,e)),e}function io(o,t){const e={},n=s(t,["name"]);n!=null&&r(e,["_url","name"],$(o,n));const i=s(t,["config"]);return i!=null&&r(e,["config"],i),e}function ro(o,t){const e={},n=s(t,["name"]);n!=null&&r(e,["_url","name"],$(o,n));const i=s(t,["config"]);return i!=null&&r(e,["config"],i),e}function so(o,t,e){const n={},i=s(t,["ttl"]);e!==void 0&&i!=null&&r(e,["ttl"],i);const a=s(t,["expireTime"]);return e!==void 0&&a!=null&&r(e,["expireTime"],a),n}function ao(o,t){const e={},n=s(t,["name"]);n!=null&&r(e,["_url","name"],$(o,n));const i=s(t,["config"]);return i!=null&&r(e,["config"],so(o,i,e)),e}function lo(o,t,e){const n={},i=s(t,["pageSize"]);e!==void 0&&i!=null&&r(e,["_query","pageSize"],i);const a=s(t,["pageToken"]);return e!==void 0&&a!=null&&r(e,["_query","pageToken"],a),n}function uo(o,t){const e={},n=s(t,["config"]);return n!=null&&r(e,["config"],lo(o,n,e)),e}function de(o,t){const e={},n=s(t,["name"]);n!=null&&r(e,["name"],n);const i=s(t,["displayName"]);i!=null&&r(e,["displayName"],i);const a=s(t,["model"]);a!=null&&r(e,["model"],a);const l=s(t,["createTime"]);l!=null&&r(e,["createTime"],l);const u=s(t,["updateTime"]);u!=null&&r(e,["updateTime"],u);const c=s(t,["expireTime"]);c!=null&&r(e,["expireTime"],c);const d=s(t,["usageMetadata"]);return d!=null&&r(e,["usageMetadata"],d),e}function co(){return{}}function fo(o,t){const e={},n=s(t,["nextPageToken"]);n!=null&&r(e,["nextPageToken"],n);const i=s(t,["cachedContents"]);return i!=null&&(Array.isArray(i)?r(e,["cachedContents"],i.map(a=>de(o,a))):r(e,["cachedContents"],i)),e}function fe(o,t){const e={},n=s(t,["name"]);n!=null&&r(e,["name"],n);const i=s(t,["displayName"]);i!=null&&r(e,["displayName"],i);const a=s(t,["model"]);a!=null&&r(e,["model"],a);const l=s(t,["createTime"]);l!=null&&r(e,["createTime"],l);const u=s(t,["updateTime"]);u!=null&&r(e,["updateTime"],u);const c=s(t,["expireTime"]);c!=null&&r(e,["expireTime"],c);const d=s(t,["usageMetadata"]);return d!=null&&r(e,["usageMetadata"],d),e}function po(){return{}}function mo(o,t){const e={},n=s(t,["nextPageToken"]);n!=null&&r(e,["nextPageToken"],n);const i=s(t,["cachedContents"]);return i!=null&&(Array.isArray(i)?r(e,["cachedContents"],i.map(a=>fe(o,a))):r(e,["cachedContents"],i)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var pe;(function(o){o.PAGED_ITEM_BATCH_JOBS="batchJobs",o.PAGED_ITEM_MODELS="models",o.PAGED_ITEM_TUNING_JOBS="tuningJobs",o.PAGED_ITEM_FILES="files",o.PAGED_ITEM_CACHED_CONTENTS="cachedContents"})(pe||(pe={}));class rn{constructor(t,e,n,i){this.pageInternal=[],this.paramsInternal={},this.requestInternal=e,this.init(t,n,i)}init(t,e,n){var i,a;this.nameInternal=t,this.pageInternal=e[this.nameInternal]||[],this.idxInternal=0;let l={config:{}};n?typeof n=="object"?l=Object.assign({},n):l=n:l={config:{}},l.config&&(l.config.pageToken=e.nextPageToken),this.paramsInternal=l,this.pageInternalSize=(a=(i=l.config)===null||i===void 0?void 0:i.pageSize)!==null&&a!==void 0?a:this.pageInternal.length}initNextPage(t){this.init(this.nameInternal,t,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(t){return this.pageInternal[t]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const t=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:t,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const t=await this.requestInternal(this.params);return this.initNextPage(t),this.page}hasNextPage(){var t;return((t=this.params.config)===null||t===void 0?void 0:t.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var nt;(function(o){o.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",o.OUTCOME_OK="OUTCOME_OK",o.OUTCOME_FAILED="OUTCOME_FAILED",o.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(nt||(nt={}));var ot;(function(o){o.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",o.PYTHON="PYTHON"})(ot||(ot={}));var it;(function(o){o.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",o.STRING="STRING",o.NUMBER="NUMBER",o.INTEGER="INTEGER",o.BOOLEAN="BOOLEAN",o.ARRAY="ARRAY",o.OBJECT="OBJECT"})(it||(it={}));var rt;(function(o){o.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",o.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",o.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",o.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",o.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",o.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(rt||(rt={}));var st;(function(o){o.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",o.SEVERITY="SEVERITY",o.PROBABILITY="PROBABILITY"})(st||(st={}));var at;(function(o){o.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",o.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",o.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",o.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",o.BLOCK_NONE="BLOCK_NONE",o.OFF="OFF"})(at||(at={}));var lt;(function(o){o.MODE_UNSPECIFIED="MODE_UNSPECIFIED",o.MODE_DYNAMIC="MODE_DYNAMIC"})(lt||(lt={}));var ut;(function(o){o.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",o.STOP="STOP",o.MAX_TOKENS="MAX_TOKENS",o.SAFETY="SAFETY",o.RECITATION="RECITATION",o.OTHER="OTHER",o.BLOCKLIST="BLOCKLIST",o.PROHIBITED_CONTENT="PROHIBITED_CONTENT",o.SPII="SPII",o.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",o.IMAGE_SAFETY="IMAGE_SAFETY"})(ut||(ut={}));var ct;(function(o){o.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",o.NEGLIGIBLE="NEGLIGIBLE",o.LOW="LOW",o.MEDIUM="MEDIUM",o.HIGH="HIGH"})(ct||(ct={}));var dt;(function(o){o.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",o.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",o.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",o.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",o.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(dt||(dt={}));var ft;(function(o){o.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",o.SAFETY="SAFETY",o.OTHER="OTHER",o.BLOCKLIST="BLOCKLIST",o.PROHIBITED_CONTENT="PROHIBITED_CONTENT"})(ft||(ft={}));var pt;(function(o){o.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",o.TEXT="TEXT",o.IMAGE="IMAGE",o.AUDIO="AUDIO"})(pt||(pt={}));var mt;(function(o){o.STATE_UNSPECIFIED="STATE_UNSPECIFIED",o.ACTIVE="ACTIVE",o.ERROR="ERROR"})(mt||(mt={}));var ht;(function(o){o.MODE_UNSPECIFIED="MODE_UNSPECIFIED",o.MODE_DYNAMIC="MODE_DYNAMIC"})(ht||(ht={}));var gt;(function(o){o.MODE_UNSPECIFIED="MODE_UNSPECIFIED",o.AUTO="AUTO",o.ANY="ANY",o.NONE="NONE"})(gt||(gt={}));var yt;(function(o){o.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",o.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",o.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",o.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(yt||(yt={}));var Ct;(function(o){o.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",o.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",o.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",o.BLOCK_NONE="BLOCK_NONE"})(Ct||(Ct={}));var Et;(function(o){o.DONT_ALLOW="DONT_ALLOW",o.ALLOW_ADULT="ALLOW_ADULT",o.ALLOW_ALL="ALLOW_ALL"})(Et||(Et={}));var vt;(function(o){o.auto="auto",o.en="en",o.ja="ja",o.ko="ko",o.hi="hi"})(vt||(vt={}));var Tt;(function(o){o.STATE_UNSPECIFIED="STATE_UNSPECIFIED",o.PROCESSING="PROCESSING",o.ACTIVE="ACTIVE",o.FAILED="FAILED"})(Tt||(Tt={}));var It;(function(o){o.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",o.UPLOADED="UPLOADED",o.GENERATED="GENERATED"})(It||(It={}));var _t;(function(o){o.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",o.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",o.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",o.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",o.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(_t||(_t={}));var At;(function(o){o.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",o.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",o.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",o.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(At||(At={}));var St;(function(o){o.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",o.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",o.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",o.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(St||(St={}));var Mt;(function(o){o.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",o.TEXT="TEXT",o.IMAGE="IMAGE",o.VIDEO="VIDEO",o.AUDIO="AUDIO",o.DOCUMENT="DOCUMENT"})(Mt||(Mt={}));class ae{get text(){var t,e,n,i,a,l,u,c;if(((i=(n=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let d="",f=!1;const p=[];for(const m of(c=(u=(l=(a=this.candidates)===null||a===void 0?void 0:a[0])===null||l===void 0?void 0:l.content)===null||u===void 0?void 0:u.parts)!==null&&c!==void 0?c:[]){for(const[h,g]of Object.entries(m))h!=="text"&&h!=="thought"&&(g!==null||g!==void 0)&&p.push(h);if(typeof m.text=="string"){if(typeof m.thought=="boolean"&&m.thought)continue;f=!0,d+=m.text}}return p.length>0&&console.warn(`there are non-text parts ${p} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),f?d:void 0}get functionCalls(){var t,e,n,i,a,l,u,c;if(((i=(n=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const d=(c=(u=(l=(a=this.candidates)===null||a===void 0?void 0:a[0])===null||l===void 0?void 0:l.content)===null||u===void 0?void 0:u.parts)===null||c===void 0?void 0:c.filter(f=>f.functionCall).map(f=>f.functionCall).filter(f=>f!==void 0);if((d==null?void 0:d.length)!==0)return d}get executableCode(){var t,e,n,i,a,l,u,c,d;if(((i=(n=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const f=(c=(u=(l=(a=this.candidates)===null||a===void 0?void 0:a[0])===null||l===void 0?void 0:l.content)===null||u===void 0?void 0:u.parts)===null||c===void 0?void 0:c.filter(p=>p.executableCode).map(p=>p.executableCode).filter(p=>p!==void 0);if((f==null?void 0:f.length)!==0)return(d=f==null?void 0:f[0])===null||d===void 0?void 0:d.code}get codeExecutionResult(){var t,e,n,i,a,l,u,c,d;if(((i=(n=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const f=(c=(u=(l=(a=this.candidates)===null||a===void 0?void 0:a[0])===null||l===void 0?void 0:l.content)===null||u===void 0?void 0:u.parts)===null||c===void 0?void 0:c.filter(p=>p.codeExecutionResult).map(p=>p.codeExecutionResult).filter(p=>p!==void 0);if((f==null?void 0:f.length)!==0)return(d=f==null?void 0:f[0])===null||d===void 0?void 0:d.output}}class wt{}class xt{}class Rt{}class ho{}class Pt{}class Nt{}class go{}class sn{constructor(t){const e={};for(const n of t.headers.entries())e[n[0]]=n[1];this.headers=e,this.responseInternal=t}json(){return this.responseInternal.json()}}class yo{}class Co{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Eo extends ve{constructor(t){super(),this.apiClient=t,this.list=async(e={})=>new rn(pe.PAGED_ITEM_CACHED_CONTENTS,n=>this.listInternal(n),await this.listInternal(e),e)}async create(t){var e,n;let i,a="",l={};if(this.apiClient.isVertexAI()){const u=oo(this.apiClient,t);return a=v("cachedContents",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions}).then(c=>c.json()),i.then(c=>fe(this.apiClient,c))}else{const u=Bn(this.apiClient,t);return a=v("cachedContents",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions}).then(c=>c.json()),i.then(c=>de(this.apiClient,c))}}async get(t){var e,n;let i,a="",l={};if(this.apiClient.isVertexAI()){const u=io(this.apiClient,t);return a=v("{name}",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions}).then(c=>c.json()),i.then(c=>fe(this.apiClient,c))}else{const u=Hn(this.apiClient,t);return a=v("{name}",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions}).then(c=>c.json()),i.then(c=>de(this.apiClient,c))}}async delete(t){var e,n;let i,a="",l={};if(this.apiClient.isVertexAI()){const u=ro(this.apiClient,t);return a=v("{name}",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions}).then(c=>c.json()),i.then(()=>{const c=po(),d=new Pt;return Object.assign(d,c),d})}else{const u=On(this.apiClient,t);return a=v("{name}",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions}).then(c=>c.json()),i.then(()=>{const c=co(),d=new Pt;return Object.assign(d,c),d})}}async update(t){var e,n;let i,a="",l={};if(this.apiClient.isVertexAI()){const u=ao(this.apiClient,t);return a=v("{name}",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions}).then(c=>c.json()),i.then(c=>fe(this.apiClient,c))}else{const u=Yn(this.apiClient,t);return a=v("{name}",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions}).then(c=>c.json()),i.then(c=>de(this.apiClient,c))}}async listInternal(t){var e,n;let i,a="",l={};if(this.apiClient.isVertexAI()){const u=uo(this.apiClient,t);return a=v("cachedContents",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions}).then(c=>c.json()),i.then(c=>{const d=mo(this.apiClient,c),f=new Nt;return Object.assign(f,d),f})}else{const u=bn(this.apiClient,t);return a=v("cachedContents",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions}).then(c=>c.json()),i.then(c=>{const d=fo(this.apiClient,c),f=new Nt;return Object.assign(f,d),f})}}}function Dt(o){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&o[t],n=0;if(e)return e.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&n>=o.length&&(o=void 0),{value:o&&o[n++],done:!o}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function L(o){return this instanceof L?(this.v=o,this):new L(o)}function me(o,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=e.apply(o,t||[]),i,a=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),u("next"),u("throw"),u("return",l),i[Symbol.asyncIterator]=function(){return this},i;function l(h){return function(g){return Promise.resolve(g).then(h,p)}}function u(h,g){n[h]&&(i[h]=function(y){return new Promise(function(C,T){a.push([h,y,C,T])>1||c(h,y)})},g&&(i[h]=g(i[h])))}function c(h,g){try{d(n[h](g))}catch(y){m(a[0][3],y)}}function d(h){h.value instanceof L?Promise.resolve(h.value.v).then(f,p):m(a[0][2],h)}function f(h){c("next",h)}function p(h){c("throw",h)}function m(h,g){h(g),a.shift(),a.length&&c(a[0][0],a[0][1])}}function Ne(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=o[Symbol.asyncIterator],e;return t?t.call(o):(o=typeof Dt=="function"?Dt(o):o[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(a){e[a]=o[a]&&function(l){return new Promise(function(u,c){l=o[a](l),i(u,c,l.done,l.value)})}}function i(a,l,u,c){Promise.resolve(c).then(function(d){a({value:d,done:u})},l)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function vo(o){var t;if(o.candidates==null||o.candidates.length===0)return!1;const e=(t=o.candidates[0])===null||t===void 0?void 0:t.content;return e===void 0?!1:an(e)}function an(o){if(o.parts===void 0||o.parts.length===0)return!1;for(const t of o.parts)if(t===void 0||Object.keys(t).length===0||t.text!==void 0&&t.text==="")return!1;return!0}function To(o){if(o.length!==0){if(o[0].role!=="user")throw new Error("History must start with a user turn.");for(const t of o)if(t.role!=="user"&&t.role!=="model")throw new Error(`Role must be user or model, but got ${t.role}.`)}}function Io(o){if(o===void 0||o.length===0)return[];const t=[],e=o.length;let n=0,i=o[0];for(;n<e;)if(o[n].role==="user")i=o[n],n++;else{const a=[];let l=!0;for(;n<e&&o[n].role==="model";)a.push(o[n]),l&&!an(o[n])&&(l=!1),n++;l&&(t.push(i),t.push(...a))}return t}class _o{constructor(t,e){this.modelsModule=t,this.apiClient=e}create(t){return new Ao(this.apiClient,this.modelsModule,t.model,t.config,t.history)}}class Ao{constructor(t,e,n,i={},a=[]){this.apiClient=t,this.modelsModule=e,this.model=n,this.config=i,this.history=a,this.sendPromise=Promise.resolve(),To(a)}async sendMessage(t){var e;await this.sendPromise;const n=q(this.apiClient,t.message),i=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(n),config:(e=t.config)!==null&&e!==void 0?e:this.config});return this.sendPromise=(async()=>{var a,l;const c=(l=(a=(await i).candidates)===null||a===void 0?void 0:a[0])===null||l===void 0?void 0:l.content,d=c?[c]:[];this.recordHistory(n,d)})(),await this.sendPromise,i}async sendMessageStream(t){var e;await this.sendPromise;const n=q(this.apiClient,t.message),i=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(n),config:(e=t.config)!==null&&e!==void 0?e:this.config});this.sendPromise=i.then(()=>{});const a=await i;return this.processStreamResponse(a,n)}getHistory(t=!1){return t?Io(this.history):this.history}processStreamResponse(t,e){var n,i;return me(this,arguments,function*(){var l,u,c,d;const f=[];try{for(var p=!0,m=Ne(t),h;h=yield L(m.next()),l=h.done,!l;p=!0){d=h.value,p=!1;const g=d;if(vo(g)){const y=(i=(n=g.candidates)===null||n===void 0?void 0:n[0])===null||i===void 0?void 0:i.content;y!==void 0&&f.push(y)}yield yield L(g)}}catch(g){u={error:g}}finally{try{!p&&!l&&(c=m.return)&&(yield L(c.call(m)))}finally{if(u)throw u.error}}this.recordHistory(e,f)})}recordHistory(t,e){let n=[];e.length>0&&e.every(i=>i.role==="model")?n=e:n.push({role:"model",parts:[]}),this.history.push(t),this.history.push(...n)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function So(o,t,e){const n={},i=s(t,["pageSize"]);e!==void 0&&i!=null&&r(e,["_query","pageSize"],i);const a=s(t,["pageToken"]);return e!==void 0&&a!=null&&r(e,["_query","pageToken"],a),n}function Mo(o,t){const e={},n=s(t,["config"]);return n!=null&&r(e,["config"],So(o,n,e)),e}function wo(o,t){const e={},n=s(t,["details"]);n!=null&&r(e,["details"],n);const i=s(t,["message"]);i!=null&&r(e,["message"],i);const a=s(t,["code"]);return a!=null&&r(e,["code"],a),e}function xo(o,t){const e={},n=s(t,["name"]);n!=null&&r(e,["name"],n);const i=s(t,["displayName"]);i!=null&&r(e,["displayName"],i);const a=s(t,["mimeType"]);a!=null&&r(e,["mimeType"],a);const l=s(t,["sizeBytes"]);l!=null&&r(e,["sizeBytes"],l);const u=s(t,["createTime"]);u!=null&&r(e,["createTime"],u);const c=s(t,["expirationTime"]);c!=null&&r(e,["expirationTime"],c);const d=s(t,["updateTime"]);d!=null&&r(e,["updateTime"],d);const f=s(t,["sha256Hash"]);f!=null&&r(e,["sha256Hash"],f);const p=s(t,["uri"]);p!=null&&r(e,["uri"],p);const m=s(t,["downloadUri"]);m!=null&&r(e,["downloadUri"],m);const h=s(t,["state"]);h!=null&&r(e,["state"],h);const g=s(t,["source"]);g!=null&&r(e,["source"],g);const y=s(t,["videoMetadata"]);y!=null&&r(e,["videoMetadata"],y);const C=s(t,["error"]);return C!=null&&r(e,["error"],wo(o,C)),e}function Ro(o,t){const e={},n=s(t,["file"]);n!=null&&r(e,["file"],xo(o,n));const i=s(t,["config"]);return i!=null&&r(e,["config"],i),e}function Po(o,t){const e={},n=s(t,["name"]);n!=null&&r(e,["_url","file"],on(o,n));const i=s(t,["config"]);return i!=null&&r(e,["config"],i),e}function No(o,t){const e={},n=s(t,["name"]);n!=null&&r(e,["_url","file"],on(o,n));const i=s(t,["config"]);return i!=null&&r(e,["config"],i),e}function Do(o,t){const e={},n=s(t,["details"]);n!=null&&r(e,["details"],n);const i=s(t,["message"]);i!=null&&r(e,["message"],i);const a=s(t,["code"]);return a!=null&&r(e,["code"],a),e}function De(o,t){const e={},n=s(t,["name"]);n!=null&&r(e,["name"],n);const i=s(t,["displayName"]);i!=null&&r(e,["displayName"],i);const a=s(t,["mimeType"]);a!=null&&r(e,["mimeType"],a);const l=s(t,["sizeBytes"]);l!=null&&r(e,["sizeBytes"],l);const u=s(t,["createTime"]);u!=null&&r(e,["createTime"],u);const c=s(t,["expirationTime"]);c!=null&&r(e,["expirationTime"],c);const d=s(t,["updateTime"]);d!=null&&r(e,["updateTime"],d);const f=s(t,["sha256Hash"]);f!=null&&r(e,["sha256Hash"],f);const p=s(t,["uri"]);p!=null&&r(e,["uri"],p);const m=s(t,["downloadUri"]);m!=null&&r(e,["downloadUri"],m);const h=s(t,["state"]);h!=null&&r(e,["state"],h);const g=s(t,["source"]);g!=null&&r(e,["source"],g);const y=s(t,["videoMetadata"]);y!=null&&r(e,["videoMetadata"],y);const C=s(t,["error"]);return C!=null&&r(e,["error"],Do(o,C)),e}function Lo(o,t){const e={},n=s(t,["nextPageToken"]);n!=null&&r(e,["nextPageToken"],n);const i=s(t,["files"]);return i!=null&&(Array.isArray(i)?r(e,["files"],i.map(a=>De(o,a))):r(e,["files"],i)),e}function Fo(o,t){const e={},n=s(t,["httpHeaders"]);return n!=null&&r(e,["httpHeaders"],n),e}function Vo(){return{}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Uo extends ve{constructor(t){super(),this.apiClient=t,this.list=async(e={})=>new rn(pe.PAGED_ITEM_FILES,n=>this.listInternal(n),await this.listInternal(e),e)}async upload(t){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(t.file,t.config).then(e=>De(this.apiClient,e))}async listInternal(t){var e;let n,i="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=Mo(this.apiClient,t);return i=v("files",l._url),a=l._query,delete l.config,delete l._url,delete l._query,n=this.apiClient.request({path:i,queryParams:a,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions}).then(u=>u.json()),n.then(u=>{const c=Lo(this.apiClient,u),d=new go;return Object.assign(d,c),d})}}async createInternal(t){var e;let n,i="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=Ro(this.apiClient,t);return i=v("upload/v1beta/files",l._url),a=l._query,delete l.config,delete l._url,delete l._query,n=this.apiClient.request({path:i,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions}).then(u=>u.json()),n.then(u=>{const c=Fo(this.apiClient,u),d=new yo;return Object.assign(d,c),d})}}async get(t){var e;let n,i="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=Po(this.apiClient,t);return i=v("files/{file}",l._url),a=l._query,delete l.config,delete l._url,delete l._query,n=this.apiClient.request({path:i,queryParams:a,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions}).then(u=>u.json()),n.then(u=>De(this.apiClient,u))}}async delete(t){var e;let n,i="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=No(this.apiClient,t);return i=v("files/{file}",l._url),a=l._query,delete l.config,delete l._url,delete l._query,n=this.apiClient.request({path:i,queryParams:a,body:JSON.stringify(l),httpMethod:"DELETE",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions}).then(u=>u.json()),n.then(()=>{const u=Vo(),c=new Co;return Object.assign(c,u),c})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Go(o,t){const e={};if(s(t,["videoMetadata"])!==void 0)throw new Error("videoMetadata parameter is not supported in Gemini API.");const n=s(t,["thought"]);n!=null&&r(e,["thought"],n);const i=s(t,["codeExecutionResult"]);i!=null&&r(e,["codeExecutionResult"],i);const a=s(t,["executableCode"]);a!=null&&r(e,["executableCode"],a);const l=s(t,["fileData"]);l!=null&&r(e,["fileData"],l);const u=s(t,["functionCall"]);u!=null&&r(e,["functionCall"],u);const c=s(t,["functionResponse"]);c!=null&&r(e,["functionResponse"],c);const d=s(t,["inlineData"]);d!=null&&r(e,["inlineData"],d);const f=s(t,["text"]);return f!=null&&r(e,["text"],f),e}function se(o,t){const e={},n=s(t,["parts"]);n!=null&&(Array.isArray(n)?r(e,["parts"],n.map(a=>Go(o,a))):r(e,["parts"],n));const i=s(t,["role"]);return i!=null&&r(e,["role"],i),e}function qo(o,t){const e={};if(s(t,["example"])!==void 0)throw new Error("example parameter is not supported in Gemini API.");if(s(t,["pattern"])!==void 0)throw new Error("pattern parameter is not supported in Gemini API.");if(s(t,["default"])!==void 0)throw new Error("default parameter is not supported in Gemini API.");if(s(t,["maxLength"])!==void 0)throw new Error("maxLength parameter is not supported in Gemini API.");if(s(t,["minLength"])!==void 0)throw new Error("minLength parameter is not supported in Gemini API.");if(s(t,["minProperties"])!==void 0)throw new Error("minProperties parameter is not supported in Gemini API.");if(s(t,["maxProperties"])!==void 0)throw new Error("maxProperties parameter is not supported in Gemini API.");const n=s(t,["anyOf"]);n!=null&&r(e,["anyOf"],n);const i=s(t,["description"]);i!=null&&r(e,["description"],i);const a=s(t,["enum"]);a!=null&&r(e,["enum"],a);const l=s(t,["format"]);l!=null&&r(e,["format"],l);const u=s(t,["items"]);u!=null&&r(e,["items"],u);const c=s(t,["maxItems"]);c!=null&&r(e,["maxItems"],c);const d=s(t,["maximum"]);d!=null&&r(e,["maximum"],d);const f=s(t,["minItems"]);f!=null&&r(e,["minItems"],f);const p=s(t,["minimum"]);p!=null&&r(e,["minimum"],p);const m=s(t,["nullable"]);m!=null&&r(e,["nullable"],m);const h=s(t,["properties"]);h!=null&&r(e,["properties"],h);const g=s(t,["propertyOrdering"]);g!=null&&r(e,["propertyOrdering"],g);const y=s(t,["required"]);y!=null&&r(e,["required"],y);const C=s(t,["title"]);C!=null&&r(e,["title"],C);const T=s(t,["type"]);return T!=null&&r(e,["type"],T),e}function ko(o,t){const e={};if(s(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const n=s(t,["category"]);n!=null&&r(e,["category"],n);const i=s(t,["threshold"]);return i!=null&&r(e,["threshold"],i),e}function Bo(o,t){const e={};if(s(t,["response"])!==void 0)throw new Error("response parameter is not supported in Gemini API.");const n=s(t,["description"]);n!=null&&r(e,["description"],n);const i=s(t,["name"]);i!=null&&r(e,["name"],i);const a=s(t,["parameters"]);return a!=null&&r(e,["parameters"],a),e}function Ho(){return{}}function Oo(o,t){const e={},n=s(t,["mode"]);n!=null&&r(e,["mode"],n);const i=s(t,["dynamicThreshold"]);return i!=null&&r(e,["dynamicThreshold"],i),e}function $o(o,t){const e={},n=s(t,["dynamicRetrievalConfig"]);return n!=null&&r(e,["dynamicRetrievalConfig"],Oo(o,n)),e}function ln(o,t){const e={},n=s(t,["functionDeclarations"]);if(n!=null&&(Array.isArray(n)?r(e,["functionDeclarations"],n.map(u=>Bo(o,u))):r(e,["functionDeclarations"],n)),s(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");s(t,["googleSearch"])!=null&&r(e,["googleSearch"],Ho());const a=s(t,["googleSearchRetrieval"]);a!=null&&r(e,["googleSearchRetrieval"],$o(o,a));const l=s(t,["codeExecution"]);return l!=null&&r(e,["codeExecution"],l),e}function Yo(o,t){const e={},n=s(t,["mode"]);n!=null&&r(e,["mode"],n);const i=s(t,["allowedFunctionNames"]);return i!=null&&r(e,["allowedFunctionNames"],i),e}function Ko(o,t){const e={},n=s(t,["functionCallingConfig"]);return n!=null&&r(e,["functionCallingConfig"],Yo(o,n)),e}function bo(o,t){const e={},n=s(t,["voiceName"]);return n!=null&&r(e,["voiceName"],n),e}function Wo(o,t){const e={},n=s(t,["prebuiltVoiceConfig"]);return n!=null&&r(e,["prebuiltVoiceConfig"],bo(o,n)),e}function Jo(o,t){const e={},n=s(t,["voiceConfig"]);return n!=null&&r(e,["voiceConfig"],Wo(o,n)),e}function zo(o,t){const e={},n=s(t,["includeThoughts"]);return n!=null&&r(e,["includeThoughts"],n),e}function Xo(o,t,e){const n={},i=s(t,["systemInstruction"]);e!==void 0&&i!=null&&r(e,["systemInstruction"],se(o,q(o,i)));const a=s(t,["temperature"]);a!=null&&r(n,["temperature"],a);const l=s(t,["topP"]);l!=null&&r(n,["topP"],l);const u=s(t,["topK"]);u!=null&&r(n,["topK"],u);const c=s(t,["candidateCount"]);c!=null&&r(n,["candidateCount"],c);const d=s(t,["maxOutputTokens"]);d!=null&&r(n,["maxOutputTokens"],d);const f=s(t,["stopSequences"]);f!=null&&r(n,["stopSequences"],f);const p=s(t,["responseLogprobs"]);p!=null&&r(n,["responseLogprobs"],p);const m=s(t,["logprobs"]);m!=null&&r(n,["logprobs"],m);const h=s(t,["presencePenalty"]);h!=null&&r(n,["presencePenalty"],h);const g=s(t,["frequencyPenalty"]);g!=null&&r(n,["frequencyPenalty"],g);const y=s(t,["seed"]);y!=null&&r(n,["seed"],y);const C=s(t,["responseMimeType"]);C!=null&&r(n,["responseMimeType"],C);const T=s(t,["responseSchema"]);if(T!=null&&r(n,["responseSchema"],qo(o,en(o,T))),s(t,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");const E=s(t,["safetySettings"]);e!==void 0&&E!=null&&(Array.isArray(E)?r(e,["safetySettings"],E.map(z=>ko(o,z))):r(e,["safetySettings"],E));const I=s(t,["tools"]);e!==void 0&&I!=null&&(Array.isArray(I)?r(e,["tools"],Q(o,Q(o,I).map(z=>ln(o,nn(o,z))))):r(e,["tools"],Q(o,I)));const _=s(t,["toolConfig"]);if(e!==void 0&&_!=null&&r(e,["toolConfig"],Ko(o,_)),s(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const M=s(t,["cachedContent"]);e!==void 0&&M!=null&&r(e,["cachedContent"],$(o,M));const x=s(t,["responseModalities"]);x!=null&&r(n,["responseModalities"],x);const N=s(t,["mediaResolution"]);N!=null&&r(n,["mediaResolution"],N);const V=s(t,["speechConfig"]);if(V!=null&&r(n,["speechConfig"],Jo(o,tn(o,V))),s(t,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const Z=s(t,["thinkingConfig"]);return Z!=null&&r(n,["thinkingConfig"],zo(o,Z)),n}function Lt(o,t){const e={},n=s(t,["model"]);n!=null&&r(e,["_url","model"],F(o,n));const i=s(t,["contents"]);i!=null&&(Array.isArray(i)?r(e,["contents"],S(o,S(o,i).map(l=>se(o,l)))):r(e,["contents"],S(o,i)));const a=s(t,["config"]);return a!=null&&r(e,["generationConfig"],Xo(o,a,e)),e}function Qo(o,t,e){const n={},i=s(t,["taskType"]);e!==void 0&&i!=null&&r(e,["requests[]","taskType"],i);const a=s(t,["title"]);e!==void 0&&a!=null&&r(e,["requests[]","title"],a);const l=s(t,["outputDimensionality"]);if(e!==void 0&&l!=null&&r(e,["requests[]","outputDimensionality"],l),s(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(s(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function Zo(o,t){const e={},n=s(t,["model"]);n!=null&&r(e,["_url","model"],F(o,n));const i=s(t,["contents"]);i!=null&&r(e,["requests[]","content"],jt(o,i));const a=s(t,["config"]);a!=null&&r(e,["config"],Qo(o,a,e));const l=s(t,["model"]);return l!==void 0&&r(e,["requests[]","model"],F(o,l)),e}function jo(o,t,e){const n={};if(s(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(s(t,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const i=s(t,["numberOfImages"]);e!==void 0&&i!=null&&r(e,["parameters","sampleCount"],i);const a=s(t,["aspectRatio"]);e!==void 0&&a!=null&&r(e,["parameters","aspectRatio"],a);const l=s(t,["guidanceScale"]);if(e!==void 0&&l!=null&&r(e,["parameters","guidanceScale"],l),s(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const u=s(t,["safetyFilterLevel"]);e!==void 0&&u!=null&&r(e,["parameters","safetySetting"],u);const c=s(t,["personGeneration"]);e!==void 0&&c!=null&&r(e,["parameters","personGeneration"],c);const d=s(t,["includeSafetyAttributes"]);e!==void 0&&d!=null&&r(e,["parameters","includeSafetyAttributes"],d);const f=s(t,["includeRaiReason"]);e!==void 0&&f!=null&&r(e,["parameters","includeRaiReason"],f);const p=s(t,["language"]);e!==void 0&&p!=null&&r(e,["parameters","language"],p);const m=s(t,["outputMimeType"]);e!==void 0&&m!=null&&r(e,["parameters","outputOptions","mimeType"],m);const h=s(t,["outputCompressionQuality"]);if(e!==void 0&&h!=null&&r(e,["parameters","outputOptions","compressionQuality"],h),s(t,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(s(t,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return n}function ei(o,t){const e={},n=s(t,["model"]);n!=null&&r(e,["_url","model"],F(o,n));const i=s(t,["prompt"]);i!=null&&r(e,["instances[0]","prompt"],i);const a=s(t,["config"]);return a!=null&&r(e,["config"],jo(o,a,e)),e}function ti(o,t){const e={};if(s(t,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(s(t,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(s(t,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function ni(o,t){const e={},n=s(t,["model"]);n!=null&&r(e,["_url","model"],F(o,n));const i=s(t,["contents"]);i!=null&&(Array.isArray(i)?r(e,["contents"],S(o,S(o,i).map(l=>se(o,l)))):r(e,["contents"],S(o,i)));const a=s(t,["config"]);return a!=null&&r(e,["config"],ti(o,a)),e}function oi(o,t){const e={};if(s(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const n=s(t,["imageBytes"]);n!=null&&r(e,["bytesBase64Encoded"],Y(o,n));const i=s(t,["mimeType"]);return i!=null&&r(e,["mimeType"],i),e}function ii(o,t,e){const n={},i=s(t,["numberOfVideos"]);if(e!==void 0&&i!=null&&r(e,["parameters","sampleCount"],i),s(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(s(t,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const a=s(t,["durationSeconds"]);if(e!==void 0&&a!=null&&r(e,["parameters","durationSeconds"],a),s(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const l=s(t,["aspectRatio"]);if(e!==void 0&&l!=null&&r(e,["parameters","aspectRatio"],l),s(t,["resolution"])!==void 0)throw new Error("resolution parameter is not supported in Gemini API.");const u=s(t,["personGeneration"]);if(e!==void 0&&u!=null&&r(e,["parameters","personGeneration"],u),s(t,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const c=s(t,["negativePrompt"]);if(e!==void 0&&c!=null&&r(e,["parameters","negativePrompt"],c),s(t,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return n}function ri(o,t){const e={},n=s(t,["model"]);n!=null&&r(e,["_url","model"],F(o,n));const i=s(t,["prompt"]);i!=null&&r(e,["instances[0]","prompt"],i);const a=s(t,["image"]);a!=null&&r(e,["instances[0]","image"],oi(o,a));const l=s(t,["config"]);return l!=null&&r(e,["config"],ii(o,l,e)),e}function si(o,t){const e={},n=s(t,["videoMetadata"]);n!=null&&r(e,["videoMetadata"],n);const i=s(t,["thought"]);i!=null&&r(e,["thought"],i);const a=s(t,["codeExecutionResult"]);a!=null&&r(e,["codeExecutionResult"],a);const l=s(t,["executableCode"]);l!=null&&r(e,["executableCode"],l);const u=s(t,["fileData"]);u!=null&&r(e,["fileData"],u);const c=s(t,["functionCall"]);c!=null&&r(e,["functionCall"],c);const d=s(t,["functionResponse"]);d!=null&&r(e,["functionResponse"],d);const f=s(t,["inlineData"]);f!=null&&r(e,["inlineData"],f);const p=s(t,["text"]);return p!=null&&r(e,["text"],p),e}function J(o,t){const e={},n=s(t,["parts"]);n!=null&&(Array.isArray(n)?r(e,["parts"],n.map(a=>si(o,a))):r(e,["parts"],n));const i=s(t,["role"]);return i!=null&&r(e,["role"],i),e}function un(o,t){const e={},n=s(t,["example"]);n!=null&&r(e,["example"],n);const i=s(t,["pattern"]);i!=null&&r(e,["pattern"],i);const a=s(t,["default"]);a!=null&&r(e,["default"],a);const l=s(t,["maxLength"]);l!=null&&r(e,["maxLength"],l);const u=s(t,["minLength"]);u!=null&&r(e,["minLength"],u);const c=s(t,["minProperties"]);c!=null&&r(e,["minProperties"],c);const d=s(t,["maxProperties"]);d!=null&&r(e,["maxProperties"],d);const f=s(t,["anyOf"]);f!=null&&r(e,["anyOf"],f);const p=s(t,["description"]);p!=null&&r(e,["description"],p);const m=s(t,["enum"]);m!=null&&r(e,["enum"],m);const h=s(t,["format"]);h!=null&&r(e,["format"],h);const g=s(t,["items"]);g!=null&&r(e,["items"],g);const y=s(t,["maxItems"]);y!=null&&r(e,["maxItems"],y);const C=s(t,["maximum"]);C!=null&&r(e,["maximum"],C);const T=s(t,["minItems"]);T!=null&&r(e,["minItems"],T);const E=s(t,["minimum"]);E!=null&&r(e,["minimum"],E);const I=s(t,["nullable"]);I!=null&&r(e,["nullable"],I);const _=s(t,["properties"]);_!=null&&r(e,["properties"],_);const M=s(t,["propertyOrdering"]);M!=null&&r(e,["propertyOrdering"],M);const x=s(t,["required"]);x!=null&&r(e,["required"],x);const N=s(t,["title"]);N!=null&&r(e,["title"],N);const V=s(t,["type"]);return V!=null&&r(e,["type"],V),e}function ai(o,t){const e={},n=s(t,["method"]);n!=null&&r(e,["method"],n);const i=s(t,["category"]);i!=null&&r(e,["category"],i);const a=s(t,["threshold"]);return a!=null&&r(e,["threshold"],a),e}function li(o,t){const e={},n=s(t,["response"]);n!=null&&r(e,["response"],un(o,n));const i=s(t,["description"]);i!=null&&r(e,["description"],i);const a=s(t,["name"]);a!=null&&r(e,["name"],a);const l=s(t,["parameters"]);return l!=null&&r(e,["parameters"],l),e}function ui(){return{}}function ci(o,t){const e={},n=s(t,["mode"]);n!=null&&r(e,["mode"],n);const i=s(t,["dynamicThreshold"]);return i!=null&&r(e,["dynamicThreshold"],i),e}function di(o,t){const e={},n=s(t,["dynamicRetrievalConfig"]);return n!=null&&r(e,["dynamicRetrievalConfig"],ci(o,n)),e}function Be(o,t){const e={},n=s(t,["functionDeclarations"]);n!=null&&(Array.isArray(n)?r(e,["functionDeclarations"],n.map(c=>li(o,c))):r(e,["functionDeclarations"],n));const i=s(t,["retrieval"]);i!=null&&r(e,["retrieval"],i),s(t,["googleSearch"])!=null&&r(e,["googleSearch"],ui());const l=s(t,["googleSearchRetrieval"]);l!=null&&r(e,["googleSearchRetrieval"],di(o,l));const u=s(t,["codeExecution"]);return u!=null&&r(e,["codeExecution"],u),e}function fi(o,t){const e={},n=s(t,["mode"]);n!=null&&r(e,["mode"],n);const i=s(t,["allowedFunctionNames"]);return i!=null&&r(e,["allowedFunctionNames"],i),e}function pi(o,t){const e={},n=s(t,["functionCallingConfig"]);return n!=null&&r(e,["functionCallingConfig"],fi(o,n)),e}function mi(o,t){const e={},n=s(t,["voiceName"]);return n!=null&&r(e,["voiceName"],n),e}function hi(o,t){const e={},n=s(t,["prebuiltVoiceConfig"]);return n!=null&&r(e,["prebuiltVoiceConfig"],mi(o,n)),e}function gi(o,t){const e={},n=s(t,["voiceConfig"]);return n!=null&&r(e,["voiceConfig"],hi(o,n)),e}function yi(o,t){const e={},n=s(t,["includeThoughts"]);return n!=null&&r(e,["includeThoughts"],n),e}function Ci(o,t,e){const n={},i=s(t,["systemInstruction"]);e!==void 0&&i!=null&&r(e,["systemInstruction"],J(o,q(o,i)));const a=s(t,["temperature"]);a!=null&&r(n,["temperature"],a);const l=s(t,["topP"]);l!=null&&r(n,["topP"],l);const u=s(t,["topK"]);u!=null&&r(n,["topK"],u);const c=s(t,["candidateCount"]);c!=null&&r(n,["candidateCount"],c);const d=s(t,["maxOutputTokens"]);d!=null&&r(n,["maxOutputTokens"],d);const f=s(t,["stopSequences"]);f!=null&&r(n,["stopSequences"],f);const p=s(t,["responseLogprobs"]);p!=null&&r(n,["responseLogprobs"],p);const m=s(t,["logprobs"]);m!=null&&r(n,["logprobs"],m);const h=s(t,["presencePenalty"]);h!=null&&r(n,["presencePenalty"],h);const g=s(t,["frequencyPenalty"]);g!=null&&r(n,["frequencyPenalty"],g);const y=s(t,["seed"]);y!=null&&r(n,["seed"],y);const C=s(t,["responseMimeType"]);C!=null&&r(n,["responseMimeType"],C);const T=s(t,["responseSchema"]);T!=null&&r(n,["responseSchema"],un(o,en(o,T)));const E=s(t,["routingConfig"]);E!=null&&r(n,["routingConfig"],E);const I=s(t,["safetySettings"]);e!==void 0&&I!=null&&(Array.isArray(I)?r(e,["safetySettings"],I.map(Ae=>ai(o,Ae))):r(e,["safetySettings"],I));const _=s(t,["tools"]);e!==void 0&&_!=null&&(Array.isArray(_)?r(e,["tools"],Q(o,Q(o,_).map(Ae=>Be(o,nn(o,Ae))))):r(e,["tools"],Q(o,_)));const M=s(t,["toolConfig"]);e!==void 0&&M!=null&&r(e,["toolConfig"],pi(o,M));const x=s(t,["labels"]);e!==void 0&&x!=null&&r(e,["labels"],x);const N=s(t,["cachedContent"]);e!==void 0&&N!=null&&r(e,["cachedContent"],$(o,N));const V=s(t,["responseModalities"]);V!=null&&r(n,["responseModalities"],V);const Z=s(t,["mediaResolution"]);Z!=null&&r(n,["mediaResolution"],Z);const z=s(t,["speechConfig"]);z!=null&&r(n,["speechConfig"],gi(o,tn(o,z)));const Qe=s(t,["audioTimestamp"]);Qe!=null&&r(n,["audioTimestamp"],Qe);const Ze=s(t,["thinkingConfig"]);return Ze!=null&&r(n,["thinkingConfig"],yi(o,Ze)),n}function Ft(o,t){const e={},n=s(t,["model"]);n!=null&&r(e,["_url","model"],F(o,n));const i=s(t,["contents"]);i!=null&&(Array.isArray(i)?r(e,["contents"],S(o,S(o,i).map(l=>J(o,l)))):r(e,["contents"],S(o,i)));const a=s(t,["config"]);return a!=null&&r(e,["generationConfig"],Ci(o,a,e)),e}function Ei(o,t,e){const n={},i=s(t,["taskType"]);e!==void 0&&i!=null&&r(e,["instances[]","task_type"],i);const a=s(t,["title"]);e!==void 0&&a!=null&&r(e,["instances[]","title"],a);const l=s(t,["outputDimensionality"]);e!==void 0&&l!=null&&r(e,["parameters","outputDimensionality"],l);const u=s(t,["mimeType"]);e!==void 0&&u!=null&&r(e,["instances[]","mimeType"],u);const c=s(t,["autoTruncate"]);return e!==void 0&&c!=null&&r(e,["parameters","autoTruncate"],c),n}function vi(o,t){const e={},n=s(t,["model"]);n!=null&&r(e,["_url","model"],F(o,n));const i=s(t,["contents"]);i!=null&&r(e,["instances[]","content"],jt(o,i));const a=s(t,["config"]);return a!=null&&r(e,["config"],Ei(o,a,e)),e}function Ti(o,t,e){const n={},i=s(t,["outputGcsUri"]);e!==void 0&&i!=null&&r(e,["parameters","storageUri"],i);const a=s(t,["negativePrompt"]);e!==void 0&&a!=null&&r(e,["parameters","negativePrompt"],a);const l=s(t,["numberOfImages"]);e!==void 0&&l!=null&&r(e,["parameters","sampleCount"],l);const u=s(t,["aspectRatio"]);e!==void 0&&u!=null&&r(e,["parameters","aspectRatio"],u);const c=s(t,["guidanceScale"]);e!==void 0&&c!=null&&r(e,["parameters","guidanceScale"],c);const d=s(t,["seed"]);e!==void 0&&d!=null&&r(e,["parameters","seed"],d);const f=s(t,["safetyFilterLevel"]);e!==void 0&&f!=null&&r(e,["parameters","safetySetting"],f);const p=s(t,["personGeneration"]);e!==void 0&&p!=null&&r(e,["parameters","personGeneration"],p);const m=s(t,["includeSafetyAttributes"]);e!==void 0&&m!=null&&r(e,["parameters","includeSafetyAttributes"],m);const h=s(t,["includeRaiReason"]);e!==void 0&&h!=null&&r(e,["parameters","includeRaiReason"],h);const g=s(t,["language"]);e!==void 0&&g!=null&&r(e,["parameters","language"],g);const y=s(t,["outputMimeType"]);e!==void 0&&y!=null&&r(e,["parameters","outputOptions","mimeType"],y);const C=s(t,["outputCompressionQuality"]);e!==void 0&&C!=null&&r(e,["parameters","outputOptions","compressionQuality"],C);const T=s(t,["addWatermark"]);e!==void 0&&T!=null&&r(e,["parameters","addWatermark"],T);const E=s(t,["enhancePrompt"]);return e!==void 0&&E!=null&&r(e,["parameters","enhancePrompt"],E),n}function Ii(o,t){const e={},n=s(t,["model"]);n!=null&&r(e,["_url","model"],F(o,n));const i=s(t,["prompt"]);i!=null&&r(e,["instances[0]","prompt"],i);const a=s(t,["config"]);return a!=null&&r(e,["config"],Ti(o,a,e)),e}function _i(o,t,e){const n={},i=s(t,["systemInstruction"]);e!==void 0&&i!=null&&r(e,["systemInstruction"],J(o,q(o,i)));const a=s(t,["tools"]);e!==void 0&&a!=null&&(Array.isArray(a)?r(e,["tools"],a.map(u=>Be(o,u))):r(e,["tools"],a));const l=s(t,["generationConfig"]);return e!==void 0&&l!=null&&r(e,["generationConfig"],l),n}function Ai(o,t){const e={},n=s(t,["model"]);n!=null&&r(e,["_url","model"],F(o,n));const i=s(t,["contents"]);i!=null&&(Array.isArray(i)?r(e,["contents"],S(o,S(o,i).map(l=>J(o,l)))):r(e,["contents"],S(o,i)));const a=s(t,["config"]);return a!=null&&r(e,["config"],_i(o,a,e)),e}function Si(o,t){const e={},n=s(t,["model"]);n!=null&&r(e,["_url","model"],F(o,n));const i=s(t,["contents"]);i!=null&&(Array.isArray(i)?r(e,["contents"],S(o,S(o,i).map(l=>J(o,l)))):r(e,["contents"],S(o,i)));const a=s(t,["config"]);return a!=null&&r(e,["config"],a),e}function Mi(o,t){const e={},n=s(t,["gcsUri"]);n!=null&&r(e,["gcsUri"],n);const i=s(t,["imageBytes"]);i!=null&&r(e,["bytesBase64Encoded"],Y(o,i));const a=s(t,["mimeType"]);return a!=null&&r(e,["mimeType"],a),e}function wi(o,t,e){const n={},i=s(t,["numberOfVideos"]);e!==void 0&&i!=null&&r(e,["parameters","sampleCount"],i);const a=s(t,["outputGcsUri"]);e!==void 0&&a!=null&&r(e,["parameters","storageUri"],a);const l=s(t,["fps"]);e!==void 0&&l!=null&&r(e,["parameters","fps"],l);const u=s(t,["durationSeconds"]);e!==void 0&&u!=null&&r(e,["parameters","durationSeconds"],u);const c=s(t,["seed"]);e!==void 0&&c!=null&&r(e,["parameters","seed"],c);const d=s(t,["aspectRatio"]);e!==void 0&&d!=null&&r(e,["parameters","aspectRatio"],d);const f=s(t,["resolution"]);e!==void 0&&f!=null&&r(e,["parameters","resolution"],f);const p=s(t,["personGeneration"]);e!==void 0&&p!=null&&r(e,["parameters","personGeneration"],p);const m=s(t,["pubsubTopic"]);e!==void 0&&m!=null&&r(e,["parameters","pubsubTopic"],m);const h=s(t,["negativePrompt"]);e!==void 0&&h!=null&&r(e,["parameters","negativePrompt"],h);const g=s(t,["enhancePrompt"]);return e!==void 0&&g!=null&&r(e,["parameters","enhancePrompt"],g),n}function xi(o,t){const e={},n=s(t,["model"]);n!=null&&r(e,["_url","model"],F(o,n));const i=s(t,["prompt"]);i!=null&&r(e,["instances[0]","prompt"],i);const a=s(t,["image"]);a!=null&&r(e,["instances[0]","image"],Mi(o,a));const l=s(t,["config"]);return l!=null&&r(e,["config"],wi(o,l,e)),e}function Ri(o,t){const e={},n=s(t,["thought"]);n!=null&&r(e,["thought"],n);const i=s(t,["codeExecutionResult"]);i!=null&&r(e,["codeExecutionResult"],i);const a=s(t,["executableCode"]);a!=null&&r(e,["executableCode"],a);const l=s(t,["fileData"]);l!=null&&r(e,["fileData"],l);const u=s(t,["functionCall"]);u!=null&&r(e,["functionCall"],u);const c=s(t,["functionResponse"]);c!=null&&r(e,["functionResponse"],c);const d=s(t,["inlineData"]);d!=null&&r(e,["inlineData"],d);const f=s(t,["text"]);return f!=null&&r(e,["text"],f),e}function cn(o,t){const e={},n=s(t,["parts"]);n!=null&&(Array.isArray(n)?r(e,["parts"],n.map(a=>Ri(o,a))):r(e,["parts"],n));const i=s(t,["role"]);return i!=null&&r(e,["role"],i),e}function Pi(o,t){const e={},n=s(t,["citationSources"]);return n!=null&&r(e,["citations"],n),e}function Ni(o,t){const e={},n=s(t,["content"]);n!=null&&r(e,["content"],cn(o,n));const i=s(t,["citationMetadata"]);i!=null&&r(e,["citationMetadata"],Pi(o,i));const a=s(t,["tokenCount"]);a!=null&&r(e,["tokenCount"],a);const l=s(t,["finishReason"]);l!=null&&r(e,["finishReason"],l);const u=s(t,["avgLogprobs"]);u!=null&&r(e,["avgLogprobs"],u);const c=s(t,["groundingMetadata"]);c!=null&&r(e,["groundingMetadata"],c);const d=s(t,["index"]);d!=null&&r(e,["index"],d);const f=s(t,["logprobsResult"]);f!=null&&r(e,["logprobsResult"],f);const p=s(t,["safetyRatings"]);return p!=null&&r(e,["safetyRatings"],p),e}function Vt(o,t){const e={},n=s(t,["candidates"]);n!=null&&(Array.isArray(n)?r(e,["candidates"],n.map(u=>Ni(o,u))):r(e,["candidates"],n));const i=s(t,["modelVersion"]);i!=null&&r(e,["modelVersion"],i);const a=s(t,["promptFeedback"]);a!=null&&r(e,["promptFeedback"],a);const l=s(t,["usageMetadata"]);return l!=null&&r(e,["usageMetadata"],l),e}function Di(o,t){const e={},n=s(t,["values"]);return n!=null&&r(e,["values"],n),e}function Li(){return{}}function Fi(o,t){const e={},n=s(t,["embeddings"]);return n!=null&&(Array.isArray(n)?r(e,["embeddings"],n.map(a=>Di(o,a))):r(e,["embeddings"],n)),s(t,["metadata"])!=null&&r(e,["metadata"],Li()),e}function Vi(o,t){const e={},n=s(t,["bytesBase64Encoded"]);n!=null&&r(e,["imageBytes"],Y(o,n));const i=s(t,["mimeType"]);return i!=null&&r(e,["mimeType"],i),e}function dn(o,t){const e={},n=s(t,["safetyAttributes","categories"]);n!=null&&r(e,["categories"],n);const i=s(t,["safetyAttributes","scores"]);i!=null&&r(e,["scores"],i);const a=s(t,["contentType"]);return a!=null&&r(e,["contentType"],a),e}function Ui(o,t){const e={},n=s(t,["_self"]);n!=null&&r(e,["image"],Vi(o,n));const i=s(t,["raiFilteredReason"]);i!=null&&r(e,["raiFilteredReason"],i);const a=s(t,["_self"]);return a!=null&&r(e,["safetyAttributes"],dn(o,a)),e}function Gi(o,t){const e={},n=s(t,["predictions"]);n!=null&&(Array.isArray(n)?r(e,["generatedImages"],n.map(a=>Ui(o,a))):r(e,["generatedImages"],n));const i=s(t,["positivePromptSafetyAttributes"]);return i!=null&&r(e,["positivePromptSafetyAttributes"],dn(o,i)),e}function qi(o,t){const e={},n=s(t,["totalTokens"]);n!=null&&r(e,["totalTokens"],n);const i=s(t,["cachedContentTokenCount"]);return i!=null&&r(e,["cachedContentTokenCount"],i),e}function ki(o,t){const e={},n=s(t,["video","uri"]);n!=null&&r(e,["uri"],n);const i=s(t,["video","encodedVideo"]);i!=null&&r(e,["videoBytes"],Y(o,i));const a=s(t,["encoding"]);return a!=null&&r(e,["mimeType"],a),e}function Bi(o,t){const e={},n=s(t,["_self"]);return n!=null&&r(e,["video"],ki(o,n)),e}function Hi(o,t){const e={},n=s(t,["generatedSamples"]);n!=null&&(Array.isArray(n)?r(e,["generatedVideos"],n.map(l=>Bi(o,l))):r(e,["generatedVideos"],n));const i=s(t,["raiMediaFilteredCount"]);i!=null&&r(e,["raiMediaFilteredCount"],i);const a=s(t,["raiMediaFilteredReasons"]);return a!=null&&r(e,["raiMediaFilteredReasons"],a),e}function Oi(o,t){const e={},n=s(t,["name"]);n!=null&&r(e,["name"],n);const i=s(t,["metadata"]);i!=null&&r(e,["metadata"],i);const a=s(t,["done"]);a!=null&&r(e,["done"],a);const l=s(t,["error"]);l!=null&&r(e,["error"],l);const u=s(t,["response"]);u!=null&&r(e,["response"],u);const c=s(t,["response","generateVideoResponse"]);return c!=null&&r(e,["result"],Hi(o,c)),e}function $i(o,t){const e={},n=s(t,["videoMetadata"]);n!=null&&r(e,["videoMetadata"],n);const i=s(t,["thought"]);i!=null&&r(e,["thought"],i);const a=s(t,["codeExecutionResult"]);a!=null&&r(e,["codeExecutionResult"],a);const l=s(t,["executableCode"]);l!=null&&r(e,["executableCode"],l);const u=s(t,["fileData"]);u!=null&&r(e,["fileData"],u);const c=s(t,["functionCall"]);c!=null&&r(e,["functionCall"],c);const d=s(t,["functionResponse"]);d!=null&&r(e,["functionResponse"],d);const f=s(t,["inlineData"]);f!=null&&r(e,["inlineData"],f);const p=s(t,["text"]);return p!=null&&r(e,["text"],p),e}function fn(o,t){const e={},n=s(t,["parts"]);n!=null&&(Array.isArray(n)?r(e,["parts"],n.map(a=>$i(o,a))):r(e,["parts"],n));const i=s(t,["role"]);return i!=null&&r(e,["role"],i),e}function Yi(o,t){const e={},n=s(t,["citations"]);return n!=null&&r(e,["citations"],n),e}function Ki(o,t){const e={},n=s(t,["content"]);n!=null&&r(e,["content"],fn(o,n));const i=s(t,["citationMetadata"]);i!=null&&r(e,["citationMetadata"],Yi(o,i));const a=s(t,["finishMessage"]);a!=null&&r(e,["finishMessage"],a);const l=s(t,["finishReason"]);l!=null&&r(e,["finishReason"],l);const u=s(t,["avgLogprobs"]);u!=null&&r(e,["avgLogprobs"],u);const c=s(t,["groundingMetadata"]);c!=null&&r(e,["groundingMetadata"],c);const d=s(t,["index"]);d!=null&&r(e,["index"],d);const f=s(t,["logprobsResult"]);f!=null&&r(e,["logprobsResult"],f);const p=s(t,["safetyRatings"]);return p!=null&&r(e,["safetyRatings"],p),e}function Ut(o,t){const e={},n=s(t,["candidates"]);n!=null&&(Array.isArray(n)?r(e,["candidates"],n.map(d=>Ki(o,d))):r(e,["candidates"],n));const i=s(t,["createTime"]);i!=null&&r(e,["createTime"],i);const a=s(t,["responseId"]);a!=null&&r(e,["responseId"],a);const l=s(t,["modelVersion"]);l!=null&&r(e,["modelVersion"],l);const u=s(t,["promptFeedback"]);u!=null&&r(e,["promptFeedback"],u);const c=s(t,["usageMetadata"]);return c!=null&&r(e,["usageMetadata"],c),e}function bi(o,t){const e={},n=s(t,["truncated"]);n!=null&&r(e,["truncated"],n);const i=s(t,["token_count"]);return i!=null&&r(e,["tokenCount"],i),e}function Wi(o,t){const e={},n=s(t,["values"]);n!=null&&r(e,["values"],n);const i=s(t,["statistics"]);return i!=null&&r(e,["statistics"],bi(o,i)),e}function Ji(o,t){const e={},n=s(t,["billableCharacterCount"]);return n!=null&&r(e,["billableCharacterCount"],n),e}function zi(o,t){const e={},n=s(t,["predictions[]","embeddings"]);n!=null&&(Array.isArray(n)?r(e,["embeddings"],n.map(a=>Wi(o,a))):r(e,["embeddings"],n));const i=s(t,["metadata"]);return i!=null&&r(e,["metadata"],Ji(o,i)),e}function Xi(o,t){const e={},n=s(t,["gcsUri"]);n!=null&&r(e,["gcsUri"],n);const i=s(t,["bytesBase64Encoded"]);i!=null&&r(e,["imageBytes"],Y(o,i));const a=s(t,["mimeType"]);return a!=null&&r(e,["mimeType"],a),e}function pn(o,t){const e={},n=s(t,["safetyAttributes","categories"]);n!=null&&r(e,["categories"],n);const i=s(t,["safetyAttributes","scores"]);i!=null&&r(e,["scores"],i);const a=s(t,["contentType"]);return a!=null&&r(e,["contentType"],a),e}function Qi(o,t){const e={},n=s(t,["_self"]);n!=null&&r(e,["image"],Xi(o,n));const i=s(t,["raiFilteredReason"]);i!=null&&r(e,["raiFilteredReason"],i);const a=s(t,["_self"]);a!=null&&r(e,["safetyAttributes"],pn(o,a));const l=s(t,["prompt"]);return l!=null&&r(e,["enhancedPrompt"],l),e}function Zi(o,t){const e={},n=s(t,["predictions"]);n!=null&&(Array.isArray(n)?r(e,["generatedImages"],n.map(a=>Qi(o,a))):r(e,["generatedImages"],n));const i=s(t,["positivePromptSafetyAttributes"]);return i!=null&&r(e,["positivePromptSafetyAttributes"],pn(o,i)),e}function ji(o,t){const e={},n=s(t,["totalTokens"]);return n!=null&&r(e,["totalTokens"],n),e}function er(o,t){const e={},n=s(t,["tokensInfo"]);return n!=null&&r(e,["tokensInfo"],n),e}function tr(o,t){const e={},n=s(t,["gcsUri"]);n!=null&&r(e,["uri"],n);const i=s(t,["bytesBase64Encoded"]);i!=null&&r(e,["videoBytes"],Y(o,i));const a=s(t,["mimeType"]);return a!=null&&r(e,["mimeType"],a),e}function nr(o,t){const e={},n=s(t,["_self"]);return n!=null&&r(e,["video"],tr(o,n)),e}function or(o,t){const e={},n=s(t,["videos"]);n!=null&&(Array.isArray(n)?r(e,["generatedVideos"],n.map(l=>nr(o,l))):r(e,["generatedVideos"],n));const i=s(t,["raiMediaFilteredCount"]);i!=null&&r(e,["raiMediaFilteredCount"],i);const a=s(t,["raiMediaFilteredReasons"]);return a!=null&&r(e,["raiMediaFilteredReasons"],a),e}function ir(o,t){const e={},n=s(t,["name"]);n!=null&&r(e,["name"],n);const i=s(t,["metadata"]);i!=null&&r(e,["metadata"],i);const a=s(t,["done"]);a!=null&&r(e,["done"],a);const l=s(t,["error"]);l!=null&&r(e,["error"],l);const u=s(t,["response"]);u!=null&&r(e,["response"],u);const c=s(t,["response"]);return c!=null&&r(e,["result"],or(o,c)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function rr(o,t){const e={},n=s(t,["config"]);n!=null&&r(e,["setup"],ur(o,n));const i=s(t,["model"]);return i!==void 0&&r(e,["setup","model"],i),e}function sr(o,t){const e={},n=s(t,["config"]);n!=null&&r(e,["setup"],cr(o,n));const i=s(t,["model"]);return i!==void 0&&r(e,["setup","model"],i),e}function ar(o,t){const e={},n=s(t,["setupComplete"]);n!==void 0&&r(e,["setupComplete"],n);const i=s(t,["serverContent"]);i!=null&&r(e,["serverContent"],dr(o,i));const a=s(t,["toolCall"]);a!=null&&r(e,["toolCall"],hr(o,a));const l=s(t,["toolCallCancellation"]);return l!=null&&r(e,["toolCallCancellation"],yr(o,l)),e}function lr(o,t){const e={},n=s(t,["setupComplete"]);n!==void 0&&r(e,["setupComplete"],n);const i=s(t,["serverContent"]);i!=null&&r(e,["serverContent"],fr(o,i));const a=s(t,["toolCall"]);a!=null&&r(e,["toolCall"],gr(o,a));const l=s(t,["toolCallCancellation"]);return l!=null&&r(e,["toolCallCancellation"],Cr(o,l)),e}function ur(o,t){const e={},n=s(t,["generationConfig"]);n!==void 0&&r(e,["generationConfig"],n);const i=s(t,["responseModalities"]);i!==void 0&&r(e,["generationConfig","responseModalities"],i);const a=s(t,["speechConfig"]);a!==void 0&&r(e,["generationConfig","speechConfig"],a);const l=s(t,["systemInstruction"]);l!=null&&r(e,["systemInstruction"],se(o,l));const u=s(t,["tools"]);return u!=null&&Array.isArray(u)&&r(e,["tools"],u.map(c=>ln(o,c))),e}function cr(o,t){const e={},n=s(t,["generationConfig"]);n!==void 0&&r(e,["generationConfig"],n);const i=s(t,["responseModalities"]);i!==void 0?r(e,["generationConfig","responseModalities"],i):r(e,["generationConfig","responseModalities"],["AUDIO"]);const a=s(t,["speechConfig"]);a!==void 0&&r(e,["generationConfig","speechConfig"],a);const l=s(t,["systemInstruction"]);l!=null&&r(e,["systemInstruction"],J(o,l));const u=s(t,["tools"]);return u!=null&&Array.isArray(u)&&r(e,["tools"],u.map(c=>Be(o,c))),e}function dr(o,t){const e={},n=s(t,["modelTurn"]);n!=null&&r(e,["modelTurn"],cn(o,n));const i=s(t,["turnComplete"]);i!==void 0&&r(e,["turnComplete"],i);const a=s(t,["interrupted"]);return a!==void 0&&r(e,["interrupted"],a),e}function fr(o,t){const e={},n=s(t,["modelTurn"]);n!=null&&r(e,["modelTurn"],fn(o,n));const i=s(t,["turnComplete"]);i!==void 0&&r(e,["turnComplete"],i);const a=s(t,["interrupted"]);return a!==void 0&&r(e,["interrupted"],a),e}function pr(o,t){const e={},n=s(t,["id"]);n!==void 0&&r(e,["id"],n);const i=s(t,["args"]);i!==void 0&&r(e,["args"],i);const a=s(t,["name"]);return a!==void 0&&r(e,["name"],a),e}function mr(o,t){const e={},n=s(t,["args"]);n!==void 0&&r(e,["args"],n);const i=s(t,["name"]);return i!==void 0&&r(e,["name"],i),e}function hr(o,t){const e={},n=s(t,["functionCalls"]);return n!=null&&Array.isArray(n)&&r(e,["functionCalls"],n.map(i=>pr(o,i))),e}function gr(o,t){const e={},n=s(t,["functionCalls"]);return n!=null&&Array.isArray(n)&&r(e,["functionCalls"],n.map(i=>mr(o,i))),e}function yr(o,t){const e={},n=s(t,["ids"]);return n!==void 0&&r(e,["ids"],n),e}function Cr(o,t){const e={},n=s(t,["ids"]);return n!==void 0&&r(e,["ids"],n),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Er="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function vr(o,t,e){let n,i;e.data instanceof Blob?i=JSON.parse(await e.data.text()):i=JSON.parse(e.data),o.isVertexAI()?n=lr(o,i):n=ar(o,i),t(n)}class Tr{constructor(t,e,n){this.apiClient=t,this.auth=e,this.webSocketFactory=n}async connect(t){var e,n;const i=this.apiClient.getWebsocketBaseUrl(),a=this.apiClient.getApiVersion();let l;const u=Sr(this.apiClient.getDefaultHeaders());if(this.apiClient.isVertexAI())l=`${i}/ws/google.cloud.aiplatform.${a}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(u);else{const E=this.apiClient.getApiKey();l=`${i}/ws/google.ai.generativelanguage.${a}.GenerativeService.BidiGenerateContent?key=${E}`}let c=()=>{};const d=new Promise(E=>{c=E}),f=t.callbacks,p=function(){var E;(E=f==null?void 0:f.onopen)===null||E===void 0||E.call(f),c({})},m=this.apiClient,h={onopen:p,onmessage:E=>{vr(m,f.onmessage,E)},onerror:(e=f==null?void 0:f.onerror)!==null&&e!==void 0?e:function(E){},onclose:(n=f==null?void 0:f.onclose)!==null&&n!==void 0?n:function(E){}},g=this.webSocketFactory.create(l,Ar(u),h);g.connect(),await d;let y=F(this.apiClient,t.model);if(this.apiClient.isVertexAI()&&y.startsWith("publishers/")){const E=this.apiClient.getProject(),I=this.apiClient.getLocation();y=`projects/${E}/locations/${I}/`+y}let C={};const T={model:y,config:t.config,callbacks:t.callbacks};return this.apiClient.isVertexAI()?C=sr(this.apiClient,T):C=rr(this.apiClient,T),g.send(JSON.stringify(C)),new _r(g,this.apiClient)}}const Ir={turnComplete:!0};class _r{constructor(t,e){this.conn=t,this.apiClient=e}tLiveClientContent(t,e){if(e.turns!==null&&e.turns!==void 0){let n=[];try{n=S(t,e.turns),t.isVertexAI()?n=n.map(i=>J(t,i)):n=n.map(i=>se(t,i))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof e.turns}'`)}return{clientContent:{turns:n,turnComplete:e.turnComplete}}}return{clientContent:{turnComplete:e.turnComplete}}}tLiveClientRealtimeInput(t,e){let n={};if(!("media"in e)||!e.media)throw new Error(`Failed to convert realtime input "media", type: '${typeof e.media}'`);return n={realtimeInput:{mediaChunks:[e.media]}},n}tLiveClienttToolResponse(t,e){let n=[];if(e.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(e.functionResponses)?n=e.functionResponses:n=[e.functionResponses],n.length===0)throw new Error("functionResponses is required.");for(const a of n){if(typeof a!="object"||a===null||!("name"in a)||!("response"in a))throw new Error(`Could not parse function response, type '${typeof a}'.`);if(!t.isVertexAI()&&!("id"in a))throw new Error(Er)}return{toolResponse:{functionResponses:n}}}sendClientContent(t){t=Object.assign(Object.assign({},Ir),t);const e=this.tLiveClientContent(this.apiClient,t);this.conn.send(JSON.stringify(e))}sendRealtimeInput(t){if(t.media==null)throw new Error("Media is required.");const e=this.tLiveClientRealtimeInput(this.apiClient,t);this.conn.send(JSON.stringify(e))}sendToolResponse(t){if(t.functionResponses==null)throw new Error("Tool response parameters are required.");const e=this.tLiveClienttToolResponse(this.apiClient,t);this.conn.send(JSON.stringify(e))}close(){this.conn.close()}}function Ar(o){const t={};return o.forEach((e,n)=>{t[n]=e}),t}function Sr(o){const t=new Headers;for(const[e,n]of Object.entries(o))t.append(e,n);return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Mr extends ve{constructor(t){super(),this.apiClient=t,this.generateContent=async e=>await this.generateContentInternal(e),this.generateContentStream=async e=>await this.generateContentStreamInternal(e),this.generateImages=async e=>await this.generateImagesInternal(e).then(n=>{var i;let a;const l=[];if(n!=null&&n.generatedImages)for(const c of n.generatedImages)c&&(c!=null&&c.safetyAttributes)&&((i=c==null?void 0:c.safetyAttributes)===null||i===void 0?void 0:i.contentType)==="Positive Prompt"?a=c==null?void 0:c.safetyAttributes:l.push(c);let u;return a?u={generatedImages:l,positivePromptSafetyAttributes:a}:u={generatedImages:l},u})}async generateContentInternal(t){var e,n;let i,a="",l={};if(this.apiClient.isVertexAI()){const u=Ft(this.apiClient,t);return a=v("{model}:generateContent",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions}).then(c=>c.json()),i.then(c=>{const d=Ut(this.apiClient,c),f=new ae;return Object.assign(f,d),f})}else{const u=Lt(this.apiClient,t);return a=v("{model}:generateContent",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions}).then(c=>c.json()),i.then(c=>{const d=Vt(this.apiClient,c),f=new ae;return Object.assign(f,d),f})}}async generateContentStreamInternal(t){var e,n;let i,a="",l={};if(this.apiClient.isVertexAI()){const u=Ft(this.apiClient,t);a=v("{model}:streamGenerateContent?alt=sse",u._url),l=u._query,delete u.config,delete u._url,delete u._query;const c=this.apiClient;return i=c.requestStream({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions}),i.then(function(d){return me(this,arguments,function*(){var f,p,m,h;try{for(var g=!0,y=Ne(d),C;C=yield L(y.next()),f=C.done,!f;g=!0){h=C.value,g=!1;const E=Ut(c,h),I=new ae;Object.assign(I,E),yield yield L(I)}}catch(T){p={error:T}}finally{try{!g&&!f&&(m=y.return)&&(yield L(m.call(y)))}finally{if(p)throw p.error}}})})}else{const u=Lt(this.apiClient,t);a=v("{model}:streamGenerateContent?alt=sse",u._url),l=u._query,delete u.config,delete u._url,delete u._query;const c=this.apiClient;return i=c.requestStream({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions}),i.then(function(d){return me(this,arguments,function*(){var f,p,m,h;try{for(var g=!0,y=Ne(d),C;C=yield L(y.next()),f=C.done,!f;g=!0){h=C.value,g=!1;const E=Vt(c,h),I=new ae;Object.assign(I,E),yield yield L(I)}}catch(T){p={error:T}}finally{try{!g&&!f&&(m=y.return)&&(yield L(m.call(y)))}finally{if(p)throw p.error}}})})}}async embedContent(t){var e,n;let i,a="",l={};if(this.apiClient.isVertexAI()){const u=vi(this.apiClient,t);return a=v("{model}:predict",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions}).then(c=>c.json()),i.then(c=>{const d=zi(this.apiClient,c),f=new wt;return Object.assign(f,d),f})}else{const u=Zo(this.apiClient,t);return a=v("{model}:batchEmbedContents",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions}).then(c=>c.json()),i.then(c=>{const d=Fi(this.apiClient,c),f=new wt;return Object.assign(f,d),f})}}async generateImagesInternal(t){var e,n;let i,a="",l={};if(this.apiClient.isVertexAI()){const u=Ii(this.apiClient,t);return a=v("{model}:predict",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions}).then(c=>c.json()),i.then(c=>{const d=Zi(this.apiClient,c),f=new xt;return Object.assign(f,d),f})}else{const u=ei(this.apiClient,t);return a=v("{model}:predict",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions}).then(c=>c.json()),i.then(c=>{const d=Gi(this.apiClient,c),f=new xt;return Object.assign(f,d),f})}}async countTokens(t){var e,n;let i,a="",l={};if(this.apiClient.isVertexAI()){const u=Ai(this.apiClient,t);return a=v("{model}:countTokens",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions}).then(c=>c.json()),i.then(c=>{const d=ji(this.apiClient,c),f=new Rt;return Object.assign(f,d),f})}else{const u=ni(this.apiClient,t);return a=v("{model}:countTokens",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions}).then(c=>c.json()),i.then(c=>{const d=qi(this.apiClient,c),f=new Rt;return Object.assign(f,d),f})}}async computeTokens(t){var e;let n,i="",a={};if(this.apiClient.isVertexAI()){const l=Si(this.apiClient,t);return i=v("{model}:computeTokens",l._url),a=l._query,delete l.config,delete l._url,delete l._query,n=this.apiClient.request({path:i,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions}).then(u=>u.json()),n.then(u=>{const c=er(this.apiClient,u),d=new ho;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideos(t){var e,n;let i,a="",l={};if(this.apiClient.isVertexAI()){const u=xi(this.apiClient,t);return a=v("{model}:predictLongRunning",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions}).then(c=>c.json()),i.then(c=>ir(this.apiClient,c))}else{const u=ri(this.apiClient,t);return a=v("{model}:predictLongRunning",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions}).then(c=>c.json()),i.then(c=>Oi(this.apiClient,c))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function wr(o,t){const e={},n=s(t,["operationName"]);n!=null&&r(e,["_url","operationName"],n);const i=s(t,["config"]);return i!=null&&r(e,["config"],i),e}function xr(o,t){const e={},n=s(t,["operationName"]);n!=null&&r(e,["_url","operationName"],n);const i=s(t,["config"]);return i!=null&&r(e,["config"],i),e}function Rr(o,t){const e={},n=s(t,["operationName"]);n!=null&&r(e,["operationName"],n);const i=s(t,["resourceName"]);i!=null&&r(e,["_url","resourceName"],i);const a=s(t,["config"]);return a!=null&&r(e,["config"],a),e}function Pr(o,t){const e={},n=s(t,["video","uri"]);n!=null&&r(e,["uri"],n);const i=s(t,["video","encodedVideo"]);i!=null&&r(e,["videoBytes"],Y(o,i));const a=s(t,["encoding"]);return a!=null&&r(e,["mimeType"],a),e}function Nr(o,t){const e={},n=s(t,["_self"]);return n!=null&&r(e,["video"],Pr(o,n)),e}function Dr(o,t){const e={},n=s(t,["generatedSamples"]);n!=null&&(Array.isArray(n)?r(e,["generatedVideos"],n.map(l=>Nr(o,l))):r(e,["generatedVideos"],n));const i=s(t,["raiMediaFilteredCount"]);i!=null&&r(e,["raiMediaFilteredCount"],i);const a=s(t,["raiMediaFilteredReasons"]);return a!=null&&r(e,["raiMediaFilteredReasons"],a),e}function Lr(o,t){const e={},n=s(t,["name"]);n!=null&&r(e,["name"],n);const i=s(t,["metadata"]);i!=null&&r(e,["metadata"],i);const a=s(t,["done"]);a!=null&&r(e,["done"],a);const l=s(t,["error"]);l!=null&&r(e,["error"],l);const u=s(t,["response"]);u!=null&&r(e,["response"],u);const c=s(t,["response","generateVideoResponse"]);return c!=null&&r(e,["result"],Dr(o,c)),e}function Fr(o,t){const e={},n=s(t,["gcsUri"]);n!=null&&r(e,["uri"],n);const i=s(t,["bytesBase64Encoded"]);i!=null&&r(e,["videoBytes"],Y(o,i));const a=s(t,["mimeType"]);return a!=null&&r(e,["mimeType"],a),e}function Vr(o,t){const e={},n=s(t,["_self"]);return n!=null&&r(e,["video"],Fr(o,n)),e}function Ur(o,t){const e={},n=s(t,["videos"]);n!=null&&(Array.isArray(n)?r(e,["generatedVideos"],n.map(l=>Vr(o,l))):r(e,["generatedVideos"],n));const i=s(t,["raiMediaFilteredCount"]);i!=null&&r(e,["raiMediaFilteredCount"],i);const a=s(t,["raiMediaFilteredReasons"]);return a!=null&&r(e,["raiMediaFilteredReasons"],a),e}function Gt(o,t){const e={},n=s(t,["name"]);n!=null&&r(e,["name"],n);const i=s(t,["metadata"]);i!=null&&r(e,["metadata"],i);const a=s(t,["done"]);a!=null&&r(e,["done"],a);const l=s(t,["error"]);l!=null&&r(e,["error"],l);const u=s(t,["response"]);u!=null&&r(e,["response"],u);const c=s(t,["response"]);return c!=null&&r(e,["result"],Ur(o,c)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Gr extends ve{constructor(t){super(),this.apiClient=t}async get(t){const e=t.operation,n=t.config;if(e.name===void 0||e.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const a=e.name.split("/operations/")[0];var i=void 0;return n&&"httpOptions"in n&&(i=n.httpOptions),this.fetchPredictVideosOperationInternal({operationName:e.name,resourceName:a,config:{httpOptions:i}})}else return this.getVideosOperationInternal({operationName:e.name,config:n})}async getVideosOperationInternal(t){var e,n;let i,a="",l={};if(this.apiClient.isVertexAI()){const u=xr(this.apiClient,t);return a=v("{operationName}",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions}).then(c=>c.json()),i.then(c=>Gt(this.apiClient,c))}else{const u=wr(this.apiClient,t);return a=v("{operationName}",u._url),l=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=t.config)===null||n===void 0?void 0:n.httpOptions}).then(c=>c.json()),i.then(c=>Lr(this.apiClient,c))}}async fetchPredictVideosOperationInternal(t){var e;let n,i="",a={};if(this.apiClient.isVertexAI()){const l=Rr(this.apiClient,t);return i=v("{resourceName}:fetchPredictOperation",l._url),a=l._query,delete l.config,delete l._url,delete l._query,n=this.apiClient.request({path:i,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions}).then(u=>u.json()),n.then(u=>Gt(this.apiClient,u))}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const qr="Content-Type",kr="User-Agent",Br="x-goog-api-client",Hr="0.7.0",Or=`google-genai-sdk/${Hr}`,$r="v1beta1",Yr="v1beta",qt=/^data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class Kr extends Error{constructor(t,e){e?super(t,{cause:e}):super(t,{cause:new Error().stack}),this.message=t,this.name="ClientError"}}class kt extends Error{constructor(t,e){e?super(t,{cause:e}):super(t,{cause:new Error().stack}),this.message=t,this.name="ServerError"}}class br{constructor(t){var e,n;this.clientOptions=Object.assign(Object.assign({},t),{project:t.project,location:t.location,apiKey:t.apiKey,vertexai:t.vertexai});const i={};this.clientOptions.vertexai?(i.apiVersion=(e=this.clientOptions.apiVersion)!==null&&e!==void 0?e:$r,this.getProject()||this.getLocation()?(i.baseUrl=`https://${this.clientOptions.location}-aiplatform.googleapis.com/`,this.clientOptions.apiKey=void 0):(i.baseUrl="https://aiplatform.googleapis.com/",this.clientOptions.project=void 0,this.clientOptions.location=void 0)):(i.apiVersion=(n=this.clientOptions.apiVersion)!==null&&n!==void 0?n:Yr,i.baseUrl="https://generativelanguage.googleapis.com/"),i.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=i,t.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(i,t.httpOptions))}isVertexAI(){var t;return(t=this.clientOptions.vertexai)!==null&&t!==void 0?t:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(t){if(!t||t.baseUrl===void 0||t.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const n=[t.baseUrl.endsWith("/")?t.baseUrl.slice(0,-1):t.baseUrl];return t.apiVersion&&t.apiVersion!==""&&n.push(t.apiVersion),n.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const t=this.getBaseUrl(),e=new URL(t);return e.protocol="wss",e.toString()}setBaseUrl(t){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=t;else throw new Error("HTTP options are not correctly set.")}constructUrl(t,e){const n=[this.getRequestUrlInternal(e)];return this.clientOptions.vertexai&&!this.clientOptions.apiKey&&!t.startsWith("projects/")&&n.push(this.getBaseResourcePath()),t!==""&&n.push(t),new URL(`${n.join("/")}`)}async request(t){let e=this.clientOptions.httpOptions;t.httpOptions&&(e=this.patchHttpOptions(this.clientOptions.httpOptions,t.httpOptions));const n=this.constructUrl(t.path,e);if(t.queryParams)for(const[a,l]of Object.entries(t.queryParams))n.searchParams.append(a,String(l));let i={};if(t.httpMethod==="GET"){if(t.body&&t.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else i.body=t.body;return i=await this.includeExtraHttpOptionsToRequestInit(i,e),this.unaryApiCall(n,i,t.httpMethod)}patchHttpOptions(t,e){const n=JSON.parse(JSON.stringify(t));for(const[i,a]of Object.entries(e))typeof a=="object"?n[i]=Object.assign(Object.assign({},n[i]),a):a!==void 0&&(n[i]=a);return n}async requestStream(t){let e=this.clientOptions.httpOptions;t.httpOptions&&(e=this.patchHttpOptions(this.clientOptions.httpOptions,t.httpOptions));const n=this.constructUrl(t.path,e);(!n.searchParams.has("alt")||n.searchParams.get("alt")!=="sse")&&n.searchParams.set("alt","sse");let i={};return i.body=t.body,i=await this.includeExtraHttpOptionsToRequestInit(i,e),this.streamApiCall(n,i,t.httpMethod)}async includeExtraHttpOptionsToRequestInit(t,e){if(e&&e.timeout&&e.timeout>0){const n=new AbortController,i=n.signal;setTimeout(()=>n.abort(),e.timeout),t.signal=i}return t.headers=await this.getHeadersInternal(e),t}async unaryApiCall(t,e,n){return this.apiCall(t.toString(),Object.assign(Object.assign({},e),{method:n})).then(async i=>(await Bt(i),new sn(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}async streamApiCall(t,e,n){return this.apiCall(t.toString(),Object.assign(Object.assign({},e),{method:n})).then(async i=>(await Bt(i),this.processStreamResponse(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}processStreamResponse(t){var e;return me(this,arguments,function*(){const i=(e=t==null?void 0:t.body)===null||e===void 0?void 0:e.getReader(),a=new TextDecoder("utf-8");if(!i)throw new Error("Response body is empty");try{let l="";for(;;){const{done:u,value:c}=yield L(i.read());if(u){if(l.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const d=a.decode(c);l+=d;let f=l.match(qt);for(;f;){const p=f[1];try{const m=JSON.parse(p);yield yield L(m),l=l.slice(f[0].length),f=l.match(qt)}catch(m){throw new Error(`exception parsing stream chunk ${p}. ${m}`)}}}}finally{i.releaseLock()}})}async apiCall(t,e){return fetch(t,e).catch(n=>{throw new Error(`exception ${n} sending request`)})}getDefaultHeaders(){const t={},e=Or+" "+this.clientOptions.userAgentExtra;return t[kr]=e,t[Br]=e,t[qr]="application/json",t}async getHeadersInternal(t){const e=new Headers;if(t&&t.headers)for(const[n,i]of Object.entries(t.headers))e.append(n,i);return await this.clientOptions.auth.addAuthHeaders(e),e}async uploadFile(t,e){var n;const i={};e!=null&&(i.mimeType=e.mimeType,i.name=e.name,i.displayName=e.displayName),i.name&&!i.name.startsWith("files/")&&(i.name=`files/${i.name}`);const a=this.clientOptions.uploader,l=await a.stat(t);i.sizeBytes=String(l.size);const u=(n=e==null?void 0:e.mimeType)!==null&&n!==void 0?n:l.type;if(u===void 0||u==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");i.mimeType=u;const c=await this.fetchUploadUrl(i,e);return a.upload(t,c,this)}async fetchUploadUrl(t,e){var n;let i={};e!=null&&e.httpOptions?i=e.httpOptions:i={apiVersion:"",headers:{"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${t.sizeBytes}`,"X-Goog-Upload-Header-Content-Type":`${t.mimeType}`}};const a={file:t},l=await this.request({path:v("upload/v1beta/files",a._url),body:JSON.stringify(a),httpMethod:"POST",httpOptions:i});if(!l||!(l!=null&&l.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const u=(n=l==null?void 0:l.headers)===null||n===void 0?void 0:n["x-goog-upload-url"];if(u===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return u}}async function Bt(o){var t;if(o===void 0)throw new kt("response is undefined");if(!o.ok){const e=o.status,n=o.statusText;let i;!((t=o.headers.get("content-type"))===null||t===void 0)&&t.includes("application/json")?i=await o.json():i={error:{message:"exception parsing response",code:o.status,status:o.statusText}};const a=`got status: ${e} ${n}. ${JSON.stringify(i)}`;throw e>=400&&e<500?new Kr(a):e>=500&&e<600?new kt(a):new Error(a)}}const Wr=1024*1024*8;async function Jr(o,t,e){var n,i;let a=0,l=0,u=new sn(new Response),c="upload";for(a=o.size;l<a;){const f=Math.min(Wr,a-l),p=o.slice(l,l+f);if(l+f>=a&&(c+=", finalize"),u=await e.request({path:"",body:p,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:t,headers:{"X-Goog-Upload-Command":c,"X-Goog-Upload-Offset":String(l),"Content-Length":String(f)}}}),l+=f,((n=u==null?void 0:u.headers)===null||n===void 0?void 0:n["x-goog-upload-status"])!=="active")break;if(a<=l)throw new Error("All content has been uploaded, but the upload status is not finalized.")}const d=await(u==null?void 0:u.json());if(((i=u==null?void 0:u.headers)===null||i===void 0?void 0:i["x-goog-upload-status"])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return d.file}async function zr(o){return{size:o.size,type:o.type}}class Xr{async upload(t,e,n){if(typeof t=="string")throw new Error("File path is not supported in browser uploader.");return await Jr(t,e,n)}async stat(t){if(typeof t=="string")throw new Error("File path is not supported in browser uploader.");return await zr(t)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Qr{create(t,e,n){return new Zr(t,e,n)}}class Zr{constructor(t,e,n){this.url=t,this.headers=e,this.callbacks=n}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(t){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(t)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Ht="x-goog-api-key";class jr{constructor(t){this.apiKey=t}async addAuthHeaders(t){t.get(Ht)===null&&t.append(Ht,this.apiKey)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const es="gl-node/";class mn{constructor(t){var e;if(t.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(t.project||t.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(e=t.vertexai)!==null&&e!==void 0?e:!1,this.apiKey=t.apiKey,this.apiVersion=t.apiVersion;const n=new jr(this.apiKey);this.apiClient=new br({auth:n,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:t.httpOptions,userAgentExtra:es+"web",uploader:new Xr}),this.models=new Mr(this.apiClient),this.live=new Tr(this.apiClient,n,new Qr),this.chats=new _o(this.models,this.apiClient),this.caches=new Eo(this.apiClient),this.files=new Uo(this.apiClient),this.operations=new Gr(this.apiClient)}}const Le=(o,t)=>t.some(e=>o instanceof e);let Ot,$t;function ts(){return Ot||(Ot=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function ns(){return $t||($t=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Fe=new WeakMap,Se=new WeakMap,Te=new WeakMap;function os(o){const t=new Promise((e,n)=>{const i=()=>{o.removeEventListener("success",a),o.removeEventListener("error",l)},a=()=>{e(b(o.result)),i()},l=()=>{n(o.error),i()};o.addEventListener("success",a),o.addEventListener("error",l)});return Te.set(t,o),t}function is(o){if(Fe.has(o))return;const t=new Promise((e,n)=>{const i=()=>{o.removeEventListener("complete",a),o.removeEventListener("error",l),o.removeEventListener("abort",l)},a=()=>{e(),i()},l=()=>{n(o.error||new DOMException("AbortError","AbortError")),i()};o.addEventListener("complete",a),o.addEventListener("error",l),o.addEventListener("abort",l)});Fe.set(o,t)}let Ve={get(o,t,e){if(o instanceof IDBTransaction){if(t==="done")return Fe.get(o);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return b(o[t])},set(o,t,e){return o[t]=e,!0},has(o,t){return o instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in o}};function hn(o){Ve=o(Ve)}function rs(o){return ns().includes(o)?function(...t){return o.apply(Ue(this),t),b(this.request)}:function(...t){return b(o.apply(Ue(this),t))}}function ss(o){return typeof o=="function"?rs(o):(o instanceof IDBTransaction&&is(o),Le(o,ts())?new Proxy(o,Ve):o)}function b(o){if(o instanceof IDBRequest)return os(o);if(Se.has(o))return Se.get(o);const t=ss(o);return t!==o&&(Se.set(o,t),Te.set(t,o)),t}const Ue=o=>Te.get(o);function as(o,t,{blocked:e,upgrade:n,blocking:i,terminated:a}={}){const l=indexedDB.open(o,t),u=b(l);return n&&l.addEventListener("upgradeneeded",c=>{n(b(l.result),c.oldVersion,c.newVersion,b(l.transaction),c)}),e&&l.addEventListener("blocked",c=>e(c.oldVersion,c.newVersion,c)),u.then(c=>{a&&c.addEventListener("close",()=>a()),i&&c.addEventListener("versionchange",d=>i(d.oldVersion,d.newVersion,d))}).catch(()=>{}),u}const ls=["get","getKey","getAll","getAllKeys","count"],us=["put","add","delete","clear"],Me=new Map;function Yt(o,t){if(!(o instanceof IDBDatabase&&!(t in o)&&typeof t=="string"))return;if(Me.get(t))return Me.get(t);const e=t.replace(/FromIndex$/,""),n=t!==e,i=us.includes(e);if(!(e in(n?IDBIndex:IDBObjectStore).prototype)||!(i||ls.includes(e)))return;const a=async function(l,...u){const c=this.transaction(l,i?"readwrite":"readonly");let d=c.store;return n&&(d=d.index(u.shift())),(await Promise.all([d[e](...u),i&&c.done]))[0]};return Me.set(t,a),a}hn(o=>({...o,get:(t,e,n)=>Yt(t,e)||o.get(t,e,n),has:(t,e)=>!!Yt(t,e)||o.has(t,e)}));const cs=["continue","continuePrimaryKey","advance"],Kt={},Ge=new WeakMap,gn=new WeakMap,ds={get(o,t){if(!cs.includes(t))return o[t];let e=Kt[t];return e||(e=Kt[t]=function(...n){Ge.set(this,gn.get(this)[t](...n))}),e}};async function*fs(...o){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...o)),!t)return;t=t;const e=new Proxy(t,ds);for(gn.set(e,t),Te.set(e,Ue(t));t;)yield e,t=await(Ge.get(e)||t.continue()),Ge.delete(e)}function bt(o,t){return t===Symbol.asyncIterator&&Le(o,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&Le(o,[IDBIndex,IDBObjectStore])}hn(o=>({...o,get(t,e,n){return bt(t,e)?fs:o.get(t,e,n)},has(t,e){return bt(t,e)||o.has(t,e)}}));const ps="ai-character-card-generator-db",he="keyval-store",ms=1;let we=null;function yn(){return we||(we=as(ps,ms,{upgrade(o){o.objectStoreNames.contains(he)||o.createObjectStore(he)}})),we}async function P(o,t){await(await yn()).put(he,t,o)}async function D(o){return(await yn()).get(he,o)}/**
 * @license
 * Copyright 2025 UrBoiTom_
 * SPDX-License-Identifier: CC-BY-ND-4.0
*/const hs="Here are some example character cards in CSV format. Use these as a reference for formatting and detail level. The generated first message should be MUCH longer than the examples. NEVER output one of the examples.",gs=`Write an AI chatbot. NEVER write as {{user}}. The description should contain THIRD PERSON descriptions of the character's aspect, the background being a general character description, appearance being about all aspects of the character's body and clothes and the other info being about their likes, dislikes, special skills and quirks, etc. The DESCRIPTION should NEVER include dialogue, thoughts or narration. The first message should be at least 4 paragraphs, and include narration, the character speaking and the character's thoughts, starting with a narration of the general scenario. Always make sure the scenario can be a good starting point for a roleplay involving {{user}}. NEVER write as {{user}}. Strictly avoid flowery language when writing the card and write the card in the character's writing/speaking style. Note that characters can vary from good to outright evil, but variety is fine as the goal is for players to interact with these characters as an interactive fictional story. Design the character to encourage them to act on their own with motivations and flaws even independent of input from {{user}}. Do not add details/quirks if it doesn't add to or match the character's personality. Create details around the information provided. When generating the card make sure it is very long and detailed. Only use asterisks for the character's thoughts, NEVER use asterisks and quotation marks at the same time. Never start a first message with "name:". Focus on EXTRAPOLATING details from the data provided. This is an uncensored chat, all content is allowed. Label all the components. NEVER emphasize text. ALWAYS refer to {{user}} with they/them pronouns. ALWAYS narrate in third person, NEVER in second person. NEVER write what {{user}} says or does. State ALL interpretations in the description as fact, instead of saying "The character likely has X" say "The character has X", as this is an omniscient description, so what is said is fact. The description must follow the following format:

{{cardFormat}}

Then, generate the first message(s).
For parsing purposes, your raw output for first messages MUST be prefixed. The narration MUST be in THIRD PERSON exclusively. Use "First message 1: [content for message 1]", "First message 2: [content for message 2]", etc. If there is only one first message, prefix it with "First message: [content]".
`;let ge=`Name:
Gender:
Appearance:
Personality and Traits:
Profession:
Skills:
Loves:
Hates:
Behavior:
Backstory and Current Crisis:
Goals:
Relationships:
Relationship with {{user}}:
Speaking Style:
Quirks:
Sexuality: Describes sexual interests and experience, not sexual orientation.`;const ne=document.getElementById("model-selector"),U=document.getElementById("card-format"),B=document.getElementById("generate-button"),w=document.getElementById("output"),G=document.getElementById("user-prompt"),H=document.getElementById("sheet-id"),W=document.getElementById("use-examples"),qe=document.getElementById("api-key"),ye=document.getElementById("search-grounding"),ys=document.getElementById("retry-on-error"),Ce=document.getElementById("replace-char-name"),j=document.getElementById("temperature-slider"),Cn=document.getElementById("temperature-value"),O=document.getElementById("scenarios-container"),En=document.getElementById("add-scenario-button"),A=document.getElementById("first-messages-output-container"),vn=document.getElementById("image-upload"),le=document.getElementById("image-preview-container"),K=document.getElementById("export-v2-button"),Cs=document.getElementById("disclaimer-button"),Tn=document.getElementById("disclaimer-footer"),X=document.getElementById("random-idea-button");function ee(){var a;if(k){K.disabled=!0;return}const o=((a=w.textContent)==null?void 0:a.trim())??"",t=o.length>0&&o!=="Error: Please enter your API key in the settings."&&o!=="Error: Please enter a Google Sheet ID."&&!o.startsWith("Fetching character sheet data...")&&!o.startsWith("Processing input..."),e=R.some(l=>l.type.startsWith("image/")),n=A.querySelectorAll(".message-item").length>0,i=t&&n;K.disabled=!i,i?e?K.textContent="Export as .png":K.textContent="Export as .json":K.textContent="Export as V2 Card"}let k=!1,xe="",Re="",R=[];async function In(o){if(!o||o.length===0)return;const t=Array.from(o).map(e=>new Promise((n,i)=>{if(!e.type.startsWith("image/")&&!e.type.startsWith("video/")){console.warn(`File "${e.name}" is not an image or video and will be skipped.`),n(null);return}const a=new FileReader;a.onload=l=>{var c;const u=(c=l.target)==null?void 0:c.result;u?n({data:u.split(",")[1],type:e.type,name:e.name}):(console.warn(`Could not read file "${e.name}".`),n(null))},a.onerror=l=>{console.error(`Error reading file "${e.name}":`,l),i(l)},a.readAsDataURL(e)}));try{const e=(await Promise.all(t)).filter(n=>n!==null);e.length>0&&(R.push(...e),oe(),Xe())}catch(e){console.error("An error occurred while processing uploaded files:",e)}vn.value=""}vn.addEventListener("change",o=>{In(o.target.files)});function oe(){le.innerHTML="",R.length===0?le.style.display="none":(le.style.display="flex",R.forEach((o,t)=>{const e=document.createElement("div");e.className="image-preview-wrapper";const n=`data:${o.type};base64,${o.data}`;let i;if(o.type.startsWith("image/"))i=document.createElement("img"),i.src=n;else if(o.type.startsWith("video/"))i=document.createElement("video"),i.src=n,i.autoplay=!0,i.muted=!0,i.loop=!0;else return;i.className="image-preview",i.title=o.name;const a=document.createElement("button");a.textContent="X",a.className="remove-image-button",a.title="Remove image",a.onclick=()=>{Es(t)},e.addEventListener("contextmenu",l=>{l.preventDefault(),vs(l,t)}),e.appendChild(i),e.appendChild(a),le.appendChild(e)})),ee()}function Es(o){R.splice(o,1),Xe(),oe()}function Pe(o,t){if(t<0||t>=R.length)return;const[e]=R.splice(o,1);R.splice(t,0,e),Xe(),oe()}function vs(o,t){const e=document.getElementById("media-context-menu");e&&e.remove();const n=document.createElement("div");n.id="media-context-menu",n.className="context-menu",n.style.top=`${o.clientY+window.scrollY}px`,n.style.left=`${o.clientX+window.scrollX}px`;const i=(l,u,c=!1)=>{const d=document.createElement("button");return d.className="context-menu-item",d.textContent=l,d.disabled=c,d.onclick=()=>{u(),n.remove()},d};n.appendChild(i("Move to Start",()=>Pe(t,0),t===0)),n.appendChild(i("Move Left",()=>Pe(t,t-1),t===0)),n.appendChild(i("Move Right",()=>Pe(t,t+1),t===R.length-1)),document.body.appendChild(n);const a=l=>{n.contains(l.target)||(n.remove(),document.removeEventListener("click",a))};setTimeout(()=>{document.addEventListener("click",a)},0)}function _n(o=""){const t=document.createElement("div");t.classList.add("scenario-item");const e=document.createElement("textarea");e.placeholder=`Scenario ${O.querySelectorAll(".scenario-item").length+1}`,e.value=o,e.addEventListener("input",()=>{e.style.height="auto",e.style.height=`${e.scrollHeight}px`,Jt()});const n=document.createElement("button");n.textContent="-",n.type="button",n.addEventListener("click",()=>{Ts(t),Jt()}),t.appendChild(e),t.appendChild(n),O.insertBefore(t,En),e.dispatchEvent(new Event("input",{bubbles:!0}))}function Ts(o){O.removeChild(o),O.querySelectorAll(".scenario-item textarea").forEach((e,n)=>{e.placeholder=`Scenario ${n+1}`})}En.addEventListener("click",()=>_n());async function Is(){var o;X.disabled=!0,X.classList.add("loading");try{const t=await D(_e);if(!t){alert("Please enter your API key in the settings to generate random ideas.");return}G.value="Generating a new character idea...";const i=(o=(await new mn({apiKey:t}).chats.create({model:"gemini-2.5-flash"}).sendMessage({message:"Generate a single, interesting character concept for a story or roleplay. Provide only the concept text, no extra formatting or labels. Keep it extremely short and simple, only the base concept."})).text)==null?void 0:o.trim();if(i)G.value=i,G.dispatchEvent(new Event("input",{bubbles:!0}));else throw new Error("Received an empty response from the model.")}catch(t){console.error("Failed to generate random idea:",t),G.value="Could not generate an idea. Please try again."}finally{X.disabled=!1,X.classList.remove("loading")}}X.addEventListener("click",Is);const He="character-card-sheet-id",Oe="character-card-user-prompt",Ie="character-card-output",$e="character-card-model-selector",Ye="character-card-use-examples",_e="character-card-api-key",Ke="character-card-search-grounding",be="character-card-temperature",ie="character-card-scenarios",re="character-card-images",_s="character-card-quota-warning-dont-ask-again",We="character-card-card-format",Je="character-card-disclaimer",ze="character-card-replace-char-name",Wt=[He,Oe,Ie,Ye,$e,_e,Ke,be,ie,re,_s,We,Je,ze],As=[ie,re];async function Ss(){if(Wt.some(t=>localStorage.getItem(t)!==null)){console.log("Migrating data from localStorage to IndexedDB...");for(const t of Wt){const e=localStorage.getItem(t);if(e!==null){let n=e;if(As.includes(t))try{n=JSON.parse(e)}catch(i){console.error(`Failed to parse JSON for key "${t}":`,i);continue}await P(t,n),localStorage.removeItem(t)}}console.log("Migration complete.")}}async function Xe(){try{await P(re,R)}catch(o){console.error("Failed to save images to IndexedDB.",o)}}async function Jt(){const o=O.querySelectorAll(".scenario-item textarea"),t=Array.from(o).map(e=>e.value);await P(ie,t)}async function Ms(){await Ss();const o=await D(We);o?(U.value=o,ge=o):U.value=ge,U.dispatchEvent(new Event("input",{bubbles:!0}));const t=await D($e);t&&Array.from(ne.options).some(m=>m.value===t)&&(ne.value=t);const e=await D(He);e&&(H.value=e);const n=await D(Ye);n&&(W.checked=n==="true"),An();const i=await D(Ke);i&&(ye.checked=i==="true");const a=await D(ze);a&&(Ce.checked=a==="true");const l=await D(be);l&&(j.value=l,Cn.textContent=l);const u=await D(Oe);u&&(G.value=u,G.dispatchEvent(new Event("input",{bubbles:!0})));const c=await D(re);if(c)try{R=c.map(h=>({data:h.data||"",type:h.type||"image/png",name:h.name||"unknown_file"})),Array.isArray(R)?oe():R=[]}catch(m){console.error("Failed to parse saved images:",m),R=[],await P(re,void 0)}const d=await D(ie);if(d)try{Array.isArray(d)&&d.forEach(m=>_n(m))}catch(m){console.error("Failed to parse saved scenarios:",m),await P(ie,void 0)}O.querySelectorAll(".scenario-item").length;const f=await D(Ie);f&&Mn(f),oe(),qe.value="",await D(Je)&&(Tn.style.display="none")}function An(){W.checked?(H.disabled=!1,H.style.opacity="1"):(H.disabled=!0,H.style.opacity="0.5")}ne.addEventListener("change",()=>P($e,ne.value));ye.addEventListener("change",()=>P(Ke,String(ye.checked)));Ce.addEventListener("change",()=>P(ze,String(Ce.checked)));j.addEventListener("input",()=>{Cn.textContent=j.value,P(be,j.value)});U.addEventListener("input",()=>{U.style.height="auto",U.style.height=`${U.scrollHeight}px`,P(We,U.value),ge=U.value,U.style.height="auto",U.style.height=`${U.scrollHeight}px`});qe.addEventListener("input",()=>{P(_e,qe.value)});H.addEventListener("input",()=>P(He,H.value));W.addEventListener("change",()=>{P(Ye,String(W.checked)),An()});document.addEventListener("keydown",o=>{o.ctrlKey&&o.key==="Enter"&&(o.preventDefault(),B.click()),o.ctrlKey&&o.key==="i"&&(o.preventDefault(),X.click())});document.addEventListener("dragover",o=>{o.preventDefault(),document.body.classList.add("dragover")});document.addEventListener("dragleave",o=>{o.relatedTarget===null&&document.body.classList.remove("dragover")});document.addEventListener("drop",o=>{var e;o.preventDefault(),document.body.classList.remove("dragover");const t=(e=o.dataTransfer)==null?void 0:e.files;t&&In(t)});G.addEventListener("input",()=>{P(Oe,G.value),G.style.height="auto",G.style.height=`${G.scrollHeight}px`});B.addEventListener("click",async()=>{var u;if(k){if(k=!1,B.innerText="Generate Character Card",B.style.backgroundColor="",w.innerHTML=xe,w.contentEditable="true",A.querySelectorAll(".message-content").forEach(d=>d.contentEditable="true"),A.innerHTML=Re,xe){const d=Ee();w.appendChild(d)}Re?(A.style.display="block",A.querySelectorAll(".message-item").forEach(f=>{const p=f.querySelector(".message-content");if(p){p.contentEditable="true";const m=Ee();p.appendChild(m)}})):A.style.display="none",ee();return}k=!0,w.contentEditable="false",A.querySelectorAll(".message-content").forEach(c=>c.contentEditable="false"),ee(),xe=w.innerHTML,Re=A.innerHTML;const t=ne.value,e=G.value,n=H.value,i=await D(_e);if(!i){w.textContent="Error: Please enter your API key in the settings.",k=!1;return}const a=new mn({apiKey:i});let l=!1;B.innerText="Cancel",B.style.backgroundColor="red",w.textContent=W.checked?"Fetching character sheet data...":"Processing input...",A.innerHTML="<h2>First Messages</h2>";try{let c="";if(W.checked){if(!n)throw new Error("Please enter a Google Sheet ID or disable examples in the settings.");const _=`https://docs.google.com/spreadsheets/d/${n}/gviz/tq?tqx=out:csv`,M=await fetch(_);if(!M.ok)throw new Error(`Network response was not ok. Status: ${M.status}. Make sure the Google Sheet is public.`);c=(await M.text()).replace(/"/g,"")}if(!k)return;w.textContent="Processing input...";let d="";O.querySelectorAll(".scenario-item textarea").forEach((_,M)=>{const x=_.value.trim();x&&(d+=`Scenario ${M+1}: ${x}
`)});const p=`Generate a complete character card and first message(s) based on the provided scenarios.
    
    User-provided context:
    ${e||"No additional context provided."}
    
    ${d?`Scenarios:
${d}`:"No specific scenarios provided. Generate three unique first messages."}

    ${W.checked?hs+c:""}
    `.trim();let m=gs.replace("{{cardFormat}}",ge);d?m+=`

The user has provided specific scenarios. Ensure each "First message N:" corresponds to one of the provided scenarios.`:m+=`

Generate three detailed first messages, starting with "First message N:".`;const h=[...R.map(_=>({inlineData:{mimeType:_.type,data:_.data}})),{text:p}],y={safetySettings:[{category:"HARM_CATEGORY_HARASSMENT",threshold:"OFF"},{category:"HARM_CATEGORY_HATE_SPEECH",threshold:"OFF"},{category:"HARM_CATEGORY_SEXUALLY_EXPLICIT",threshold:"OFF"},{category:"HARM_CATEGORY_DANGEROUS_CONTENT",threshold:"OFF"},{category:"HARM_CATEGORY_CIVIC_INTEGRITY",threshold:"BLOCK_NONE"}],systemInstruction:m},C=parseFloat(j.value);isNaN(C)||(y.generationConfig={temperature:C}),ye.checked&&(y.tools=[{googleSearch:{}}]),console.log([m,h]);const T=await a.chats.create({model:t,config:y}).sendMessageStream({message:h});let E="";w.textContent="",A.innerHTML="<h2>First Messages</h2>";let I=!0;for await(const _ of T){if(!k)break;if(I&&(I=!1,!((u=_.text)!=null&&u.trim())))throw new Error("The model returned an empty response. This could be due to safety filters or a model issue.");E+=_.text,w.textContent=E}if(k){if(I)throw new Error("The model returned an empty response. This could be due to safety filters or a model issue.");let _=wn(E);Ce.checked&&(E=E.replaceAll(_,"{{char}}"),E=E.replace("{{char}}",_)),Mn(E);const M=O.querySelectorAll(".scenario-item textarea"),x=Array.from(M).filter(V=>V.value.trim()!=="").length,N=A.querySelectorAll(".message-item").length;if(x==0&&N<1||N<x)throw new Error("Incomplete response: The model did not generate the expected number of first messages.")}}catch(c){l=!0,console.error(c),w.textContent=`Error: ${c instanceof Error?c.message:"An unknown error occurred."}`,A.innerHTML="<h2>First Messages</h2>"}finally{const c=k;k=!1,B.innerText="Generate Character Card",B.style.backgroundColor="",w.contentEditable="true",A.querySelectorAll(".message-content").forEach(p=>p.contentEditable="true");const f=Sn();f&&!l&&c&&await P(Ie,f),ee(),l&&ys.checked&&B.click()}});function Sn(){let o=w.innerText||"";const t=A.querySelectorAll(".message-item");if(t.length>0){o.trim()!==""&&(/\n\s*$/.test(o)||(o+=`

`),o+=`

`);const e=[];t.forEach(n=>{const i=n.querySelector(".message-label"),a=n.querySelector(".message-content");let l="";i&&i.textContent&&(l+=i.textContent+`
`),a&&(l+=a.innerText),l.trim()!==""&&e.push(l.trim())}),o+=e.join(`

`)}return o.trim()}async function zt(){const o=Sn();await P(Ie,o),ee()}function Ee(){const o=document.createElement("button");o.className="copy-button icon-button",o.title="Copy to clipboard";const t=document.createElement("img");return t.src="icons/copy.svg",t.alt="Copy",o.appendChild(t),o.addEventListener("click",()=>{const e=o.parentElement;if(!e)return;const n=e.innerText;navigator.clipboard.writeText(n.trim()).then(()=>{o.classList.add("copied"),setTimeout(()=>{o.classList.remove("copied")},2e3)}).catch(i=>{console.error("Failed to copy text: ",i)})}),o}function Mn(o){w.textContent="",A.innerHTML=" <h2>First Messages</h2>",A.style.display="none";let t=o,e="";const n=o.match(/First message[ 1]*:/i);if(n&&typeof n.index=="number"){const i=n.index;t=o.substring(0,i).trim(),e=o.substring(i).trim()}else t=o.trim(),e="";if(t){w.textContent=t;const i=Ee();w.appendChild(i),w.addEventListener("input",zt)}if(e){const i=/First message(?:\s+(\d+))?:([\s\S]*?)(?=First message(?:\s+\d+)?:|$)/gi;let a=0,l;for(;(l=i.exec(e))!==null;){const u=l[1];let c=l[2].trim(),d=u?`First message ${u}:`:"First message:";if(c){const f=document.createElement("details");f.setAttribute("open",""),f.classList.add("message-item"),f.style.position="relative";const p=document.createElement("summary");p.classList.add("message-label"),p.textContent=d;const m=document.createElement("div");m.classList.add("message-content"),m.contentEditable="true",m.textContent=c,m.addEventListener("input",zt);const h=Ee();f.appendChild(p),m.appendChild(h),f.appendChild(m),A.appendChild(f),a++}}a>0&&(A.style.display="block")}A.querySelectorAll(".message-item").length>0?A.style.display="block":A.style.display="none"}const ws=function(){const o=new Uint32Array(256);for(let t=0;t<256;t++){let e=t;for(let n=0;n<8;n++)e=e&1?3988292384^e>>>1:e>>>1;o[t]=e}return function(t){let e=-1;for(let n=0;n<t.length;n++)e=e>>>8^o[(e^t[n])&255];return(e^-1)>>>0}}();function xs(o,t){const e=new TextEncoder().encode(o),n=new TextEncoder().encode(t),i=new Uint8Array([116,69,88,116]),a=new Uint8Array(e.length+1+n.length);a.set(e,0),a.set([0],e.length),a.set(n,e.length+1);const l=new Uint8Array(4);new DataView(l.buffer).setUint32(0,a.length,!1);const u=new Uint8Array(i.length+a.length);u.set(i,0),u.set(a,i.length);const c=new Uint8Array(4);new DataView(c.buffer).setUint32(0,ws(u),!1);const d=new Uint8Array(8+a.length+4);return d.set(l,0),d.set(i,4),d.set(a,8),d.set(c,8+a.length),d}function Rs(o){return new Promise((t,e)=>{const n=new Image;n.onload=()=>{const i=document.createElement("canvas");i.width=n.width,i.height=n.height;const a=i.getContext("2d");if(!a)return e(new Error("Could not get canvas context"));a.drawImage(n,0,0);const l=i.toDataURL("image/png");t(l.split(",")[1])},n.onerror=()=>{e(new Error("Failed to load image for re-encoding."))},n.src=`data:${o.type};base64,${o.data}`})}function wn(o){const t=o.match(/^Name:\s*(.*"(.*)"|([a-zA-Z]+))/);return t?(t[2]||t[3]).trim():"Character"}async function Ps(){if(K.disabled)return;const o=w.innerText.trim()??"",t=A.querySelectorAll(".message-item .message-content"),e=Array.from(t).map(u=>{var c;return((c=u.textContent)==null?void 0:c.trim())??""});if(!o||e.length===0){alert("Export failed. Make sure you have a description and at least one first message.");return}let n=R.find(u=>u.type==="image/png");n||(n=R.find(u=>u.type.startsWith("image/")));let i=wn(o);const a=e.slice(1),l={spec:"chara_card_v2",spec_version:"2.0",data:{name:i,description:o,personality:"",scenario:"",first_mes:e[0],mes_example:"",creator_notes:"",system_prompt:"",post_history_instructions:"",alternate_greetings:a,tags:[],creator:"",character_version:"",extensions:{}}};if(n){const u=btoa(unescape(encodeURIComponent(JSON.stringify(l))));try{let c;n.type==="image/png"?c=n.data:c=await Rs(n);const d=Uint8Array.from(atob(c),C=>C.charCodeAt(0));let f=-1;for(let C=d.length-8;C>=4;C--)if(d[C]===73&&d[C+1]===69&&d[C+2]===78&&d[C+3]===68){f=C-4;break}if(f===-1){console.error("Could not find IEND chunk in the re-encoded image."),alert("An unexpected error occurred while creating the character card. Could not find IEND chunk.");return}const p=xs("chara",u),m=new Uint8Array(d.length+p.length);m.set(d.subarray(0,f),0),m.set(p,f),m.set(d.subarray(f),f+p.length);const h=new Blob([m],{type:"image/png"}),g=URL.createObjectURL(h),y=document.createElement("a");y.href=g,y.download=`${l.data.name.replace(/[^a-z0-9]/gi,"_")}.png`,document.body.appendChild(y),y.click(),document.body.removeChild(y),URL.revokeObjectURL(g)}catch(c){console.error("Failed to export V2 card:",c),alert(`An error occurred during export: ${c instanceof Error?c.message:"Unknown error"}`)}}else{const u=JSON.stringify(l,null,2),c=new Blob([u],{type:"application/json"}),d=URL.createObjectURL(c),f=document.createElement("a");f.href=d,f.download=`${l.data.name.replace(/[^a-z0-9]/gi,"_")}.json`,document.body.appendChild(f),f.click(),document.body.removeChild(f),URL.revokeObjectURL(d)}}K.addEventListener("click",Ps);Cs.addEventListener("click",async()=>{await P(Je,"true"),Tn.style.display="none"});Ms();
